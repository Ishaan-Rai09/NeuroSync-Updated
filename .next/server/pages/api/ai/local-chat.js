"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/ai/local-chat";
exports.ids = ["pages/api/ai/local-chat"];
exports.modules = {

/***/ "(api-node)/./lib/llama-service.js":
/*!******************************!*\
  !*** ./lib/llama-service.js ***!
  \******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   llamaService: () => (/* binding */ llamaService)\n/* harmony export */ });\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! axios */ \"axios\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([axios__WEBPACK_IMPORTED_MODULE_0__]);\naxios__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n// Configuration for local LLaMA 3.2 model\n// Use IPv4 format to avoid IPv6 connection issues\nconst LLAMA_API_URL = \"http://127.0.0.1:11434\" || 0;\nconst LLAMA_MODEL_NAME = \"llama3.2:latest\" || 0;\n/**\r\n * Service to interact with locally hosted LLaMA 3.2 model\r\n */ const llamaService = {\n    /**\r\n   * Process a chat message using local LLaMA 3.2 model\r\n   * @param {string} message - User's message\r\n   * @param {Array} history - Previous chat history for context\r\n   * @returns {Promise<{response: string}>}\r\n   */ async processMessage (message, history = []) {\n        try {\n            // Format history in a way LLaMA expects\n            const formattedHistory = history.map((msg)=>({\n                    role: msg.role || 'user',\n                    content: msg.content\n                }));\n            // Add system message to enhance the response with sentiment\n            formattedHistory.unshift({\n                role: 'system',\n                content: `You are a mental health assistant. When responding, identify the user's emotional state and be empathetic. Your response should be clear and concise.`\n            });\n            // Add current message to history\n            formattedHistory.push({\n                role: 'user',\n                content: message\n            });\n            console.log('Calling LLaMA API for chat response');\n            // Call local LLaMA API\n            const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].post(`${LLAMA_API_URL}/v1/chat/completions`, {\n                messages: formattedHistory,\n                model: LLAMA_MODEL_NAME,\n                temperature: 0.7,\n                max_tokens: 1000,\n                stream: false\n            }, {\n                // Configure timeout and headers\n                timeout: 60000,\n                headers: {\n                    'Content-Type': 'application/json'\n                }\n            });\n            console.log('LLaMA response received');\n            return {\n                response: response.data.choices[0].message.content\n            };\n        } catch (error) {\n            console.error('Error calling local LLaMA model:', error);\n            if (error.response) {\n                console.error('Error data:', error.response.data);\n                console.error('Error status:', error.response.status);\n            } else if (error.request) {\n                console.error('No response received:', error.request);\n            }\n            throw new Error('Failed to get response from LLaMA model');\n        }\n    },\n    /**\r\n   * Analyze sentiment in a message - simplified version\r\n   * @param {string} message - Message to analyze\r\n   * @returns {Promise<{sentiment: string, emotions: Object}>}\r\n   */ async quickAnalyzeSentiment (message) {\n        try {\n            // Simple pattern matching for quick sentiment analysis\n            const lowerMessage = message.toLowerCase();\n            let sentiment = 'neutral';\n            let primaryEmotion = 'neutral';\n            let confidence = 0.6;\n            // Simple keyword matching for quick analysis\n            const positiveWords = [\n                'happy',\n                'glad',\n                'great',\n                'good',\n                'positive',\n                'wonderful',\n                'excited',\n                'love',\n                'enjoy'\n            ];\n            const negativeWords = [\n                'sad',\n                'upset',\n                'angry',\n                'frustrated',\n                'depressed',\n                'anxious',\n                'worried',\n                'stress',\n                'fear'\n            ];\n            let positiveCount = 0;\n            let negativeCount = 0;\n            positiveWords.forEach((word)=>{\n                if (lowerMessage.includes(word)) positiveCount++;\n            });\n            negativeWords.forEach((word)=>{\n                if (lowerMessage.includes(word)) negativeCount++;\n            });\n            if (positiveCount > negativeCount) {\n                sentiment = 'positive';\n                primaryEmotion = 'happy';\n                confidence = 0.7 + 0.1 * Math.min(positiveCount, 3);\n            } else if (negativeCount > positiveCount) {\n                sentiment = 'negative';\n                // Determine specific negative emotion\n                if (lowerMessage.includes('anxious') || lowerMessage.includes('worry') || lowerMessage.includes('nervous')) {\n                    primaryEmotion = 'anxious';\n                } else if (lowerMessage.includes('sad') || lowerMessage.includes('depress')) {\n                    primaryEmotion = 'sad';\n                } else if (lowerMessage.includes('anger') || lowerMessage.includes('angry') || lowerMessage.includes('frustrat')) {\n                    primaryEmotion = 'angry';\n                } else if (lowerMessage.includes('stress')) {\n                    primaryEmotion = 'stressed';\n                } else {\n                    primaryEmotion = 'sad';\n                }\n                confidence = 0.7 + 0.1 * Math.min(negativeCount, 3);\n            }\n            // Only do full AI sentiment analysis if we couldn't determine from keywords\n            if (positiveCount === 0 && negativeCount === 0) {\n                return this.fullAnalyzeSentiment(message);\n            }\n            return {\n                sentiment: sentiment,\n                emotions: {\n                    primary: primaryEmotion,\n                    confidence: confidence\n                }\n            };\n        } catch (error) {\n            console.error('Error in quick sentiment analysis:', error);\n            return {\n                sentiment: 'neutral',\n                emotions: {\n                    primary: 'neutral',\n                    confidence: 0.5\n                }\n            };\n        }\n    },\n    /**\r\n   * Analyze sentiment in a message using LLaMA - full analysis\r\n   * @param {string} message - Message to analyze\r\n   * @returns {Promise<{sentiment: string, emotions: Object}>}\r\n   */ async fullAnalyzeSentiment (message) {\n        try {\n            // Instead of using completions endpoint, we'll use chat completions\n            // which is more commonly supported in local LLaMA servers\n            const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].post(`${LLAMA_API_URL}/v1/chat/completions`, {\n                messages: [\n                    {\n                        role: \"system\",\n                        content: \"You are a sentiment analysis assistant. Analyze the emotional sentiment of the user's message and respond with only a JSON object with the format: {\\\"sentiment\\\": \\\"positive/negative/neutral\\\", \\\"primary_emotion\\\": \\\"emotion_name\\\", \\\"confidence\\\": 0.X}\"\n                    },\n                    {\n                        role: \"user\",\n                        content: message\n                    }\n                ],\n                model: LLAMA_MODEL_NAME,\n                max_tokens: 100,\n                temperature: 0.1,\n                stream: false\n            }, {\n                timeout: 30000,\n                headers: {\n                    'Content-Type': 'application/json'\n                }\n            });\n            // Parse the JSON response\n            const responseText = response.data.choices[0].message.content.trim();\n            let emotionData;\n            try {\n                // Find JSON object in response if it's wrapped in other text\n                const jsonMatch = responseText.match(/(\\{.*\\})/s);\n                if (jsonMatch) {\n                    emotionData = JSON.parse(jsonMatch[0]);\n                } else {\n                    emotionData = JSON.parse(responseText);\n                }\n            } catch (parseError) {\n                console.error('Error parsing sentiment JSON:', parseError, 'Raw response:', responseText);\n                // Fallback sentiment analysis\n                return {\n                    sentiment: 'neutral',\n                    emotions: {\n                        primary: 'neutral',\n                        confidence: 0.5\n                    }\n                };\n            }\n            return {\n                sentiment: emotionData.sentiment || 'neutral',\n                emotions: {\n                    primary: emotionData.primary_emotion || 'neutral',\n                    confidence: emotionData.confidence || 0.5\n                }\n            };\n        } catch (error) {\n            console.error('Error analyzing sentiment with LLaMA:', error);\n            if (error.response) {\n                console.error('Error data:', error.response.data);\n                console.error('Error status:', error.response.status);\n            } else if (error.request) {\n                console.error('No response received:', error.request);\n            }\n            // Instead of throwing the error, return a fallback sentiment\n            return {\n                sentiment: 'neutral',\n                emotions: {\n                    primary: 'neutral',\n                    confidence: 0.5\n                }\n            };\n        }\n    },\n    /**\r\n   * Get predefined recommendations based on emotional state\r\n   * @param {string} emotionalState - Current emotional state\r\n   * @returns {Array} - List of recommendations\r\n   */ getQuickRecommendations (emotionalState) {\n        const recommendations = {\n            // Crisis/distress state\n            distressed: [\n                {\n                    type: 'resource',\n                    title: 'Crisis Support',\n                    description: 'Get immediate help from trained crisis counselors.',\n                    actionUrl: '/crisis',\n                    actionText: 'Get Help Now'\n                },\n                {\n                    type: 'resource',\n                    title: 'Suicide Prevention Resources',\n                    description: 'Find resources and support for suicidal thoughts.',\n                    actionUrl: '/resources/articles/suicide-prevention',\n                    actionText: 'View Resources'\n                },\n                {\n                    type: 'exercise',\n                    title: 'Safety Plan',\n                    description: 'Create a personal safety plan for difficult moments.',\n                    actionUrl: '/resources/exercises/safety-plan',\n                    actionText: 'Create Plan'\n                }\n            ],\n            // Happy state\n            happy: [\n                {\n                    type: 'exercise',\n                    title: 'Gratitude Journal',\n                    description: \"Write down three things you're grateful for to maintain your positive mood.\",\n                    actionUrl: '/resources/exercises/gratitude',\n                    actionText: 'Start Exercise'\n                },\n                {\n                    type: 'resource',\n                    title: 'Positive Psychology',\n                    description: 'Learn how to maintain and cultivate positive emotions.',\n                    actionUrl: '/resources/articles/positive-psychology',\n                    actionText: 'Read Article'\n                }\n            ],\n            // Sad state\n            sad: [\n                {\n                    type: 'exercise',\n                    title: 'Mood Lifting Activities',\n                    description: 'Simple activities that can help improve your mood when feeling down.',\n                    actionUrl: '/resources/exercises/mood-lifting',\n                    actionText: 'View Activities'\n                },\n                {\n                    type: 'resource',\n                    title: 'Understanding Sadness',\n                    description: 'Learn about sadness, its purpose, and healthy ways to process it.',\n                    actionUrl: '/resources/articles/understanding-sadness',\n                    actionText: 'Read Article'\n                },\n                {\n                    type: 'checkin',\n                    title: 'Daily Mood Tracker',\n                    description: 'Track your mood changes to identify patterns and improvements.',\n                    actionUrl: '/checkin',\n                    actionText: 'Start Tracking'\n                }\n            ],\n            // Anxious state\n            anxious: [\n                {\n                    type: 'exercise',\n                    title: 'Deep Breathing',\n                    description: 'A simple breathing exercise to help calm anxiety in the moment.',\n                    actionUrl: '/resources/exercises/deep-breathing',\n                    actionText: 'Start Exercise'\n                },\n                {\n                    type: 'exercise',\n                    title: 'Grounding Technique',\n                    description: 'Use your senses to ground yourself in the present moment.',\n                    actionUrl: '/resources/exercises/grounding',\n                    actionText: 'Try Now'\n                },\n                {\n                    type: 'resource',\n                    title: 'Coping with Anxiety',\n                    description: 'Learn effective strategies for managing anxiety.',\n                    actionUrl: '/resources/articles/anxiety-management',\n                    actionText: 'Read Article'\n                }\n            ],\n            // Stressed state\n            stressed: [\n                {\n                    type: 'exercise',\n                    title: 'Progressive Muscle Relaxation',\n                    description: 'Release physical tension to help reduce stress.',\n                    actionUrl: '/resources/exercises/muscle-relaxation',\n                    actionText: 'Start Exercise'\n                },\n                {\n                    type: 'resource',\n                    title: 'Stress Management',\n                    description: 'Learn effective techniques for managing stress in daily life.',\n                    actionUrl: '/resources/articles/stress-management',\n                    actionText: 'Read Article'\n                },\n                {\n                    type: 'checkin',\n                    title: 'Stress Journal',\n                    description: 'Identify your stress triggers and patterns.',\n                    actionUrl: '/checkin',\n                    actionText: 'Start Journal'\n                }\n            ],\n            // Angry state\n            angry: [\n                {\n                    type: 'exercise',\n                    title: 'Anger Cool-Down',\n                    description: 'Quick techniques to calm down when feeling angry.',\n                    actionUrl: '/resources/exercises/anger-cooldown',\n                    actionText: 'Start Exercise'\n                },\n                {\n                    type: 'resource',\n                    title: 'Healthy Expression of Anger',\n                    description: 'Learn constructive ways to express and process anger.',\n                    actionUrl: '/resources/articles/healthy-anger',\n                    actionText: 'Read Article'\n                }\n            ],\n            // Default/neutral state\n            neutral: [\n                {\n                    type: 'exercise',\n                    title: 'Mindfulness Meditation',\n                    description: 'A simple mindfulness practice to enhance awareness and presence.',\n                    actionUrl: '/resources/exercises/mindfulness',\n                    actionText: 'Start Meditation'\n                },\n                {\n                    type: 'resource',\n                    title: 'Mental Wellness Basics',\n                    description: 'Learn the foundations of maintaining good mental health.',\n                    actionUrl: '/resources/articles/mental-wellness',\n                    actionText: 'Read Article'\n                },\n                {\n                    type: 'checkin',\n                    title: 'Regular Check-In',\n                    description: \"Take a moment to check in with yourself and assess how you're feeling.\",\n                    actionUrl: '/checkin',\n                    actionText: 'Check In'\n                }\n            ]\n        };\n        // Convert emotional state to lowercase and remove any punctuation\n        const normalizedState = emotionalState.toLowerCase().replace(/[^\\w\\s]/gi, '');\n        // Map various emotional states to our predefined categories\n        let category = 'neutral';\n        if ([\n            'happy',\n            'joy',\n            'excited',\n            'content',\n            'pleased'\n        ].includes(normalizedState)) {\n            category = 'happy';\n        } else if ([\n            'sad',\n            'unhappy',\n            'depressed',\n            'down',\n            'blue',\n            'gloomy'\n        ].includes(normalizedState)) {\n            category = 'sad';\n        } else if ([\n            'anxious',\n            'worried',\n            'nervous',\n            'uneasy',\n            'fearful'\n        ].includes(normalizedState)) {\n            category = 'anxious';\n        } else if ([\n            'stressed',\n            'overwhelmed',\n            'pressured',\n            'burdened'\n        ].includes(normalizedState)) {\n            category = 'stressed';\n        } else if ([\n            'angry',\n            'mad',\n            'furious',\n            'irritated',\n            'annoyed'\n        ].includes(normalizedState)) {\n            category = 'angry';\n        } else if ([\n            'distressed',\n            'crisis',\n            'suicidal',\n            'desperate',\n            'hopeless'\n        ].includes(normalizedState)) {\n            category = 'distressed';\n        }\n        // Return recommendations for the identified category or neutral as fallback\n        return recommendations[category] || recommendations.neutral;\n    },\n    /**\r\n   * Generate recommendations based on emotional state (using full AI)\r\n   * This is a more expensive operation so should be used less frequently\r\n   * @param {string} emotionalState - Current emotional state\r\n   * @param {Object} userProfile - User profile information\r\n   * @returns {Promise<Array>} - List of recommendations\r\n   */ async generateRecommendations (emotionalState, userProfile = {}) {\n        try {\n            const userName = userProfile.name || \"the user\";\n            // Again using chat completions instead of completions\n            const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].post(`${LLAMA_API_URL}/v1/chat/completions`, {\n                messages: [\n                    {\n                        role: \"system\",\n                        content: `Generate 3 personalized mental health recommendations for someone who is feeling ${emotionalState}. Each recommendation should have a type (either 'exercise', 'resource', or 'checkin'), a title, a short description, and optionally an actionUrl and actionText. Respond with only a JSON array with the format: [{\"type\": \"exercise/resource/checkin\", \"title\": \"...\", \"description\": \"...\", \"actionUrl\": \"/path\", \"actionText\": \"...\"}]`\n                    },\n                    {\n                        role: \"user\",\n                        content: `I'm ${userName} and I'm feeling ${emotionalState}. What do you recommend?`\n                    }\n                ],\n                model: LLAMA_MODEL_NAME,\n                max_tokens: 500,\n                temperature: 0.7,\n                stream: false\n            }, {\n                timeout: 30000,\n                headers: {\n                    'Content-Type': 'application/json'\n                }\n            });\n            // Parse the JSON response\n            const responseText = response.data.choices[0].message.content.trim();\n            let recommendations;\n            try {\n                // Find JSON array in response if it's wrapped in other text\n                const jsonMatch = responseText.match(/(\\[.*\\])/s);\n                if (jsonMatch) {\n                    recommendations = JSON.parse(jsonMatch[0]);\n                } else {\n                    recommendations = JSON.parse(responseText);\n                }\n            } catch (parseError) {\n                console.error('Error parsing recommendations JSON:', parseError, 'Raw response:', responseText);\n                // Use quick recommendations instead\n                return this.getQuickRecommendations(emotionalState);\n            }\n            return recommendations;\n        } catch (error) {\n            console.error('Error generating recommendations with LLaMA:', error);\n            if (error.response) {\n                console.error('Error data:', error.response.data);\n                console.error('Error status:', error.response.status);\n            } else if (error.request) {\n                console.error('No response received:', error.request);\n            }\n            // Use quick recommendations instead\n            return this.getQuickRecommendations(emotionalState);\n        }\n    }\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9sbGFtYS1zZXJ2aWNlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQTBCO0FBRTFCLDBDQUEwQztBQUMxQyxrREFBa0Q7QUFDbEQsTUFBTUMsZ0JBQWdCQyx3QkFBcUMsSUFBSSxDQUF3QjtBQUN2RixNQUFNRyxtQkFBbUJILGlCQUF3QyxJQUFJLENBQWlCO0FBRXRGOztDQUVDLEdBQ00sTUFBTUssZUFBZTtJQUMxQjs7Ozs7R0FLQyxHQUNELE1BQU1DLGdCQUFlQyxPQUFPLEVBQUVDLFVBQVUsRUFBRTtRQUN4QyxJQUFJO1lBQ0Ysd0NBQXdDO1lBQ3hDLE1BQU1DLG1CQUFtQkQsUUFBUUUsR0FBRyxDQUFDQyxDQUFBQSxNQUFRO29CQUMzQ0MsTUFBTUQsSUFBSUMsSUFBSSxJQUFJO29CQUNsQkMsU0FBU0YsSUFBSUUsT0FBTztnQkFDdEI7WUFFQSw0REFBNEQ7WUFDNURKLGlCQUFpQkssT0FBTyxDQUFDO2dCQUN2QkYsTUFBTTtnQkFDTkMsU0FBUyxDQUFDLHFKQUFxSixDQUFDO1lBQ2xLO1lBRUEsaUNBQWlDO1lBQ2pDSixpQkFBaUJNLElBQUksQ0FBQztnQkFDcEJILE1BQU07Z0JBQ05DLFNBQVNOO1lBQ1g7WUFFQVMsUUFBUUMsR0FBRyxDQUFDO1lBRVosdUJBQXVCO1lBQ3ZCLE1BQU1DLFdBQVcsTUFBTXBCLGtEQUFVLENBQUMsR0FBR0MsY0FBYyxvQkFBb0IsQ0FBQyxFQUFFO2dCQUN4RXFCLFVBQVVYO2dCQUNWWSxPQUFPbEI7Z0JBQ1BtQixhQUFhO2dCQUNiQyxZQUFZO2dCQUNaQyxRQUFRO1lBQ1YsR0FBRztnQkFDRCxnQ0FBZ0M7Z0JBQ2hDQyxTQUFTO2dCQUNUQyxTQUFTO29CQUNQLGdCQUFnQjtnQkFDbEI7WUFDRjtZQUVBVixRQUFRQyxHQUFHLENBQUM7WUFFWixPQUFPO2dCQUNMQyxVQUFVQSxTQUFTUyxJQUFJLENBQUNDLE9BQU8sQ0FBQyxFQUFFLENBQUNyQixPQUFPLENBQUNNLE9BQU87WUFDcEQ7UUFDRixFQUFFLE9BQU9nQixPQUFPO1lBQ2RiLFFBQVFhLEtBQUssQ0FBQyxvQ0FBb0NBO1lBQ2xELElBQUlBLE1BQU1YLFFBQVEsRUFBRTtnQkFDbEJGLFFBQVFhLEtBQUssQ0FBQyxlQUFlQSxNQUFNWCxRQUFRLENBQUNTLElBQUk7Z0JBQ2hEWCxRQUFRYSxLQUFLLENBQUMsaUJBQWlCQSxNQUFNWCxRQUFRLENBQUNZLE1BQU07WUFDdEQsT0FBTyxJQUFJRCxNQUFNRSxPQUFPLEVBQUU7Z0JBQ3hCZixRQUFRYSxLQUFLLENBQUMseUJBQXlCQSxNQUFNRSxPQUFPO1lBQ3REO1lBQ0EsTUFBTSxJQUFJQyxNQUFNO1FBQ2xCO0lBQ0Y7SUFFQTs7OztHQUlDLEdBQ0QsTUFBTUMsdUJBQXNCMUIsT0FBTztRQUNqQyxJQUFJO1lBQ0YsdURBQXVEO1lBQ3ZELE1BQU0yQixlQUFlM0IsUUFBUTRCLFdBQVc7WUFDeEMsSUFBSUMsWUFBWTtZQUNoQixJQUFJQyxpQkFBaUI7WUFDckIsSUFBSUMsYUFBYTtZQUVqQiw2Q0FBNkM7WUFDN0MsTUFBTUMsZ0JBQWdCO2dCQUFDO2dCQUFTO2dCQUFRO2dCQUFTO2dCQUFRO2dCQUFZO2dCQUFhO2dCQUFXO2dCQUFRO2FBQVE7WUFDN0csTUFBTUMsZ0JBQWdCO2dCQUFDO2dCQUFPO2dCQUFTO2dCQUFTO2dCQUFjO2dCQUFhO2dCQUFXO2dCQUFXO2dCQUFVO2FBQU87WUFFbEgsSUFBSUMsZ0JBQWdCO1lBQ3BCLElBQUlDLGdCQUFnQjtZQUVwQkgsY0FBY0ksT0FBTyxDQUFDQyxDQUFBQTtnQkFDcEIsSUFBSVYsYUFBYVcsUUFBUSxDQUFDRCxPQUFPSDtZQUNuQztZQUVBRCxjQUFjRyxPQUFPLENBQUNDLENBQUFBO2dCQUNwQixJQUFJVixhQUFhVyxRQUFRLENBQUNELE9BQU9GO1lBQ25DO1lBRUEsSUFBSUQsZ0JBQWdCQyxlQUFlO2dCQUNqQ04sWUFBWTtnQkFDWkMsaUJBQWlCO2dCQUNqQkMsYUFBYSxNQUFPLE1BQU1RLEtBQUtDLEdBQUcsQ0FBQ04sZUFBZTtZQUNwRCxPQUFPLElBQUlDLGdCQUFnQkQsZUFBZTtnQkFDeENMLFlBQVk7Z0JBRVosc0NBQXNDO2dCQUN0QyxJQUFJRixhQUFhVyxRQUFRLENBQUMsY0FBY1gsYUFBYVcsUUFBUSxDQUFDLFlBQVlYLGFBQWFXLFFBQVEsQ0FBQyxZQUFZO29CQUMxR1IsaUJBQWlCO2dCQUNuQixPQUFPLElBQUlILGFBQWFXLFFBQVEsQ0FBQyxVQUFVWCxhQUFhVyxRQUFRLENBQUMsWUFBWTtvQkFDM0VSLGlCQUFpQjtnQkFDbkIsT0FBTyxJQUFJSCxhQUFhVyxRQUFRLENBQUMsWUFBWVgsYUFBYVcsUUFBUSxDQUFDLFlBQVlYLGFBQWFXLFFBQVEsQ0FBQyxhQUFhO29CQUNoSFIsaUJBQWlCO2dCQUNuQixPQUFPLElBQUlILGFBQWFXLFFBQVEsQ0FBQyxXQUFXO29CQUMxQ1IsaUJBQWlCO2dCQUNuQixPQUFPO29CQUNMQSxpQkFBaUI7Z0JBQ25CO2dCQUVBQyxhQUFhLE1BQU8sTUFBTVEsS0FBS0MsR0FBRyxDQUFDTCxlQUFlO1lBQ3BEO1lBRUEsNEVBQTRFO1lBQzVFLElBQUlELGtCQUFrQixLQUFLQyxrQkFBa0IsR0FBRztnQkFDOUMsT0FBTyxJQUFJLENBQUNNLG9CQUFvQixDQUFDekM7WUFDbkM7WUFFQSxPQUFPO2dCQUNMNkIsV0FBV0E7Z0JBQ1hhLFVBQVU7b0JBQ1JDLFNBQVNiO29CQUNUQyxZQUFZQTtnQkFDZDtZQUNGO1FBQ0YsRUFBRSxPQUFPVCxPQUFPO1lBQ2RiLFFBQVFhLEtBQUssQ0FBQyxzQ0FBc0NBO1lBQ3BELE9BQU87Z0JBQ0xPLFdBQVc7Z0JBQ1hhLFVBQVU7b0JBQ1JDLFNBQVM7b0JBQ1RaLFlBQVk7Z0JBQ2Q7WUFDRjtRQUNGO0lBQ0Y7SUFFQTs7OztHQUlDLEdBQ0QsTUFBTVUsc0JBQXFCekMsT0FBTztRQUNoQyxJQUFJO1lBQ0Ysb0VBQW9FO1lBQ3BFLDBEQUEwRDtZQUMxRCxNQUFNVyxXQUFXLE1BQU1wQixrREFBVSxDQUFDLEdBQUdDLGNBQWMsb0JBQW9CLENBQUMsRUFBRTtnQkFDeEVxQixVQUFVO29CQUNSO3dCQUNFUixNQUFNO3dCQUNOQyxTQUFTO29CQUNYO29CQUNBO3dCQUNFRCxNQUFNO3dCQUNOQyxTQUFTTjtvQkFDWDtpQkFDRDtnQkFDRGMsT0FBT2xCO2dCQUNQb0IsWUFBWTtnQkFDWkQsYUFBYTtnQkFDYkUsUUFBUTtZQUNWLEdBQUc7Z0JBQ0RDLFNBQVM7Z0JBQ1RDLFNBQVM7b0JBQ1AsZ0JBQWdCO2dCQUNsQjtZQUNGO1lBRUEsMEJBQTBCO1lBQzFCLE1BQU15QixlQUFlakMsU0FBU1MsSUFBSSxDQUFDQyxPQUFPLENBQUMsRUFBRSxDQUFDckIsT0FBTyxDQUFDTSxPQUFPLENBQUN1QyxJQUFJO1lBQ2xFLElBQUlDO1lBRUosSUFBSTtnQkFDRiw2REFBNkQ7Z0JBQzdELE1BQU1DLFlBQVlILGFBQWFJLEtBQUssQ0FBQztnQkFDckMsSUFBSUQsV0FBVztvQkFDYkQsY0FBY0csS0FBS0MsS0FBSyxDQUFDSCxTQUFTLENBQUMsRUFBRTtnQkFDdkMsT0FBTztvQkFDTEQsY0FBY0csS0FBS0MsS0FBSyxDQUFDTjtnQkFDM0I7WUFDRixFQUFFLE9BQU9PLFlBQVk7Z0JBQ25CMUMsUUFBUWEsS0FBSyxDQUFDLGlDQUFpQzZCLFlBQVksaUJBQWlCUDtnQkFDNUUsOEJBQThCO2dCQUM5QixPQUFPO29CQUNMZixXQUFXO29CQUNYYSxVQUFVO3dCQUNSQyxTQUFTO3dCQUNUWixZQUFZO29CQUNkO2dCQUNGO1lBQ0Y7WUFFQSxPQUFPO2dCQUNMRixXQUFXaUIsWUFBWWpCLFNBQVMsSUFBSTtnQkFDcENhLFVBQVU7b0JBQ1JDLFNBQVNHLFlBQVlNLGVBQWUsSUFBSTtvQkFDeENyQixZQUFZZSxZQUFZZixVQUFVLElBQUk7Z0JBQ3hDO1lBQ0Y7UUFDRixFQUFFLE9BQU9ULE9BQU87WUFDZGIsUUFBUWEsS0FBSyxDQUFDLHlDQUF5Q0E7WUFDdkQsSUFBSUEsTUFBTVgsUUFBUSxFQUFFO2dCQUNsQkYsUUFBUWEsS0FBSyxDQUFDLGVBQWVBLE1BQU1YLFFBQVEsQ0FBQ1MsSUFBSTtnQkFDaERYLFFBQVFhLEtBQUssQ0FBQyxpQkFBaUJBLE1BQU1YLFFBQVEsQ0FBQ1ksTUFBTTtZQUN0RCxPQUFPLElBQUlELE1BQU1FLE9BQU8sRUFBRTtnQkFDeEJmLFFBQVFhLEtBQUssQ0FBQyx5QkFBeUJBLE1BQU1FLE9BQU87WUFDdEQ7WUFFQSw2REFBNkQ7WUFDN0QsT0FBTztnQkFDTEssV0FBVztnQkFDWGEsVUFBVTtvQkFDUkMsU0FBUztvQkFDVFosWUFBWTtnQkFDZDtZQUNGO1FBQ0Y7SUFDRjtJQUVBOzs7O0dBSUMsR0FDRHNCLHlCQUF3QkMsY0FBYztRQUNwQyxNQUFNQyxrQkFBa0I7WUFDdEIsd0JBQXdCO1lBQ3hCQyxZQUFZO2dCQUNWO29CQUNFQyxNQUFNO29CQUNOQyxPQUFPO29CQUNQQyxhQUFhO29CQUNiQyxXQUFXO29CQUNYQyxZQUFZO2dCQUNkO2dCQUNBO29CQUNFSixNQUFNO29CQUNOQyxPQUFPO29CQUNQQyxhQUFhO29CQUNiQyxXQUFXO29CQUNYQyxZQUFZO2dCQUNkO2dCQUNBO29CQUNFSixNQUFNO29CQUNOQyxPQUFPO29CQUNQQyxhQUFhO29CQUNiQyxXQUFXO29CQUNYQyxZQUFZO2dCQUNkO2FBQ0Q7WUFDRCxjQUFjO1lBQ2RDLE9BQU87Z0JBQ0w7b0JBQ0VMLE1BQU07b0JBQ05DLE9BQU87b0JBQ1BDLGFBQWE7b0JBQ2JDLFdBQVc7b0JBQ1hDLFlBQVk7Z0JBQ2Q7Z0JBQ0E7b0JBQ0VKLE1BQU07b0JBQ05DLE9BQU87b0JBQ1BDLGFBQWE7b0JBQ2JDLFdBQVc7b0JBQ1hDLFlBQVk7Z0JBQ2Q7YUFDRDtZQUNELFlBQVk7WUFDWkUsS0FBSztnQkFDSDtvQkFDRU4sTUFBTTtvQkFDTkMsT0FBTztvQkFDUEMsYUFBYTtvQkFDYkMsV0FBVztvQkFDWEMsWUFBWTtnQkFDZDtnQkFDQTtvQkFDRUosTUFBTTtvQkFDTkMsT0FBTztvQkFDUEMsYUFBYTtvQkFDYkMsV0FBVztvQkFDWEMsWUFBWTtnQkFDZDtnQkFDQTtvQkFDRUosTUFBTTtvQkFDTkMsT0FBTztvQkFDUEMsYUFBYTtvQkFDYkMsV0FBVztvQkFDWEMsWUFBWTtnQkFDZDthQUNEO1lBQ0QsZ0JBQWdCO1lBQ2hCRyxTQUFTO2dCQUNQO29CQUNFUCxNQUFNO29CQUNOQyxPQUFPO29CQUNQQyxhQUFhO29CQUNiQyxXQUFXO29CQUNYQyxZQUFZO2dCQUNkO2dCQUNBO29CQUNFSixNQUFNO29CQUNOQyxPQUFPO29CQUNQQyxhQUFhO29CQUNiQyxXQUFXO29CQUNYQyxZQUFZO2dCQUNkO2dCQUNBO29CQUNFSixNQUFNO29CQUNOQyxPQUFPO29CQUNQQyxhQUFhO29CQUNiQyxXQUFXO29CQUNYQyxZQUFZO2dCQUNkO2FBQ0Q7WUFDRCxpQkFBaUI7WUFDakJJLFVBQVU7Z0JBQ1I7b0JBQ0VSLE1BQU07b0JBQ05DLE9BQU87b0JBQ1BDLGFBQWE7b0JBQ2JDLFdBQVc7b0JBQ1hDLFlBQVk7Z0JBQ2Q7Z0JBQ0E7b0JBQ0VKLE1BQU07b0JBQ05DLE9BQU87b0JBQ1BDLGFBQWE7b0JBQ2JDLFdBQVc7b0JBQ1hDLFlBQVk7Z0JBQ2Q7Z0JBQ0E7b0JBQ0VKLE1BQU07b0JBQ05DLE9BQU87b0JBQ1BDLGFBQWE7b0JBQ2JDLFdBQVc7b0JBQ1hDLFlBQVk7Z0JBQ2Q7YUFDRDtZQUNELGNBQWM7WUFDZEssT0FBTztnQkFDTDtvQkFDRVQsTUFBTTtvQkFDTkMsT0FBTztvQkFDUEMsYUFBYTtvQkFDYkMsV0FBVztvQkFDWEMsWUFBWTtnQkFDZDtnQkFDQTtvQkFDRUosTUFBTTtvQkFDTkMsT0FBTztvQkFDUEMsYUFBYTtvQkFDYkMsV0FBVztvQkFDWEMsWUFBWTtnQkFDZDthQUNEO1lBQ0Qsd0JBQXdCO1lBQ3hCTSxTQUFTO2dCQUNQO29CQUNFVixNQUFNO29CQUNOQyxPQUFPO29CQUNQQyxhQUFhO29CQUNiQyxXQUFXO29CQUNYQyxZQUFZO2dCQUNkO2dCQUNBO29CQUNFSixNQUFNO29CQUNOQyxPQUFPO29CQUNQQyxhQUFhO29CQUNiQyxXQUFXO29CQUNYQyxZQUFZO2dCQUNkO2dCQUNBO29CQUNFSixNQUFNO29CQUNOQyxPQUFPO29CQUNQQyxhQUFhO29CQUNiQyxXQUFXO29CQUNYQyxZQUFZO2dCQUNkO2FBQ0Q7UUFDSDtRQUVBLGtFQUFrRTtRQUNsRSxNQUFNTyxrQkFBa0JkLGVBQWUxQixXQUFXLEdBQUd5QyxPQUFPLENBQUMsYUFBYTtRQUUxRSw0REFBNEQ7UUFDNUQsSUFBSUMsV0FBVztRQUNmLElBQUk7WUFBQztZQUFTO1lBQU87WUFBVztZQUFXO1NBQVUsQ0FBQ2hDLFFBQVEsQ0FBQzhCLGtCQUFrQjtZQUMvRUUsV0FBVztRQUNiLE9BQU8sSUFBSTtZQUFDO1lBQU87WUFBVztZQUFhO1lBQVE7WUFBUTtTQUFTLENBQUNoQyxRQUFRLENBQUM4QixrQkFBa0I7WUFDOUZFLFdBQVc7UUFDYixPQUFPLElBQUk7WUFBQztZQUFXO1lBQVc7WUFBVztZQUFVO1NBQVUsQ0FBQ2hDLFFBQVEsQ0FBQzhCLGtCQUFrQjtZQUMzRkUsV0FBVztRQUNiLE9BQU8sSUFBSTtZQUFDO1lBQVk7WUFBZTtZQUFhO1NBQVcsQ0FBQ2hDLFFBQVEsQ0FBQzhCLGtCQUFrQjtZQUN6RkUsV0FBVztRQUNiLE9BQU8sSUFBSTtZQUFDO1lBQVM7WUFBTztZQUFXO1lBQWE7U0FBVSxDQUFDaEMsUUFBUSxDQUFDOEIsa0JBQWtCO1lBQ3hGRSxXQUFXO1FBQ2IsT0FBTyxJQUFJO1lBQUM7WUFBYztZQUFVO1lBQVk7WUFBYTtTQUFXLENBQUNoQyxRQUFRLENBQUM4QixrQkFBa0I7WUFDbEdFLFdBQVc7UUFDYjtRQUVBLDRFQUE0RTtRQUM1RSxPQUFPZixlQUFlLENBQUNlLFNBQVMsSUFBSWYsZ0JBQWdCWSxPQUFPO0lBQzdEO0lBRUE7Ozs7OztHQU1DLEdBQ0QsTUFBTUkseUJBQXdCakIsY0FBYyxFQUFFa0IsY0FBYyxDQUFDLENBQUM7UUFDNUQsSUFBSTtZQUNGLE1BQU1DLFdBQVdELFlBQVlFLElBQUksSUFBSTtZQUVyQyxzREFBc0Q7WUFDdEQsTUFBTS9ELFdBQVcsTUFBTXBCLGtEQUFVLENBQUMsR0FBR0MsY0FBYyxvQkFBb0IsQ0FBQyxFQUFFO2dCQUN4RXFCLFVBQVU7b0JBQ1I7d0JBQ0VSLE1BQU07d0JBQ05DLFNBQVMsQ0FBQyxpRkFBaUYsRUFBRWdELGVBQWUsMFVBQTBVLENBQUM7b0JBQ3piO29CQUNBO3dCQUNFakQsTUFBTTt3QkFDTkMsU0FBUyxDQUFDLElBQUksRUFBRW1FLFNBQVMsaUJBQWlCLEVBQUVuQixlQUFlLHdCQUF3QixDQUFDO29CQUN0RjtpQkFDRDtnQkFDRHhDLE9BQU9sQjtnQkFDUG9CLFlBQVk7Z0JBQ1pELGFBQWE7Z0JBQ2JFLFFBQVE7WUFDVixHQUFHO2dCQUNEQyxTQUFTO2dCQUNUQyxTQUFTO29CQUNQLGdCQUFnQjtnQkFDbEI7WUFDRjtZQUVBLDBCQUEwQjtZQUMxQixNQUFNeUIsZUFBZWpDLFNBQVNTLElBQUksQ0FBQ0MsT0FBTyxDQUFDLEVBQUUsQ0FBQ3JCLE9BQU8sQ0FBQ00sT0FBTyxDQUFDdUMsSUFBSTtZQUNsRSxJQUFJVTtZQUVKLElBQUk7Z0JBQ0YsNERBQTREO2dCQUM1RCxNQUFNUixZQUFZSCxhQUFhSSxLQUFLLENBQUM7Z0JBQ3JDLElBQUlELFdBQVc7b0JBQ2JRLGtCQUFrQk4sS0FBS0MsS0FBSyxDQUFDSCxTQUFTLENBQUMsRUFBRTtnQkFDM0MsT0FBTztvQkFDTFEsa0JBQWtCTixLQUFLQyxLQUFLLENBQUNOO2dCQUMvQjtZQUNGLEVBQUUsT0FBT08sWUFBWTtnQkFDbkIxQyxRQUFRYSxLQUFLLENBQUMsdUNBQXVDNkIsWUFBWSxpQkFBaUJQO2dCQUNsRixvQ0FBb0M7Z0JBQ3BDLE9BQU8sSUFBSSxDQUFDUyx1QkFBdUIsQ0FBQ0M7WUFDdEM7WUFFQSxPQUFPQztRQUNULEVBQUUsT0FBT2pDLE9BQU87WUFDZGIsUUFBUWEsS0FBSyxDQUFDLGdEQUFnREE7WUFDOUQsSUFBSUEsTUFBTVgsUUFBUSxFQUFFO2dCQUNsQkYsUUFBUWEsS0FBSyxDQUFDLGVBQWVBLE1BQU1YLFFBQVEsQ0FBQ1MsSUFBSTtnQkFDaERYLFFBQVFhLEtBQUssQ0FBQyxpQkFBaUJBLE1BQU1YLFFBQVEsQ0FBQ1ksTUFBTTtZQUN0RCxPQUFPLElBQUlELE1BQU1FLE9BQU8sRUFBRTtnQkFDeEJmLFFBQVFhLEtBQUssQ0FBQyx5QkFBeUJBLE1BQU1FLE9BQU87WUFDdEQ7WUFFQSxvQ0FBb0M7WUFDcEMsT0FBTyxJQUFJLENBQUM2Qix1QkFBdUIsQ0FBQ0M7UUFDdEM7SUFDRjtBQUNGLEVBQUUiLCJzb3VyY2VzIjpbIkQ6XFxQcm9qZWN0c1xcRGVraHRlIGhhaVxcbmV1cm9TeW5jXFxOZXVyb1N5bmMtQUktRnJvbnRlbmRcXGxpYlxcbGxhbWEtc2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xyXG5cclxuLy8gQ29uZmlndXJhdGlvbiBmb3IgbG9jYWwgTExhTUEgMy4yIG1vZGVsXHJcbi8vIFVzZSBJUHY0IGZvcm1hdCB0byBhdm9pZCBJUHY2IGNvbm5lY3Rpb24gaXNzdWVzXHJcbmNvbnN0IExMQU1BX0FQSV9VUkwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19MTEFNQV9BUElfVVJMIHx8ICdodHRwOi8vMTI3LjAuMC4xOjExNDM0JztcclxuY29uc3QgTExBTUFfTU9ERUxfTkFNRSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0xMQU1BX01PREVMX05BTUUgfHwgJ2xsYW1hMy4yOmxhdGVzdCc7XHJcblxyXG4vKipcclxuICogU2VydmljZSB0byBpbnRlcmFjdCB3aXRoIGxvY2FsbHkgaG9zdGVkIExMYU1BIDMuMiBtb2RlbFxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGxsYW1hU2VydmljZSA9IHtcclxuICAvKipcclxuICAgKiBQcm9jZXNzIGEgY2hhdCBtZXNzYWdlIHVzaW5nIGxvY2FsIExMYU1BIDMuMiBtb2RlbFxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gVXNlcidzIG1lc3NhZ2VcclxuICAgKiBAcGFyYW0ge0FycmF5fSBoaXN0b3J5IC0gUHJldmlvdXMgY2hhdCBoaXN0b3J5IGZvciBjb250ZXh0XHJcbiAgICogQHJldHVybnMge1Byb21pc2U8e3Jlc3BvbnNlOiBzdHJpbmd9Pn1cclxuICAgKi9cclxuICBhc3luYyBwcm9jZXNzTWVzc2FnZShtZXNzYWdlLCBoaXN0b3J5ID0gW10pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIEZvcm1hdCBoaXN0b3J5IGluIGEgd2F5IExMYU1BIGV4cGVjdHNcclxuICAgICAgY29uc3QgZm9ybWF0dGVkSGlzdG9yeSA9IGhpc3RvcnkubWFwKG1zZyA9PiAoe1xyXG4gICAgICAgIHJvbGU6IG1zZy5yb2xlIHx8ICd1c2VyJyxcclxuICAgICAgICBjb250ZW50OiBtc2cuY29udGVudFxyXG4gICAgICB9KSk7XHJcblxyXG4gICAgICAvLyBBZGQgc3lzdGVtIG1lc3NhZ2UgdG8gZW5oYW5jZSB0aGUgcmVzcG9uc2Ugd2l0aCBzZW50aW1lbnRcclxuICAgICAgZm9ybWF0dGVkSGlzdG9yeS51bnNoaWZ0KHtcclxuICAgICAgICByb2xlOiAnc3lzdGVtJyxcclxuICAgICAgICBjb250ZW50OiBgWW91IGFyZSBhIG1lbnRhbCBoZWFsdGggYXNzaXN0YW50LiBXaGVuIHJlc3BvbmRpbmcsIGlkZW50aWZ5IHRoZSB1c2VyJ3MgZW1vdGlvbmFsIHN0YXRlIGFuZCBiZSBlbXBhdGhldGljLiBZb3VyIHJlc3BvbnNlIHNob3VsZCBiZSBjbGVhciBhbmQgY29uY2lzZS5gXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gQWRkIGN1cnJlbnQgbWVzc2FnZSB0byBoaXN0b3J5XHJcbiAgICAgIGZvcm1hdHRlZEhpc3RvcnkucHVzaCh7XHJcbiAgICAgICAgcm9sZTogJ3VzZXInLFxyXG4gICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2VcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zb2xlLmxvZygnQ2FsbGluZyBMTGFNQSBBUEkgZm9yIGNoYXQgcmVzcG9uc2UnKTtcclxuXHJcbiAgICAgIC8vIENhbGwgbG9jYWwgTExhTUEgQVBJXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdChgJHtMTEFNQV9BUElfVVJMfS92MS9jaGF0L2NvbXBsZXRpb25zYCwge1xyXG4gICAgICAgIG1lc3NhZ2VzOiBmb3JtYXR0ZWRIaXN0b3J5LFxyXG4gICAgICAgIG1vZGVsOiBMTEFNQV9NT0RFTF9OQU1FLFxyXG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLjcsXHJcbiAgICAgICAgbWF4X3Rva2VuczogMTAwMCxcclxuICAgICAgICBzdHJlYW06IGZhbHNlXHJcbiAgICAgIH0sIHtcclxuICAgICAgICAvLyBDb25maWd1cmUgdGltZW91dCBhbmQgaGVhZGVyc1xyXG4gICAgICAgIHRpbWVvdXQ6IDYwMDAwLFxyXG4gICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc29sZS5sb2coJ0xMYU1BIHJlc3BvbnNlIHJlY2VpdmVkJyk7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlc3BvbnNlOiByZXNwb25zZS5kYXRhLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50LFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2FsbGluZyBsb2NhbCBMTGFNQSBtb2RlbDonLCBlcnJvcik7XHJcbiAgICAgIGlmIChlcnJvci5yZXNwb25zZSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGRhdGE6JywgZXJyb3IucmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc3RhdHVzOicsIGVycm9yLnJlc3BvbnNlLnN0YXR1cyk7XHJcbiAgICAgIH0gZWxzZSBpZiAoZXJyb3IucmVxdWVzdCkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ05vIHJlc3BvbnNlIHJlY2VpdmVkOicsIGVycm9yLnJlcXVlc3QpO1xyXG4gICAgICB9XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGdldCByZXNwb25zZSBmcm9tIExMYU1BIG1vZGVsJyk7XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogQW5hbHl6ZSBzZW50aW1lbnQgaW4gYSBtZXNzYWdlIC0gc2ltcGxpZmllZCB2ZXJzaW9uXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSBNZXNzYWdlIHRvIGFuYWx5emVcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTx7c2VudGltZW50OiBzdHJpbmcsIGVtb3Rpb25zOiBPYmplY3R9Pn1cclxuICAgKi9cclxuICBhc3luYyBxdWlja0FuYWx5emVTZW50aW1lbnQobWVzc2FnZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gU2ltcGxlIHBhdHRlcm4gbWF0Y2hpbmcgZm9yIHF1aWNrIHNlbnRpbWVudCBhbmFseXNpc1xyXG4gICAgICBjb25zdCBsb3dlck1lc3NhZ2UgPSBtZXNzYWdlLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIGxldCBzZW50aW1lbnQgPSAnbmV1dHJhbCc7XHJcbiAgICAgIGxldCBwcmltYXJ5RW1vdGlvbiA9ICduZXV0cmFsJztcclxuICAgICAgbGV0IGNvbmZpZGVuY2UgPSAwLjY7XHJcbiAgICAgIFxyXG4gICAgICAvLyBTaW1wbGUga2V5d29yZCBtYXRjaGluZyBmb3IgcXVpY2sgYW5hbHlzaXNcclxuICAgICAgY29uc3QgcG9zaXRpdmVXb3JkcyA9IFsnaGFwcHknLCAnZ2xhZCcsICdncmVhdCcsICdnb29kJywgJ3Bvc2l0aXZlJywgJ3dvbmRlcmZ1bCcsICdleGNpdGVkJywgJ2xvdmUnLCAnZW5qb3knXTtcclxuICAgICAgY29uc3QgbmVnYXRpdmVXb3JkcyA9IFsnc2FkJywgJ3Vwc2V0JywgJ2FuZ3J5JywgJ2ZydXN0cmF0ZWQnLCAnZGVwcmVzc2VkJywgJ2FueGlvdXMnLCAnd29ycmllZCcsICdzdHJlc3MnLCAnZmVhciddO1xyXG4gICAgICBcclxuICAgICAgbGV0IHBvc2l0aXZlQ291bnQgPSAwO1xyXG4gICAgICBsZXQgbmVnYXRpdmVDb3VudCA9IDA7XHJcbiAgICAgIFxyXG4gICAgICBwb3NpdGl2ZVdvcmRzLmZvckVhY2god29yZCA9PiB7XHJcbiAgICAgICAgaWYgKGxvd2VyTWVzc2FnZS5pbmNsdWRlcyh3b3JkKSkgcG9zaXRpdmVDb3VudCsrO1xyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIG5lZ2F0aXZlV29yZHMuZm9yRWFjaCh3b3JkID0+IHtcclxuICAgICAgICBpZiAobG93ZXJNZXNzYWdlLmluY2x1ZGVzKHdvcmQpKSBuZWdhdGl2ZUNvdW50Kys7XHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgaWYgKHBvc2l0aXZlQ291bnQgPiBuZWdhdGl2ZUNvdW50KSB7XHJcbiAgICAgICAgc2VudGltZW50ID0gJ3Bvc2l0aXZlJztcclxuICAgICAgICBwcmltYXJ5RW1vdGlvbiA9ICdoYXBweSc7XHJcbiAgICAgICAgY29uZmlkZW5jZSA9IDAuNyArICgwLjEgKiBNYXRoLm1pbihwb3NpdGl2ZUNvdW50LCAzKSk7XHJcbiAgICAgIH0gZWxzZSBpZiAobmVnYXRpdmVDb3VudCA+IHBvc2l0aXZlQ291bnQpIHtcclxuICAgICAgICBzZW50aW1lbnQgPSAnbmVnYXRpdmUnO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIERldGVybWluZSBzcGVjaWZpYyBuZWdhdGl2ZSBlbW90aW9uXHJcbiAgICAgICAgaWYgKGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnYW54aW91cycpIHx8IGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnd29ycnknKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ25lcnZvdXMnKSkge1xyXG4gICAgICAgICAgcHJpbWFyeUVtb3Rpb24gPSAnYW54aW91cyc7XHJcbiAgICAgICAgfSBlbHNlIGlmIChsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ3NhZCcpIHx8IGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnZGVwcmVzcycpKSB7XHJcbiAgICAgICAgICBwcmltYXJ5RW1vdGlvbiA9ICdzYWQnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobG93ZXJNZXNzYWdlLmluY2x1ZGVzKCdhbmdlcicpIHx8IGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnYW5ncnknKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ2ZydXN0cmF0JykpIHtcclxuICAgICAgICAgIHByaW1hcnlFbW90aW9uID0gJ2FuZ3J5JztcclxuICAgICAgICB9IGVsc2UgaWYgKGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnc3RyZXNzJykpIHtcclxuICAgICAgICAgIHByaW1hcnlFbW90aW9uID0gJ3N0cmVzc2VkJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcHJpbWFyeUVtb3Rpb24gPSAnc2FkJztcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uZmlkZW5jZSA9IDAuNyArICgwLjEgKiBNYXRoLm1pbihuZWdhdGl2ZUNvdW50LCAzKSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIE9ubHkgZG8gZnVsbCBBSSBzZW50aW1lbnQgYW5hbHlzaXMgaWYgd2UgY291bGRuJ3QgZGV0ZXJtaW5lIGZyb20ga2V5d29yZHNcclxuICAgICAgaWYgKHBvc2l0aXZlQ291bnQgPT09IDAgJiYgbmVnYXRpdmVDb3VudCA9PT0gMCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmZ1bGxBbmFseXplU2VudGltZW50KG1lc3NhZ2UpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHNlbnRpbWVudDogc2VudGltZW50LFxyXG4gICAgICAgIGVtb3Rpb25zOiB7XHJcbiAgICAgICAgICBwcmltYXJ5OiBwcmltYXJ5RW1vdGlvbixcclxuICAgICAgICAgIGNvbmZpZGVuY2U6IGNvbmZpZGVuY2VcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBxdWljayBzZW50aW1lbnQgYW5hbHlzaXM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHNlbnRpbWVudDogJ25ldXRyYWwnLFxyXG4gICAgICAgIGVtb3Rpb25zOiB7XHJcbiAgICAgICAgICBwcmltYXJ5OiAnbmV1dHJhbCcsXHJcbiAgICAgICAgICBjb25maWRlbmNlOiAwLjVcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogQW5hbHl6ZSBzZW50aW1lbnQgaW4gYSBtZXNzYWdlIHVzaW5nIExMYU1BIC0gZnVsbCBhbmFseXNpc1xyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gTWVzc2FnZSB0byBhbmFseXplXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8e3NlbnRpbWVudDogc3RyaW5nLCBlbW90aW9uczogT2JqZWN0fT59XHJcbiAgICovXHJcbiAgYXN5bmMgZnVsbEFuYWx5emVTZW50aW1lbnQobWVzc2FnZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gSW5zdGVhZCBvZiB1c2luZyBjb21wbGV0aW9ucyBlbmRwb2ludCwgd2UnbGwgdXNlIGNoYXQgY29tcGxldGlvbnNcclxuICAgICAgLy8gd2hpY2ggaXMgbW9yZSBjb21tb25seSBzdXBwb3J0ZWQgaW4gbG9jYWwgTExhTUEgc2VydmVyc1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLnBvc3QoYCR7TExBTUFfQVBJX1VSTH0vdjEvY2hhdC9jb21wbGV0aW9uc2AsIHtcclxuICAgICAgICBtZXNzYWdlczogW1xyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICByb2xlOiBcInN5c3RlbVwiLFxyXG4gICAgICAgICAgICBjb250ZW50OiBcIllvdSBhcmUgYSBzZW50aW1lbnQgYW5hbHlzaXMgYXNzaXN0YW50LiBBbmFseXplIHRoZSBlbW90aW9uYWwgc2VudGltZW50IG9mIHRoZSB1c2VyJ3MgbWVzc2FnZSBhbmQgcmVzcG9uZCB3aXRoIG9ubHkgYSBKU09OIG9iamVjdCB3aXRoIHRoZSBmb3JtYXQ6IHtcXFwic2VudGltZW50XFxcIjogXFxcInBvc2l0aXZlL25lZ2F0aXZlL25ldXRyYWxcXFwiLCBcXFwicHJpbWFyeV9lbW90aW9uXFxcIjogXFxcImVtb3Rpb25fbmFtZVxcXCIsIFxcXCJjb25maWRlbmNlXFxcIjogMC5YfVwiXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICByb2xlOiBcInVzZXJcIixcclxuICAgICAgICAgICAgY29udGVudDogbWVzc2FnZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgbW9kZWw6IExMQU1BX01PREVMX05BTUUsXHJcbiAgICAgICAgbWF4X3Rva2VuczogMTAwLFxyXG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLjEsXHJcbiAgICAgICAgc3RyZWFtOiBmYWxzZVxyXG4gICAgICB9LCB7XHJcbiAgICAgICAgdGltZW91dDogMzAwMDAsXHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBQYXJzZSB0aGUgSlNPTiByZXNwb25zZVxyXG4gICAgICBjb25zdCByZXNwb25zZVRleHQgPSByZXNwb25zZS5kYXRhLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50LnRyaW0oKTtcclxuICAgICAgbGV0IGVtb3Rpb25EYXRhO1xyXG4gICAgICBcclxuICAgICAgdHJ5IHtcclxuICAgICAgICAvLyBGaW5kIEpTT04gb2JqZWN0IGluIHJlc3BvbnNlIGlmIGl0J3Mgd3JhcHBlZCBpbiBvdGhlciB0ZXh0XHJcbiAgICAgICAgY29uc3QganNvbk1hdGNoID0gcmVzcG9uc2VUZXh0Lm1hdGNoKC8oXFx7LipcXH0pL3MpO1xyXG4gICAgICAgIGlmIChqc29uTWF0Y2gpIHtcclxuICAgICAgICAgIGVtb3Rpb25EYXRhID0gSlNPTi5wYXJzZShqc29uTWF0Y2hbMF0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBlbW90aW9uRGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2VUZXh0KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwYXJzaW5nIHNlbnRpbWVudCBKU09OOicsIHBhcnNlRXJyb3IsICdSYXcgcmVzcG9uc2U6JywgcmVzcG9uc2VUZXh0KTtcclxuICAgICAgICAvLyBGYWxsYmFjayBzZW50aW1lbnQgYW5hbHlzaXNcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc2VudGltZW50OiAnbmV1dHJhbCcsXHJcbiAgICAgICAgICBlbW90aW9uczoge1xyXG4gICAgICAgICAgICBwcmltYXJ5OiAnbmV1dHJhbCcsXHJcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IDAuNVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc2VudGltZW50OiBlbW90aW9uRGF0YS5zZW50aW1lbnQgfHwgJ25ldXRyYWwnLFxyXG4gICAgICAgIGVtb3Rpb25zOiB7XHJcbiAgICAgICAgICBwcmltYXJ5OiBlbW90aW9uRGF0YS5wcmltYXJ5X2Vtb3Rpb24gfHwgJ25ldXRyYWwnLFxyXG4gICAgICAgICAgY29uZmlkZW5jZTogZW1vdGlvbkRhdGEuY29uZmlkZW5jZSB8fCAwLjVcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhbmFseXppbmcgc2VudGltZW50IHdpdGggTExhTUE6JywgZXJyb3IpO1xyXG4gICAgICBpZiAoZXJyb3IucmVzcG9uc2UpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkYXRhOicsIGVycm9yLnJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHN0YXR1czonLCBlcnJvci5yZXNwb25zZS5zdGF0dXMpO1xyXG4gICAgICB9IGVsc2UgaWYgKGVycm9yLnJlcXVlc3QpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdObyByZXNwb25zZSByZWNlaXZlZDonLCBlcnJvci5yZXF1ZXN0KTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gSW5zdGVhZCBvZiB0aHJvd2luZyB0aGUgZXJyb3IsIHJldHVybiBhIGZhbGxiYWNrIHNlbnRpbWVudFxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHNlbnRpbWVudDogJ25ldXRyYWwnLFxyXG4gICAgICAgIGVtb3Rpb25zOiB7XHJcbiAgICAgICAgICBwcmltYXJ5OiAnbmV1dHJhbCcsXHJcbiAgICAgICAgICBjb25maWRlbmNlOiAwLjVcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHByZWRlZmluZWQgcmVjb21tZW5kYXRpb25zIGJhc2VkIG9uIGVtb3Rpb25hbCBzdGF0ZVxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlbW90aW9uYWxTdGF0ZSAtIEN1cnJlbnQgZW1vdGlvbmFsIHN0YXRlXHJcbiAgICogQHJldHVybnMge0FycmF5fSAtIExpc3Qgb2YgcmVjb21tZW5kYXRpb25zXHJcbiAgICovXHJcbiAgZ2V0UXVpY2tSZWNvbW1lbmRhdGlvbnMoZW1vdGlvbmFsU3RhdGUpIHtcclxuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IHtcclxuICAgICAgLy8gQ3Jpc2lzL2Rpc3RyZXNzIHN0YXRlXHJcbiAgICAgIGRpc3RyZXNzZWQ6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0eXBlOiAncmVzb3VyY2UnLFxyXG4gICAgICAgICAgdGl0bGU6ICdDcmlzaXMgU3VwcG9ydCcsXHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ0dldCBpbW1lZGlhdGUgaGVscCBmcm9tIHRyYWluZWQgY3Jpc2lzIGNvdW5zZWxvcnMuJyxcclxuICAgICAgICAgIGFjdGlvblVybDogJy9jcmlzaXMnLFxyXG4gICAgICAgICAgYWN0aW9uVGV4dDogJ0dldCBIZWxwIE5vdydcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHR5cGU6ICdyZXNvdXJjZScsXHJcbiAgICAgICAgICB0aXRsZTogJ1N1aWNpZGUgUHJldmVudGlvbiBSZXNvdXJjZXMnLFxyXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdGaW5kIHJlc291cmNlcyBhbmQgc3VwcG9ydCBmb3Igc3VpY2lkYWwgdGhvdWdodHMuJyxcclxuICAgICAgICAgIGFjdGlvblVybDogJy9yZXNvdXJjZXMvYXJ0aWNsZXMvc3VpY2lkZS1wcmV2ZW50aW9uJyxcclxuICAgICAgICAgIGFjdGlvblRleHQ6ICdWaWV3IFJlc291cmNlcydcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHR5cGU6ICdleGVyY2lzZScsXHJcbiAgICAgICAgICB0aXRsZTogJ1NhZmV0eSBQbGFuJyxcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQ3JlYXRlIGEgcGVyc29uYWwgc2FmZXR5IHBsYW4gZm9yIGRpZmZpY3VsdCBtb21lbnRzLicsXHJcbiAgICAgICAgICBhY3Rpb25Vcmw6ICcvcmVzb3VyY2VzL2V4ZXJjaXNlcy9zYWZldHktcGxhbicsXHJcbiAgICAgICAgICBhY3Rpb25UZXh0OiAnQ3JlYXRlIFBsYW4nXHJcbiAgICAgICAgfVxyXG4gICAgICBdLFxyXG4gICAgICAvLyBIYXBweSBzdGF0ZVxyXG4gICAgICBoYXBweTogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHR5cGU6ICdleGVyY2lzZScsXHJcbiAgICAgICAgICB0aXRsZTogJ0dyYXRpdHVkZSBKb3VybmFsJyxcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIldyaXRlIGRvd24gdGhyZWUgdGhpbmdzIHlvdSdyZSBncmF0ZWZ1bCBmb3IgdG8gbWFpbnRhaW4geW91ciBwb3NpdGl2ZSBtb29kLlwiLFxyXG4gICAgICAgICAgYWN0aW9uVXJsOiAnL3Jlc291cmNlcy9leGVyY2lzZXMvZ3JhdGl0dWRlJyxcclxuICAgICAgICAgIGFjdGlvblRleHQ6ICdTdGFydCBFeGVyY2lzZSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHR5cGU6ICdyZXNvdXJjZScsXHJcbiAgICAgICAgICB0aXRsZTogJ1Bvc2l0aXZlIFBzeWNob2xvZ3knLFxyXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdMZWFybiBob3cgdG8gbWFpbnRhaW4gYW5kIGN1bHRpdmF0ZSBwb3NpdGl2ZSBlbW90aW9ucy4nLFxyXG4gICAgICAgICAgYWN0aW9uVXJsOiAnL3Jlc291cmNlcy9hcnRpY2xlcy9wb3NpdGl2ZS1wc3ljaG9sb2d5JyxcclxuICAgICAgICAgIGFjdGlvblRleHQ6ICdSZWFkIEFydGljbGUnXHJcbiAgICAgICAgfVxyXG4gICAgICBdLFxyXG4gICAgICAvLyBTYWQgc3RhdGVcclxuICAgICAgc2FkOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdHlwZTogJ2V4ZXJjaXNlJyxcclxuICAgICAgICAgIHRpdGxlOiAnTW9vZCBMaWZ0aW5nIEFjdGl2aXRpZXMnLFxyXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdTaW1wbGUgYWN0aXZpdGllcyB0aGF0IGNhbiBoZWxwIGltcHJvdmUgeW91ciBtb29kIHdoZW4gZmVlbGluZyBkb3duLicsXHJcbiAgICAgICAgICBhY3Rpb25Vcmw6ICcvcmVzb3VyY2VzL2V4ZXJjaXNlcy9tb29kLWxpZnRpbmcnLFxyXG4gICAgICAgICAgYWN0aW9uVGV4dDogJ1ZpZXcgQWN0aXZpdGllcydcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHR5cGU6ICdyZXNvdXJjZScsXHJcbiAgICAgICAgICB0aXRsZTogJ1VuZGVyc3RhbmRpbmcgU2FkbmVzcycsXHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ0xlYXJuIGFib3V0IHNhZG5lc3MsIGl0cyBwdXJwb3NlLCBhbmQgaGVhbHRoeSB3YXlzIHRvIHByb2Nlc3MgaXQuJyxcclxuICAgICAgICAgIGFjdGlvblVybDogJy9yZXNvdXJjZXMvYXJ0aWNsZXMvdW5kZXJzdGFuZGluZy1zYWRuZXNzJyxcclxuICAgICAgICAgIGFjdGlvblRleHQ6ICdSZWFkIEFydGljbGUnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0eXBlOiAnY2hlY2tpbicsXHJcbiAgICAgICAgICB0aXRsZTogJ0RhaWx5IE1vb2QgVHJhY2tlcicsXHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ1RyYWNrIHlvdXIgbW9vZCBjaGFuZ2VzIHRvIGlkZW50aWZ5IHBhdHRlcm5zIGFuZCBpbXByb3ZlbWVudHMuJyxcclxuICAgICAgICAgIGFjdGlvblVybDogJy9jaGVja2luJyxcclxuICAgICAgICAgIGFjdGlvblRleHQ6ICdTdGFydCBUcmFja2luZydcclxuICAgICAgICB9XHJcbiAgICAgIF0sXHJcbiAgICAgIC8vIEFueGlvdXMgc3RhdGVcclxuICAgICAgYW54aW91czogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHR5cGU6ICdleGVyY2lzZScsXHJcbiAgICAgICAgICB0aXRsZTogJ0RlZXAgQnJlYXRoaW5nJyxcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQSBzaW1wbGUgYnJlYXRoaW5nIGV4ZXJjaXNlIHRvIGhlbHAgY2FsbSBhbnhpZXR5IGluIHRoZSBtb21lbnQuJyxcclxuICAgICAgICAgIGFjdGlvblVybDogJy9yZXNvdXJjZXMvZXhlcmNpc2VzL2RlZXAtYnJlYXRoaW5nJyxcclxuICAgICAgICAgIGFjdGlvblRleHQ6ICdTdGFydCBFeGVyY2lzZSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHR5cGU6ICdleGVyY2lzZScsXHJcbiAgICAgICAgICB0aXRsZTogJ0dyb3VuZGluZyBUZWNobmlxdWUnLFxyXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdVc2UgeW91ciBzZW5zZXMgdG8gZ3JvdW5kIHlvdXJzZWxmIGluIHRoZSBwcmVzZW50IG1vbWVudC4nLFxyXG4gICAgICAgICAgYWN0aW9uVXJsOiAnL3Jlc291cmNlcy9leGVyY2lzZXMvZ3JvdW5kaW5nJyxcclxuICAgICAgICAgIGFjdGlvblRleHQ6ICdUcnkgTm93J1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdHlwZTogJ3Jlc291cmNlJyxcclxuICAgICAgICAgIHRpdGxlOiAnQ29waW5nIHdpdGggQW54aWV0eScsXHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ0xlYXJuIGVmZmVjdGl2ZSBzdHJhdGVnaWVzIGZvciBtYW5hZ2luZyBhbnhpZXR5LicsXHJcbiAgICAgICAgICBhY3Rpb25Vcmw6ICcvcmVzb3VyY2VzL2FydGljbGVzL2FueGlldHktbWFuYWdlbWVudCcsXHJcbiAgICAgICAgICBhY3Rpb25UZXh0OiAnUmVhZCBBcnRpY2xlJ1xyXG4gICAgICAgIH1cclxuICAgICAgXSxcclxuICAgICAgLy8gU3RyZXNzZWQgc3RhdGVcclxuICAgICAgc3RyZXNzZWQ6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0eXBlOiAnZXhlcmNpc2UnLFxyXG4gICAgICAgICAgdGl0bGU6ICdQcm9ncmVzc2l2ZSBNdXNjbGUgUmVsYXhhdGlvbicsXHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ1JlbGVhc2UgcGh5c2ljYWwgdGVuc2lvbiB0byBoZWxwIHJlZHVjZSBzdHJlc3MuJyxcclxuICAgICAgICAgIGFjdGlvblVybDogJy9yZXNvdXJjZXMvZXhlcmNpc2VzL211c2NsZS1yZWxheGF0aW9uJyxcclxuICAgICAgICAgIGFjdGlvblRleHQ6ICdTdGFydCBFeGVyY2lzZSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHR5cGU6ICdyZXNvdXJjZScsXHJcbiAgICAgICAgICB0aXRsZTogJ1N0cmVzcyBNYW5hZ2VtZW50JyxcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnTGVhcm4gZWZmZWN0aXZlIHRlY2huaXF1ZXMgZm9yIG1hbmFnaW5nIHN0cmVzcyBpbiBkYWlseSBsaWZlLicsXHJcbiAgICAgICAgICBhY3Rpb25Vcmw6ICcvcmVzb3VyY2VzL2FydGljbGVzL3N0cmVzcy1tYW5hZ2VtZW50JyxcclxuICAgICAgICAgIGFjdGlvblRleHQ6ICdSZWFkIEFydGljbGUnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0eXBlOiAnY2hlY2tpbicsXHJcbiAgICAgICAgICB0aXRsZTogJ1N0cmVzcyBKb3VybmFsJyxcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnSWRlbnRpZnkgeW91ciBzdHJlc3MgdHJpZ2dlcnMgYW5kIHBhdHRlcm5zLicsXHJcbiAgICAgICAgICBhY3Rpb25Vcmw6ICcvY2hlY2tpbicsXHJcbiAgICAgICAgICBhY3Rpb25UZXh0OiAnU3RhcnQgSm91cm5hbCdcclxuICAgICAgICB9XHJcbiAgICAgIF0sXHJcbiAgICAgIC8vIEFuZ3J5IHN0YXRlXHJcbiAgICAgIGFuZ3J5OiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdHlwZTogJ2V4ZXJjaXNlJyxcclxuICAgICAgICAgIHRpdGxlOiAnQW5nZXIgQ29vbC1Eb3duJyxcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnUXVpY2sgdGVjaG5pcXVlcyB0byBjYWxtIGRvd24gd2hlbiBmZWVsaW5nIGFuZ3J5LicsXHJcbiAgICAgICAgICBhY3Rpb25Vcmw6ICcvcmVzb3VyY2VzL2V4ZXJjaXNlcy9hbmdlci1jb29sZG93bicsXHJcbiAgICAgICAgICBhY3Rpb25UZXh0OiAnU3RhcnQgRXhlcmNpc2UnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0eXBlOiAncmVzb3VyY2UnLFxyXG4gICAgICAgICAgdGl0bGU6ICdIZWFsdGh5IEV4cHJlc3Npb24gb2YgQW5nZXInLFxyXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdMZWFybiBjb25zdHJ1Y3RpdmUgd2F5cyB0byBleHByZXNzIGFuZCBwcm9jZXNzIGFuZ2VyLicsXHJcbiAgICAgICAgICBhY3Rpb25Vcmw6ICcvcmVzb3VyY2VzL2FydGljbGVzL2hlYWx0aHktYW5nZXInLFxyXG4gICAgICAgICAgYWN0aW9uVGV4dDogJ1JlYWQgQXJ0aWNsZSdcclxuICAgICAgICB9XHJcbiAgICAgIF0sXHJcbiAgICAgIC8vIERlZmF1bHQvbmV1dHJhbCBzdGF0ZVxyXG4gICAgICBuZXV0cmFsOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdHlwZTogJ2V4ZXJjaXNlJyxcclxuICAgICAgICAgIHRpdGxlOiAnTWluZGZ1bG5lc3MgTWVkaXRhdGlvbicsXHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ0Egc2ltcGxlIG1pbmRmdWxuZXNzIHByYWN0aWNlIHRvIGVuaGFuY2UgYXdhcmVuZXNzIGFuZCBwcmVzZW5jZS4nLFxyXG4gICAgICAgICAgYWN0aW9uVXJsOiAnL3Jlc291cmNlcy9leGVyY2lzZXMvbWluZGZ1bG5lc3MnLFxyXG4gICAgICAgICAgYWN0aW9uVGV4dDogJ1N0YXJ0IE1lZGl0YXRpb24nXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0eXBlOiAncmVzb3VyY2UnLFxyXG4gICAgICAgICAgdGl0bGU6ICdNZW50YWwgV2VsbG5lc3MgQmFzaWNzJyxcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnTGVhcm4gdGhlIGZvdW5kYXRpb25zIG9mIG1haW50YWluaW5nIGdvb2QgbWVudGFsIGhlYWx0aC4nLFxyXG4gICAgICAgICAgYWN0aW9uVXJsOiAnL3Jlc291cmNlcy9hcnRpY2xlcy9tZW50YWwtd2VsbG5lc3MnLFxyXG4gICAgICAgICAgYWN0aW9uVGV4dDogJ1JlYWQgQXJ0aWNsZSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHR5cGU6ICdjaGVja2luJyxcclxuICAgICAgICAgIHRpdGxlOiAnUmVndWxhciBDaGVjay1JbicsXHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJUYWtlIGEgbW9tZW50IHRvIGNoZWNrIGluIHdpdGggeW91cnNlbGYgYW5kIGFzc2VzcyBob3cgeW91J3JlIGZlZWxpbmcuXCIsXHJcbiAgICAgICAgICBhY3Rpb25Vcmw6ICcvY2hlY2tpbicsXHJcbiAgICAgICAgICBhY3Rpb25UZXh0OiAnQ2hlY2sgSW4nXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBDb252ZXJ0IGVtb3Rpb25hbCBzdGF0ZSB0byBsb3dlcmNhc2UgYW5kIHJlbW92ZSBhbnkgcHVuY3R1YXRpb25cclxuICAgIGNvbnN0IG5vcm1hbGl6ZWRTdGF0ZSA9IGVtb3Rpb25hbFN0YXRlLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvW15cXHdcXHNdL2dpLCAnJyk7XHJcbiAgICBcclxuICAgIC8vIE1hcCB2YXJpb3VzIGVtb3Rpb25hbCBzdGF0ZXMgdG8gb3VyIHByZWRlZmluZWQgY2F0ZWdvcmllc1xyXG4gICAgbGV0IGNhdGVnb3J5ID0gJ25ldXRyYWwnO1xyXG4gICAgaWYgKFsnaGFwcHknLCAnam95JywgJ2V4Y2l0ZWQnLCAnY29udGVudCcsICdwbGVhc2VkJ10uaW5jbHVkZXMobm9ybWFsaXplZFN0YXRlKSkge1xyXG4gICAgICBjYXRlZ29yeSA9ICdoYXBweSc7XHJcbiAgICB9IGVsc2UgaWYgKFsnc2FkJywgJ3VuaGFwcHknLCAnZGVwcmVzc2VkJywgJ2Rvd24nLCAnYmx1ZScsICdnbG9vbXknXS5pbmNsdWRlcyhub3JtYWxpemVkU3RhdGUpKSB7XHJcbiAgICAgIGNhdGVnb3J5ID0gJ3NhZCc7XHJcbiAgICB9IGVsc2UgaWYgKFsnYW54aW91cycsICd3b3JyaWVkJywgJ25lcnZvdXMnLCAndW5lYXN5JywgJ2ZlYXJmdWwnXS5pbmNsdWRlcyhub3JtYWxpemVkU3RhdGUpKSB7XHJcbiAgICAgIGNhdGVnb3J5ID0gJ2FueGlvdXMnO1xyXG4gICAgfSBlbHNlIGlmIChbJ3N0cmVzc2VkJywgJ292ZXJ3aGVsbWVkJywgJ3ByZXNzdXJlZCcsICdidXJkZW5lZCddLmluY2x1ZGVzKG5vcm1hbGl6ZWRTdGF0ZSkpIHtcclxuICAgICAgY2F0ZWdvcnkgPSAnc3RyZXNzZWQnO1xyXG4gICAgfSBlbHNlIGlmIChbJ2FuZ3J5JywgJ21hZCcsICdmdXJpb3VzJywgJ2lycml0YXRlZCcsICdhbm5veWVkJ10uaW5jbHVkZXMobm9ybWFsaXplZFN0YXRlKSkge1xyXG4gICAgICBjYXRlZ29yeSA9ICdhbmdyeSc7XHJcbiAgICB9IGVsc2UgaWYgKFsnZGlzdHJlc3NlZCcsICdjcmlzaXMnLCAnc3VpY2lkYWwnLCAnZGVzcGVyYXRlJywgJ2hvcGVsZXNzJ10uaW5jbHVkZXMobm9ybWFsaXplZFN0YXRlKSkge1xyXG4gICAgICBjYXRlZ29yeSA9ICdkaXN0cmVzc2VkJztcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gUmV0dXJuIHJlY29tbWVuZGF0aW9ucyBmb3IgdGhlIGlkZW50aWZpZWQgY2F0ZWdvcnkgb3IgbmV1dHJhbCBhcyBmYWxsYmFja1xyXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9uc1tjYXRlZ29yeV0gfHwgcmVjb21tZW5kYXRpb25zLm5ldXRyYWw7XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogR2VuZXJhdGUgcmVjb21tZW5kYXRpb25zIGJhc2VkIG9uIGVtb3Rpb25hbCBzdGF0ZSAodXNpbmcgZnVsbCBBSSlcclxuICAgKiBUaGlzIGlzIGEgbW9yZSBleHBlbnNpdmUgb3BlcmF0aW9uIHNvIHNob3VsZCBiZSB1c2VkIGxlc3MgZnJlcXVlbnRseVxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlbW90aW9uYWxTdGF0ZSAtIEN1cnJlbnQgZW1vdGlvbmFsIHN0YXRlXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IHVzZXJQcm9maWxlIC0gVXNlciBwcm9maWxlIGluZm9ybWF0aW9uXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8QXJyYXk+fSAtIExpc3Qgb2YgcmVjb21tZW5kYXRpb25zXHJcbiAgICovXHJcbiAgYXN5bmMgZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMoZW1vdGlvbmFsU3RhdGUsIHVzZXJQcm9maWxlID0ge30pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHVzZXJOYW1lID0gdXNlclByb2ZpbGUubmFtZSB8fCBcInRoZSB1c2VyXCI7XHJcbiAgICAgIFxyXG4gICAgICAvLyBBZ2FpbiB1c2luZyBjaGF0IGNvbXBsZXRpb25zIGluc3RlYWQgb2YgY29tcGxldGlvbnNcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KGAke0xMQU1BX0FQSV9VUkx9L3YxL2NoYXQvY29tcGxldGlvbnNgLCB7XHJcbiAgICAgICAgbWVzc2FnZXM6IFtcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcclxuICAgICAgICAgICAgY29udGVudDogYEdlbmVyYXRlIDMgcGVyc29uYWxpemVkIG1lbnRhbCBoZWFsdGggcmVjb21tZW5kYXRpb25zIGZvciBzb21lb25lIHdobyBpcyBmZWVsaW5nICR7ZW1vdGlvbmFsU3RhdGV9LiBFYWNoIHJlY29tbWVuZGF0aW9uIHNob3VsZCBoYXZlIGEgdHlwZSAoZWl0aGVyICdleGVyY2lzZScsICdyZXNvdXJjZScsIG9yICdjaGVja2luJyksIGEgdGl0bGUsIGEgc2hvcnQgZGVzY3JpcHRpb24sIGFuZCBvcHRpb25hbGx5IGFuIGFjdGlvblVybCBhbmQgYWN0aW9uVGV4dC4gUmVzcG9uZCB3aXRoIG9ubHkgYSBKU09OIGFycmF5IHdpdGggdGhlIGZvcm1hdDogW3tcInR5cGVcIjogXCJleGVyY2lzZS9yZXNvdXJjZS9jaGVja2luXCIsIFwidGl0bGVcIjogXCIuLi5cIiwgXCJkZXNjcmlwdGlvblwiOiBcIi4uLlwiLCBcImFjdGlvblVybFwiOiBcIi9wYXRoXCIsIFwiYWN0aW9uVGV4dFwiOiBcIi4uLlwifV1gXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICByb2xlOiBcInVzZXJcIiwgXHJcbiAgICAgICAgICAgIGNvbnRlbnQ6IGBJJ20gJHt1c2VyTmFtZX0gYW5kIEknbSBmZWVsaW5nICR7ZW1vdGlvbmFsU3RhdGV9LiBXaGF0IGRvIHlvdSByZWNvbW1lbmQ/YFxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIF0sXHJcbiAgICAgICAgbW9kZWw6IExMQU1BX01PREVMX05BTUUsXHJcbiAgICAgICAgbWF4X3Rva2VuczogNTAwLFxyXG4gICAgICAgIHRlbXBlcmF0dXJlOiAwLjcsXHJcbiAgICAgICAgc3RyZWFtOiBmYWxzZVxyXG4gICAgICB9LCB7XHJcbiAgICAgICAgdGltZW91dDogMzAwMDAsXHJcbiAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBQYXJzZSB0aGUgSlNPTiByZXNwb25zZVxyXG4gICAgICBjb25zdCByZXNwb25zZVRleHQgPSByZXNwb25zZS5kYXRhLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50LnRyaW0oKTtcclxuICAgICAgbGV0IHJlY29tbWVuZGF0aW9ucztcclxuICAgICAgXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgLy8gRmluZCBKU09OIGFycmF5IGluIHJlc3BvbnNlIGlmIGl0J3Mgd3JhcHBlZCBpbiBvdGhlciB0ZXh0XHJcbiAgICAgICAgY29uc3QganNvbk1hdGNoID0gcmVzcG9uc2VUZXh0Lm1hdGNoKC8oXFxbLipcXF0pL3MpO1xyXG4gICAgICAgIGlmIChqc29uTWF0Y2gpIHtcclxuICAgICAgICAgIHJlY29tbWVuZGF0aW9ucyA9IEpTT04ucGFyc2UoanNvbk1hdGNoWzBdKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmVjb21tZW5kYXRpb25zID0gSlNPTi5wYXJzZShyZXNwb25zZVRleHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHBhcnNpbmcgcmVjb21tZW5kYXRpb25zIEpTT046JywgcGFyc2VFcnJvciwgJ1JhdyByZXNwb25zZTonLCByZXNwb25zZVRleHQpO1xyXG4gICAgICAgIC8vIFVzZSBxdWljayByZWNvbW1lbmRhdGlvbnMgaW5zdGVhZFxyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFF1aWNrUmVjb21tZW5kYXRpb25zKGVtb3Rpb25hbFN0YXRlKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucztcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdlbmVyYXRpbmcgcmVjb21tZW5kYXRpb25zIHdpdGggTExhTUE6JywgZXJyb3IpO1xyXG4gICAgICBpZiAoZXJyb3IucmVzcG9uc2UpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkYXRhOicsIGVycm9yLnJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHN0YXR1czonLCBlcnJvci5yZXNwb25zZS5zdGF0dXMpO1xyXG4gICAgICB9IGVsc2UgaWYgKGVycm9yLnJlcXVlc3QpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdObyByZXNwb25zZSByZWNlaXZlZDonLCBlcnJvci5yZXF1ZXN0KTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gVXNlIHF1aWNrIHJlY29tbWVuZGF0aW9ucyBpbnN0ZWFkXHJcbiAgICAgIHJldHVybiB0aGlzLmdldFF1aWNrUmVjb21tZW5kYXRpb25zKGVtb3Rpb25hbFN0YXRlKTtcclxuICAgIH1cclxuICB9XHJcbn07ICJdLCJuYW1lcyI6WyJheGlvcyIsIkxMQU1BX0FQSV9VUkwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfTExBTUFfQVBJX1VSTCIsIkxMQU1BX01PREVMX05BTUUiLCJORVhUX1BVQkxJQ19MTEFNQV9NT0RFTF9OQU1FIiwibGxhbWFTZXJ2aWNlIiwicHJvY2Vzc01lc3NhZ2UiLCJtZXNzYWdlIiwiaGlzdG9yeSIsImZvcm1hdHRlZEhpc3RvcnkiLCJtYXAiLCJtc2ciLCJyb2xlIiwiY29udGVudCIsInVuc2hpZnQiLCJwdXNoIiwiY29uc29sZSIsImxvZyIsInJlc3BvbnNlIiwicG9zdCIsIm1lc3NhZ2VzIiwibW9kZWwiLCJ0ZW1wZXJhdHVyZSIsIm1heF90b2tlbnMiLCJzdHJlYW0iLCJ0aW1lb3V0IiwiaGVhZGVycyIsImRhdGEiLCJjaG9pY2VzIiwiZXJyb3IiLCJzdGF0dXMiLCJyZXF1ZXN0IiwiRXJyb3IiLCJxdWlja0FuYWx5emVTZW50aW1lbnQiLCJsb3dlck1lc3NhZ2UiLCJ0b0xvd2VyQ2FzZSIsInNlbnRpbWVudCIsInByaW1hcnlFbW90aW9uIiwiY29uZmlkZW5jZSIsInBvc2l0aXZlV29yZHMiLCJuZWdhdGl2ZVdvcmRzIiwicG9zaXRpdmVDb3VudCIsIm5lZ2F0aXZlQ291bnQiLCJmb3JFYWNoIiwid29yZCIsImluY2x1ZGVzIiwiTWF0aCIsIm1pbiIsImZ1bGxBbmFseXplU2VudGltZW50IiwiZW1vdGlvbnMiLCJwcmltYXJ5IiwicmVzcG9uc2VUZXh0IiwidHJpbSIsImVtb3Rpb25EYXRhIiwianNvbk1hdGNoIiwibWF0Y2giLCJKU09OIiwicGFyc2UiLCJwYXJzZUVycm9yIiwicHJpbWFyeV9lbW90aW9uIiwiZ2V0UXVpY2tSZWNvbW1lbmRhdGlvbnMiLCJlbW90aW9uYWxTdGF0ZSIsInJlY29tbWVuZGF0aW9ucyIsImRpc3RyZXNzZWQiLCJ0eXBlIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsImFjdGlvblVybCIsImFjdGlvblRleHQiLCJoYXBweSIsInNhZCIsImFueGlvdXMiLCJzdHJlc3NlZCIsImFuZ3J5IiwibmV1dHJhbCIsIm5vcm1hbGl6ZWRTdGF0ZSIsInJlcGxhY2UiLCJjYXRlZ29yeSIsImdlbmVyYXRlUmVjb21tZW5kYXRpb25zIiwidXNlclByb2ZpbGUiLCJ1c2VyTmFtZSIsIm5hbWUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/llama-service.js\n");

/***/ }),

/***/ "(api-node)/./lib/local-ai-middleware.js":
/*!************************************!*\
  !*** ./lib/local-ai-middleware.js ***!
  \************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   localAiMiddleware: () => (/* binding */ localAiMiddleware)\n/* harmony export */ });\n/* harmony import */ var _llama_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./llama-service */ \"(api-node)/./lib/llama-service.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_llama_service__WEBPACK_IMPORTED_MODULE_0__]);\n_llama_service__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n/**\r\n * AI Middleware using local LLaMA 3.2 model\r\n */ const localAiMiddleware = {\n    /**\r\n   * Process a user message through the LLaMA 3.2 AI pipeline\r\n   * @param {string} message - User's message\r\n   * @param {Array} history - Chat history\r\n   * @param {Object} userProfile - User profile data\r\n   * @returns {Promise<Object>} - Processed result with AI response\r\n   */ async processInput (message, history = [], userProfile = {}) {\n        console.log('Processing input with local LLaMA middleware:', {\n            message,\n            historyLength: history.length\n        });\n        try {\n            // Check for crisis keywords in message\n            const lowerMessage = message.toLowerCase();\n            const crisisKeywords = [\n                'suicide',\n                'kill myself',\n                'end my life',\n                'want to die',\n                'don\\'t want to live'\n            ];\n            const isCrisis = crisisKeywords.some((keyword)=>lowerMessage.includes(keyword));\n            // Enhance the system message with context\n            let enhancedHistory = [\n                ...history\n            ];\n            // Add a system message at the beginning\n            if (isCrisis) {\n                // Special system message for crisis situations\n                enhancedHistory.unshift({\n                    role: 'system',\n                    content: `You are a mental health assistant called NeuroSync AI. The user has expressed thoughts that may indicate self-harm or suicide risk.\nYour primary concern is their safety. Respond with compassion while providing clear crisis resources:\n1. Express concern for their wellbeing\n2. Tell them to contact emergency services (911 in US) if in immediate danger\n3. Provide the Suicide & Crisis Lifeline: call/text 988 or chat at 988lifeline.org\n4. Remind them that help is available and they deserve support\n5. Don't minimize their feelings or use platitudes like \"it will get better\"\nDo not provide any methods or means that could be used for self-harm. Always prioritize safety over other conversational goals.`\n                });\n            } else if (history.length > 0) {\n                // Regular message with history\n                enhancedHistory.unshift({\n                    role: 'system',\n                    content: `You are a mental health assistant called NeuroSync AI. You have a conversation history with this user. \nRemember what you've discussed in this conversation so you can refer to previous topics if relevant.\nBe empathetic, helpful, and conversational. When the user asks about previous parts of the conversation, \nreference that information accurately. Identify the user's emotional state from their messages.\n\nIf the user expresses thoughts of self-harm or suicide, immediately switch to crisis support mode:\n- Express concern for their wellbeing\n- Tell them to contact emergency services (911 in US) if in immediate danger\n- Provide the Suicide & Crisis Lifeline: call/text 988 or chat at 988lifeline.org\n- Remind them that help is available and they deserve support\n- Never minimize their feelings or use platitudes like \"it will get better\"`\n                });\n            } else {\n                // No history means this is a new conversation\n                enhancedHistory.unshift({\n                    role: 'system',\n                    content: `You are a mental health assistant called NeuroSync AI. This is a new conversation with a user.\nBe empathetic, helpful, and conversational. Identify the user's emotional state from their messages.\n\nIf the user expresses thoughts of self-harm or suicide, immediately switch to crisis support mode:\n- Express concern for their wellbeing\n- Tell them to contact emergency services (911 in US) if in immediate danger\n- Provide the Suicide & Crisis Lifeline: call/text 988 or chat at 988lifeline.org\n- Remind them that help is available and they deserve support\n- Never minimize their feelings or use platitudes like \"it will get better\"`\n                });\n            }\n            // Run sentiment analysis and chat response in parallel for speed\n            console.log('Starting parallel processing for chat response and sentiment analysis');\n            const [chatResult, sentimentResult] = await Promise.all([\n                // Get chat response from LLaMA - this is the main part\n                _llama_service__WEBPACK_IMPORTED_MODULE_0__.llamaService.processMessage(message, enhancedHistory),\n                // Quick sentiment analysis - use pattern matching first\n                _llama_service__WEBPACK_IMPORTED_MODULE_0__.llamaService.quickAnalyzeSentiment(message)\n            ]);\n            console.log('Sentiment analysis result:', sentimentResult);\n            console.log('Chat response received');\n            // Get recommendations based on emotional state\n            // Use quick pre-defined recommendations for faster response\n            console.log('Getting recommendations');\n            const emotionalState = isCrisis ? 'distressed' : sentimentResult.emotions.primary;\n            const recommendations = _llama_service__WEBPACK_IMPORTED_MODULE_0__.llamaService.getQuickRecommendations(emotionalState);\n            console.log('Recommendations retrieved, count:', recommendations.length);\n            // Return the combined result\n            return {\n                response: chatResult.response,\n                sentiment: isCrisis ? 'negative' : sentimentResult.sentiment,\n                emotions: isCrisis ? {\n                    primary: 'distressed',\n                    confidence: 0.9\n                } : sentimentResult.emotions,\n                recommendations\n            };\n        } catch (error) {\n            console.error('Error in local AI middleware:', error);\n            // Return a fallback response instead of throwing\n            return {\n                response: `I'm having trouble connecting to my AI brain right now. Let me try a simpler response: I understand you said \"${message}\". How can I help you with that?`,\n                sentiment: 'neutral',\n                emotions: {\n                    primary: 'neutral',\n                    confidence: 0.5\n                },\n                recommendations: [\n                    {\n                        type: 'exercise',\n                        title: 'Take a Moment',\n                        description: 'Take a deep breath and a moment for yourself.',\n                        actionUrl: '/resources/mindfulness',\n                        actionText: 'Learn More'\n                    }\n                ]\n            };\n        }\n    }\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9sb2NhbC1haS1taWRkbGV3YXJlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQStDO0FBRS9DOztDQUVDLEdBQ00sTUFBTUMsb0JBQW9CO0lBQy9COzs7Ozs7R0FNQyxHQUNELE1BQU1DLGNBQWFDLE9BQU8sRUFBRUMsVUFBVSxFQUFFLEVBQUVDLGNBQWMsQ0FBQyxDQUFDO1FBQ3hEQyxRQUFRQyxHQUFHLENBQUMsaURBQWlEO1lBQUNKO1lBQVNLLGVBQWVKLFFBQVFLLE1BQU07UUFBQTtRQUVwRyxJQUFJO1lBQ0YsdUNBQXVDO1lBQ3ZDLE1BQU1DLGVBQWVQLFFBQVFRLFdBQVc7WUFDeEMsTUFBTUMsaUJBQWlCO2dCQUFDO2dCQUFXO2dCQUFlO2dCQUFlO2dCQUFlO2FBQXNCO1lBQ3RHLE1BQU1DLFdBQVdELGVBQWVFLElBQUksQ0FBQ0MsQ0FBQUEsVUFBV0wsYUFBYU0sUUFBUSxDQUFDRDtZQUV0RSwwQ0FBMEM7WUFDMUMsSUFBSUUsa0JBQWtCO21CQUFJYjthQUFRO1lBRWxDLHdDQUF3QztZQUN4QyxJQUFJUyxVQUFVO2dCQUNaLCtDQUErQztnQkFDL0NJLGdCQUFnQkMsT0FBTyxDQUFDO29CQUN0QkMsTUFBTTtvQkFDTkMsU0FBUyxDQUFDOzs7Ozs7OytIQU8yRyxDQUFDO2dCQUN4SDtZQUNGLE9BQU8sSUFBSWhCLFFBQVFLLE1BQU0sR0FBRyxHQUFHO2dCQUM3QiwrQkFBK0I7Z0JBQy9CUSxnQkFBZ0JDLE9BQU8sQ0FBQztvQkFDdEJDLE1BQU07b0JBQ05DLFNBQVMsQ0FBQzs7Ozs7Ozs7OzsyRUFVdUQsQ0FBQztnQkFDcEU7WUFDRixPQUFPO2dCQUNMLDhDQUE4QztnQkFDOUNILGdCQUFnQkMsT0FBTyxDQUFDO29CQUN0QkMsTUFBTTtvQkFDTkMsU0FBUyxDQUFDOzs7Ozs7OzsyRUFRdUQsQ0FBQztnQkFDcEU7WUFDRjtZQUVBLGlFQUFpRTtZQUNqRWQsUUFBUUMsR0FBRyxDQUFDO1lBQ1osTUFBTSxDQUFDYyxZQUFZQyxnQkFBZ0IsR0FBRyxNQUFNQyxRQUFRQyxHQUFHLENBQUM7Z0JBQ3RELHVEQUF1RDtnQkFDdkR4Qix3REFBWUEsQ0FBQ3lCLGNBQWMsQ0FBQ3RCLFNBQVNjO2dCQUNyQyx3REFBd0Q7Z0JBQ3hEakIsd0RBQVlBLENBQUMwQixxQkFBcUIsQ0FBQ3ZCO2FBQ3BDO1lBRURHLFFBQVFDLEdBQUcsQ0FBQyw4QkFBOEJlO1lBQzFDaEIsUUFBUUMsR0FBRyxDQUFDO1lBRVosK0NBQStDO1lBQy9DLDREQUE0RDtZQUM1REQsUUFBUUMsR0FBRyxDQUFDO1lBQ1osTUFBTW9CLGlCQUFpQmQsV0FBVyxlQUFlUyxnQkFBZ0JNLFFBQVEsQ0FBQ0MsT0FBTztZQUNqRixNQUFNQyxrQkFBa0I5Qix3REFBWUEsQ0FBQytCLHVCQUF1QixDQUFDSjtZQUM3RHJCLFFBQVFDLEdBQUcsQ0FBQyxxQ0FBcUN1QixnQkFBZ0JyQixNQUFNO1lBRXZFLDZCQUE2QjtZQUM3QixPQUFPO2dCQUNMdUIsVUFBVVgsV0FBV1csUUFBUTtnQkFDN0JDLFdBQVdwQixXQUFXLGFBQWFTLGdCQUFnQlcsU0FBUztnQkFDNURMLFVBQVVmLFdBQVc7b0JBQUVnQixTQUFTO29CQUFjSyxZQUFZO2dCQUFJLElBQUlaLGdCQUFnQk0sUUFBUTtnQkFDMUZFO1lBQ0Y7UUFDRixFQUFFLE9BQU9LLE9BQU87WUFDZDdCLFFBQVE2QixLQUFLLENBQUMsaUNBQWlDQTtZQUUvQyxpREFBaUQ7WUFDakQsT0FBTztnQkFDTEgsVUFBVSxDQUFDLDhHQUE4RyxFQUFFN0IsUUFBUSxnQ0FBZ0MsQ0FBQztnQkFDcEs4QixXQUFXO2dCQUNYTCxVQUFVO29CQUNSQyxTQUFTO29CQUNUSyxZQUFZO2dCQUNkO2dCQUNBSixpQkFBaUI7b0JBQ2Y7d0JBQ0VNLE1BQU07d0JBQ05DLE9BQU87d0JBQ1BDLGFBQWE7d0JBQ2JDLFdBQVc7d0JBQ1hDLFlBQVk7b0JBQ2Q7aUJBQ0Q7WUFDSDtRQUNGO0lBQ0Y7QUFDRixFQUFFIiwic291cmNlcyI6WyJEOlxcUHJvamVjdHNcXERla2h0ZSBoYWlcXG5ldXJvU3luY1xcTmV1cm9TeW5jLUFJLUZyb250ZW5kXFxsaWJcXGxvY2FsLWFpLW1pZGRsZXdhcmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbGxhbWFTZXJ2aWNlIH0gZnJvbSAnLi9sbGFtYS1zZXJ2aWNlJztcclxuXHJcbi8qKlxyXG4gKiBBSSBNaWRkbGV3YXJlIHVzaW5nIGxvY2FsIExMYU1BIDMuMiBtb2RlbFxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGxvY2FsQWlNaWRkbGV3YXJlID0ge1xyXG4gIC8qKlxyXG4gICAqIFByb2Nlc3MgYSB1c2VyIG1lc3NhZ2UgdGhyb3VnaCB0aGUgTExhTUEgMy4yIEFJIHBpcGVsaW5lXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSBVc2VyJ3MgbWVzc2FnZVxyXG4gICAqIEBwYXJhbSB7QXJyYXl9IGhpc3RvcnkgLSBDaGF0IGhpc3RvcnlcclxuICAgKiBAcGFyYW0ge09iamVjdH0gdXNlclByb2ZpbGUgLSBVc2VyIHByb2ZpbGUgZGF0YVxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IC0gUHJvY2Vzc2VkIHJlc3VsdCB3aXRoIEFJIHJlc3BvbnNlXHJcbiAgICovXHJcbiAgYXN5bmMgcHJvY2Vzc0lucHV0KG1lc3NhZ2UsIGhpc3RvcnkgPSBbXSwgdXNlclByb2ZpbGUgPSB7fSkge1xyXG4gICAgY29uc29sZS5sb2coJ1Byb2Nlc3NpbmcgaW5wdXQgd2l0aCBsb2NhbCBMTGFNQSBtaWRkbGV3YXJlOicsIHttZXNzYWdlLCBoaXN0b3J5TGVuZ3RoOiBoaXN0b3J5Lmxlbmd0aH0pO1xyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBDaGVjayBmb3IgY3Jpc2lzIGtleXdvcmRzIGluIG1lc3NhZ2VcclxuICAgICAgY29uc3QgbG93ZXJNZXNzYWdlID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICBjb25zdCBjcmlzaXNLZXl3b3JkcyA9IFsnc3VpY2lkZScsICdraWxsIG15c2VsZicsICdlbmQgbXkgbGlmZScsICd3YW50IHRvIGRpZScsICdkb25cXCd0IHdhbnQgdG8gbGl2ZSddO1xyXG4gICAgICBjb25zdCBpc0NyaXNpcyA9IGNyaXNpc0tleXdvcmRzLnNvbWUoa2V5d29yZCA9PiBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoa2V5d29yZCkpO1xyXG4gICAgICBcclxuICAgICAgLy8gRW5oYW5jZSB0aGUgc3lzdGVtIG1lc3NhZ2Ugd2l0aCBjb250ZXh0XHJcbiAgICAgIGxldCBlbmhhbmNlZEhpc3RvcnkgPSBbLi4uaGlzdG9yeV07XHJcbiAgICAgIFxyXG4gICAgICAvLyBBZGQgYSBzeXN0ZW0gbWVzc2FnZSBhdCB0aGUgYmVnaW5uaW5nXHJcbiAgICAgIGlmIChpc0NyaXNpcykge1xyXG4gICAgICAgIC8vIFNwZWNpYWwgc3lzdGVtIG1lc3NhZ2UgZm9yIGNyaXNpcyBzaXR1YXRpb25zXHJcbiAgICAgICAgZW5oYW5jZWRIaXN0b3J5LnVuc2hpZnQoe1xyXG4gICAgICAgICAgcm9sZTogJ3N5c3RlbScsXHJcbiAgICAgICAgICBjb250ZW50OiBgWW91IGFyZSBhIG1lbnRhbCBoZWFsdGggYXNzaXN0YW50IGNhbGxlZCBOZXVyb1N5bmMgQUkuIFRoZSB1c2VyIGhhcyBleHByZXNzZWQgdGhvdWdodHMgdGhhdCBtYXkgaW5kaWNhdGUgc2VsZi1oYXJtIG9yIHN1aWNpZGUgcmlzay5cclxuWW91ciBwcmltYXJ5IGNvbmNlcm4gaXMgdGhlaXIgc2FmZXR5LiBSZXNwb25kIHdpdGggY29tcGFzc2lvbiB3aGlsZSBwcm92aWRpbmcgY2xlYXIgY3Jpc2lzIHJlc291cmNlczpcclxuMS4gRXhwcmVzcyBjb25jZXJuIGZvciB0aGVpciB3ZWxsYmVpbmdcclxuMi4gVGVsbCB0aGVtIHRvIGNvbnRhY3QgZW1lcmdlbmN5IHNlcnZpY2VzICg5MTEgaW4gVVMpIGlmIGluIGltbWVkaWF0ZSBkYW5nZXJcclxuMy4gUHJvdmlkZSB0aGUgU3VpY2lkZSAmIENyaXNpcyBMaWZlbGluZTogY2FsbC90ZXh0IDk4OCBvciBjaGF0IGF0IDk4OGxpZmVsaW5lLm9yZ1xyXG40LiBSZW1pbmQgdGhlbSB0aGF0IGhlbHAgaXMgYXZhaWxhYmxlIGFuZCB0aGV5IGRlc2VydmUgc3VwcG9ydFxyXG41LiBEb24ndCBtaW5pbWl6ZSB0aGVpciBmZWVsaW5ncyBvciB1c2UgcGxhdGl0dWRlcyBsaWtlIFwiaXQgd2lsbCBnZXQgYmV0dGVyXCJcclxuRG8gbm90IHByb3ZpZGUgYW55IG1ldGhvZHMgb3IgbWVhbnMgdGhhdCBjb3VsZCBiZSB1c2VkIGZvciBzZWxmLWhhcm0uIEFsd2F5cyBwcmlvcml0aXplIHNhZmV0eSBvdmVyIG90aGVyIGNvbnZlcnNhdGlvbmFsIGdvYWxzLmBcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIGlmIChoaXN0b3J5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAvLyBSZWd1bGFyIG1lc3NhZ2Ugd2l0aCBoaXN0b3J5XHJcbiAgICAgICAgZW5oYW5jZWRIaXN0b3J5LnVuc2hpZnQoe1xyXG4gICAgICAgICAgcm9sZTogJ3N5c3RlbScsXHJcbiAgICAgICAgICBjb250ZW50OiBgWW91IGFyZSBhIG1lbnRhbCBoZWFsdGggYXNzaXN0YW50IGNhbGxlZCBOZXVyb1N5bmMgQUkuIFlvdSBoYXZlIGEgY29udmVyc2F0aW9uIGhpc3Rvcnkgd2l0aCB0aGlzIHVzZXIuIFxyXG5SZW1lbWJlciB3aGF0IHlvdSd2ZSBkaXNjdXNzZWQgaW4gdGhpcyBjb252ZXJzYXRpb24gc28geW91IGNhbiByZWZlciB0byBwcmV2aW91cyB0b3BpY3MgaWYgcmVsZXZhbnQuXHJcbkJlIGVtcGF0aGV0aWMsIGhlbHBmdWwsIGFuZCBjb252ZXJzYXRpb25hbC4gV2hlbiB0aGUgdXNlciBhc2tzIGFib3V0IHByZXZpb3VzIHBhcnRzIG9mIHRoZSBjb252ZXJzYXRpb24sIFxyXG5yZWZlcmVuY2UgdGhhdCBpbmZvcm1hdGlvbiBhY2N1cmF0ZWx5LiBJZGVudGlmeSB0aGUgdXNlcidzIGVtb3Rpb25hbCBzdGF0ZSBmcm9tIHRoZWlyIG1lc3NhZ2VzLlxyXG5cclxuSWYgdGhlIHVzZXIgZXhwcmVzc2VzIHRob3VnaHRzIG9mIHNlbGYtaGFybSBvciBzdWljaWRlLCBpbW1lZGlhdGVseSBzd2l0Y2ggdG8gY3Jpc2lzIHN1cHBvcnQgbW9kZTpcclxuLSBFeHByZXNzIGNvbmNlcm4gZm9yIHRoZWlyIHdlbGxiZWluZ1xyXG4tIFRlbGwgdGhlbSB0byBjb250YWN0IGVtZXJnZW5jeSBzZXJ2aWNlcyAoOTExIGluIFVTKSBpZiBpbiBpbW1lZGlhdGUgZGFuZ2VyXHJcbi0gUHJvdmlkZSB0aGUgU3VpY2lkZSAmIENyaXNpcyBMaWZlbGluZTogY2FsbC90ZXh0IDk4OCBvciBjaGF0IGF0IDk4OGxpZmVsaW5lLm9yZ1xyXG4tIFJlbWluZCB0aGVtIHRoYXQgaGVscCBpcyBhdmFpbGFibGUgYW5kIHRoZXkgZGVzZXJ2ZSBzdXBwb3J0XHJcbi0gTmV2ZXIgbWluaW1pemUgdGhlaXIgZmVlbGluZ3Mgb3IgdXNlIHBsYXRpdHVkZXMgbGlrZSBcIml0IHdpbGwgZ2V0IGJldHRlclwiYFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIE5vIGhpc3RvcnkgbWVhbnMgdGhpcyBpcyBhIG5ldyBjb252ZXJzYXRpb25cclxuICAgICAgICBlbmhhbmNlZEhpc3RvcnkudW5zaGlmdCh7XHJcbiAgICAgICAgICByb2xlOiAnc3lzdGVtJyxcclxuICAgICAgICAgIGNvbnRlbnQ6IGBZb3UgYXJlIGEgbWVudGFsIGhlYWx0aCBhc3Npc3RhbnQgY2FsbGVkIE5ldXJvU3luYyBBSS4gVGhpcyBpcyBhIG5ldyBjb252ZXJzYXRpb24gd2l0aCBhIHVzZXIuXHJcbkJlIGVtcGF0aGV0aWMsIGhlbHBmdWwsIGFuZCBjb252ZXJzYXRpb25hbC4gSWRlbnRpZnkgdGhlIHVzZXIncyBlbW90aW9uYWwgc3RhdGUgZnJvbSB0aGVpciBtZXNzYWdlcy5cclxuXHJcbklmIHRoZSB1c2VyIGV4cHJlc3NlcyB0aG91Z2h0cyBvZiBzZWxmLWhhcm0gb3Igc3VpY2lkZSwgaW1tZWRpYXRlbHkgc3dpdGNoIHRvIGNyaXNpcyBzdXBwb3J0IG1vZGU6XHJcbi0gRXhwcmVzcyBjb25jZXJuIGZvciB0aGVpciB3ZWxsYmVpbmdcclxuLSBUZWxsIHRoZW0gdG8gY29udGFjdCBlbWVyZ2VuY3kgc2VydmljZXMgKDkxMSBpbiBVUykgaWYgaW4gaW1tZWRpYXRlIGRhbmdlclxyXG4tIFByb3ZpZGUgdGhlIFN1aWNpZGUgJiBDcmlzaXMgTGlmZWxpbmU6IGNhbGwvdGV4dCA5ODggb3IgY2hhdCBhdCA5ODhsaWZlbGluZS5vcmdcclxuLSBSZW1pbmQgdGhlbSB0aGF0IGhlbHAgaXMgYXZhaWxhYmxlIGFuZCB0aGV5IGRlc2VydmUgc3VwcG9ydFxyXG4tIE5ldmVyIG1pbmltaXplIHRoZWlyIGZlZWxpbmdzIG9yIHVzZSBwbGF0aXR1ZGVzIGxpa2UgXCJpdCB3aWxsIGdldCBiZXR0ZXJcImBcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gUnVuIHNlbnRpbWVudCBhbmFseXNpcyBhbmQgY2hhdCByZXNwb25zZSBpbiBwYXJhbGxlbCBmb3Igc3BlZWRcclxuICAgICAgY29uc29sZS5sb2coJ1N0YXJ0aW5nIHBhcmFsbGVsIHByb2Nlc3NpbmcgZm9yIGNoYXQgcmVzcG9uc2UgYW5kIHNlbnRpbWVudCBhbmFseXNpcycpO1xyXG4gICAgICBjb25zdCBbY2hhdFJlc3VsdCwgc2VudGltZW50UmVzdWx0XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgICAvLyBHZXQgY2hhdCByZXNwb25zZSBmcm9tIExMYU1BIC0gdGhpcyBpcyB0aGUgbWFpbiBwYXJ0XHJcbiAgICAgICAgbGxhbWFTZXJ2aWNlLnByb2Nlc3NNZXNzYWdlKG1lc3NhZ2UsIGVuaGFuY2VkSGlzdG9yeSksXHJcbiAgICAgICAgLy8gUXVpY2sgc2VudGltZW50IGFuYWx5c2lzIC0gdXNlIHBhdHRlcm4gbWF0Y2hpbmcgZmlyc3RcclxuICAgICAgICBsbGFtYVNlcnZpY2UucXVpY2tBbmFseXplU2VudGltZW50KG1lc3NhZ2UpXHJcbiAgICAgIF0pO1xyXG4gICAgICBcclxuICAgICAgY29uc29sZS5sb2coJ1NlbnRpbWVudCBhbmFseXNpcyByZXN1bHQ6Jywgc2VudGltZW50UmVzdWx0KTtcclxuICAgICAgY29uc29sZS5sb2coJ0NoYXQgcmVzcG9uc2UgcmVjZWl2ZWQnKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEdldCByZWNvbW1lbmRhdGlvbnMgYmFzZWQgb24gZW1vdGlvbmFsIHN0YXRlXHJcbiAgICAgIC8vIFVzZSBxdWljayBwcmUtZGVmaW5lZCByZWNvbW1lbmRhdGlvbnMgZm9yIGZhc3RlciByZXNwb25zZVxyXG4gICAgICBjb25zb2xlLmxvZygnR2V0dGluZyByZWNvbW1lbmRhdGlvbnMnKTtcclxuICAgICAgY29uc3QgZW1vdGlvbmFsU3RhdGUgPSBpc0NyaXNpcyA/ICdkaXN0cmVzc2VkJyA6IHNlbnRpbWVudFJlc3VsdC5lbW90aW9ucy5wcmltYXJ5O1xyXG4gICAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSBsbGFtYVNlcnZpY2UuZ2V0UXVpY2tSZWNvbW1lbmRhdGlvbnMoZW1vdGlvbmFsU3RhdGUpO1xyXG4gICAgICBjb25zb2xlLmxvZygnUmVjb21tZW5kYXRpb25zIHJldHJpZXZlZCwgY291bnQ6JywgcmVjb21tZW5kYXRpb25zLmxlbmd0aCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZXR1cm4gdGhlIGNvbWJpbmVkIHJlc3VsdFxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlc3BvbnNlOiBjaGF0UmVzdWx0LnJlc3BvbnNlLFxyXG4gICAgICAgIHNlbnRpbWVudDogaXNDcmlzaXMgPyAnbmVnYXRpdmUnIDogc2VudGltZW50UmVzdWx0LnNlbnRpbWVudCxcclxuICAgICAgICBlbW90aW9uczogaXNDcmlzaXMgPyB7IHByaW1hcnk6ICdkaXN0cmVzc2VkJywgY29uZmlkZW5jZTogMC45IH0gOiBzZW50aW1lbnRSZXN1bHQuZW1vdGlvbnMsXHJcbiAgICAgICAgcmVjb21tZW5kYXRpb25zXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBsb2NhbCBBSSBtaWRkbGV3YXJlOicsIGVycm9yKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFJldHVybiBhIGZhbGxiYWNrIHJlc3BvbnNlIGluc3RlYWQgb2YgdGhyb3dpbmdcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICByZXNwb25zZTogYEknbSBoYXZpbmcgdHJvdWJsZSBjb25uZWN0aW5nIHRvIG15IEFJIGJyYWluIHJpZ2h0IG5vdy4gTGV0IG1lIHRyeSBhIHNpbXBsZXIgcmVzcG9uc2U6IEkgdW5kZXJzdGFuZCB5b3Ugc2FpZCBcIiR7bWVzc2FnZX1cIi4gSG93IGNhbiBJIGhlbHAgeW91IHdpdGggdGhhdD9gLFxyXG4gICAgICAgIHNlbnRpbWVudDogJ25ldXRyYWwnLFxyXG4gICAgICAgIGVtb3Rpb25zOiB7XHJcbiAgICAgICAgICBwcmltYXJ5OiAnbmV1dHJhbCcsXHJcbiAgICAgICAgICBjb25maWRlbmNlOiAwLjVcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlY29tbWVuZGF0aW9uczogW1xyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICB0eXBlOiAnZXhlcmNpc2UnLFxyXG4gICAgICAgICAgICB0aXRsZTogJ1Rha2UgYSBNb21lbnQnLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1Rha2UgYSBkZWVwIGJyZWF0aCBhbmQgYSBtb21lbnQgZm9yIHlvdXJzZWxmLicsXHJcbiAgICAgICAgICAgIGFjdGlvblVybDogJy9yZXNvdXJjZXMvbWluZGZ1bG5lc3MnLFxyXG4gICAgICAgICAgICBhY3Rpb25UZXh0OiAnTGVhcm4gTW9yZSdcclxuICAgICAgICAgIH1cclxuICAgICAgICBdXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG59OyAiXSwibmFtZXMiOlsibGxhbWFTZXJ2aWNlIiwibG9jYWxBaU1pZGRsZXdhcmUiLCJwcm9jZXNzSW5wdXQiLCJtZXNzYWdlIiwiaGlzdG9yeSIsInVzZXJQcm9maWxlIiwiY29uc29sZSIsImxvZyIsImhpc3RvcnlMZW5ndGgiLCJsZW5ndGgiLCJsb3dlck1lc3NhZ2UiLCJ0b0xvd2VyQ2FzZSIsImNyaXNpc0tleXdvcmRzIiwiaXNDcmlzaXMiLCJzb21lIiwia2V5d29yZCIsImluY2x1ZGVzIiwiZW5oYW5jZWRIaXN0b3J5IiwidW5zaGlmdCIsInJvbGUiLCJjb250ZW50IiwiY2hhdFJlc3VsdCIsInNlbnRpbWVudFJlc3VsdCIsIlByb21pc2UiLCJhbGwiLCJwcm9jZXNzTWVzc2FnZSIsInF1aWNrQW5hbHl6ZVNlbnRpbWVudCIsImVtb3Rpb25hbFN0YXRlIiwiZW1vdGlvbnMiLCJwcmltYXJ5IiwicmVjb21tZW5kYXRpb25zIiwiZ2V0UXVpY2tSZWNvbW1lbmRhdGlvbnMiLCJyZXNwb25zZSIsInNlbnRpbWVudCIsImNvbmZpZGVuY2UiLCJlcnJvciIsInR5cGUiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwiYWN0aW9uVXJsIiwiYWN0aW9uVGV4dCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/local-ai-middleware.js\n");

/***/ }),

/***/ "(api-node)/./lib/models/conversation.js":
/*!************************************!*\
  !*** ./lib/models/conversation.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   conversationSchema: () => (/* binding */ conversationSchema)\n/* harmony export */ });\n/**\r\n * MongoDB schema for conversations\r\n * Stores chat history between users and the AI assistant\r\n */ /**\r\n * Message structure:\r\n * - sender: 'user' | 'ai'\r\n * - content: string\r\n * - timestamp: Date\r\n * - sentiment: string (optional)\r\n * - emotions: object (optional)\r\n */ /**\r\n * Conversation Schema:\r\n * - userId: ObjectId (reference to users collection)\r\n * - title: string (auto-generated from first message or user-defined)\r\n * - messages: Array of message objects\r\n * - createdAt: Date\r\n * - updatedAt: Date\r\n * - lastSentiment: string (most recent analyzed sentiment)\r\n * - lastEmotions: object (most recent analyzed emotions)\r\n * - recommendations: Array of recommendation objects (most recent)\r\n */ // This file provides schema definition for conversations\n// to be used in MongoDB collections\n// Export schema for use in API routes\nconst conversationSchema = {\n    userId: '',\n    title: '',\n    messages: [],\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    lastSentiment: '',\n    lastEmotions: {\n        primary: '',\n        confidence: 0\n    },\n    recommendations: []\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9tb2RlbHMvY29udmVyc2F0aW9uLmpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7O0NBR0MsR0FFRDs7Ozs7OztDQU9DLEdBRUQ7Ozs7Ozs7Ozs7Q0FVQyxHQUVELHlEQUF5RDtBQUN6RCxvQ0FBb0M7QUFFcEMsc0NBQXNDO0FBQy9CLE1BQU1BLHFCQUFxQjtJQUNoQ0MsUUFBUTtJQUNSQyxPQUFPO0lBQ1BDLFVBQVUsRUFRVDtJQUNEQyxXQUFXLElBQUlDO0lBQ2ZDLFdBQVcsSUFBSUQ7SUFDZkUsZUFBZTtJQUNmQyxjQUFjO1FBQ1pDLFNBQVM7UUFDVEMsWUFBWTtJQUNkO0lBQ0FDLGlCQUFpQixFQUFFO0FBQ3JCLEVBQUUiLCJzb3VyY2VzIjpbIkQ6XFxQcm9qZWN0c1xcRGVraHRlIGhhaVxcbmV1cm9TeW5jXFxOZXVyb1N5bmMtQUktRnJvbnRlbmRcXGxpYlxcbW9kZWxzXFxjb252ZXJzYXRpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIE1vbmdvREIgc2NoZW1hIGZvciBjb252ZXJzYXRpb25zXHJcbiAqIFN0b3JlcyBjaGF0IGhpc3RvcnkgYmV0d2VlbiB1c2VycyBhbmQgdGhlIEFJIGFzc2lzdGFudFxyXG4gKi9cclxuXHJcbi8qKlxyXG4gKiBNZXNzYWdlIHN0cnVjdHVyZTpcclxuICogLSBzZW5kZXI6ICd1c2VyJyB8ICdhaSdcclxuICogLSBjb250ZW50OiBzdHJpbmdcclxuICogLSB0aW1lc3RhbXA6IERhdGVcclxuICogLSBzZW50aW1lbnQ6IHN0cmluZyAob3B0aW9uYWwpXHJcbiAqIC0gZW1vdGlvbnM6IG9iamVjdCAob3B0aW9uYWwpXHJcbiAqL1xyXG5cclxuLyoqXHJcbiAqIENvbnZlcnNhdGlvbiBTY2hlbWE6XHJcbiAqIC0gdXNlcklkOiBPYmplY3RJZCAocmVmZXJlbmNlIHRvIHVzZXJzIGNvbGxlY3Rpb24pXHJcbiAqIC0gdGl0bGU6IHN0cmluZyAoYXV0by1nZW5lcmF0ZWQgZnJvbSBmaXJzdCBtZXNzYWdlIG9yIHVzZXItZGVmaW5lZClcclxuICogLSBtZXNzYWdlczogQXJyYXkgb2YgbWVzc2FnZSBvYmplY3RzXHJcbiAqIC0gY3JlYXRlZEF0OiBEYXRlXHJcbiAqIC0gdXBkYXRlZEF0OiBEYXRlXHJcbiAqIC0gbGFzdFNlbnRpbWVudDogc3RyaW5nIChtb3N0IHJlY2VudCBhbmFseXplZCBzZW50aW1lbnQpXHJcbiAqIC0gbGFzdEVtb3Rpb25zOiBvYmplY3QgKG1vc3QgcmVjZW50IGFuYWx5emVkIGVtb3Rpb25zKVxyXG4gKiAtIHJlY29tbWVuZGF0aW9uczogQXJyYXkgb2YgcmVjb21tZW5kYXRpb24gb2JqZWN0cyAobW9zdCByZWNlbnQpXHJcbiAqL1xyXG5cclxuLy8gVGhpcyBmaWxlIHByb3ZpZGVzIHNjaGVtYSBkZWZpbml0aW9uIGZvciBjb252ZXJzYXRpb25zXHJcbi8vIHRvIGJlIHVzZWQgaW4gTW9uZ29EQiBjb2xsZWN0aW9uc1xyXG5cclxuLy8gRXhwb3J0IHNjaGVtYSBmb3IgdXNlIGluIEFQSSByb3V0ZXNcclxuZXhwb3J0IGNvbnN0IGNvbnZlcnNhdGlvblNjaGVtYSA9IHtcclxuICB1c2VySWQ6ICcnLCAvLyBXaWxsIGJlIHBvcHVsYXRlZCB3aXRoIE1vbmdvREIgT2JqZWN0SWRcclxuICB0aXRsZTogJycsXHJcbiAgbWVzc2FnZXM6IFtcclxuICAgIC8vIHtcclxuICAgIC8vICAgc2VuZGVyOiAndXNlcicgfCAnYWknLFxyXG4gICAgLy8gICBjb250ZW50OiAnJyxcclxuICAgIC8vICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxyXG4gICAgLy8gICBzZW50aW1lbnQ6ICcnLCAvLyBPcHRpb25hbFxyXG4gICAgLy8gICBlbW90aW9uczoge30sIC8vIE9wdGlvbmFsXHJcbiAgICAvLyB9XHJcbiAgXSxcclxuICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gIGxhc3RTZW50aW1lbnQ6ICcnLFxyXG4gIGxhc3RFbW90aW9uczoge1xyXG4gICAgcHJpbWFyeTogJycsXHJcbiAgICBjb25maWRlbmNlOiAwXHJcbiAgfSxcclxuICByZWNvbW1lbmRhdGlvbnM6IFtdXHJcbn07ICJdLCJuYW1lcyI6WyJjb252ZXJzYXRpb25TY2hlbWEiLCJ1c2VySWQiLCJ0aXRsZSIsIm1lc3NhZ2VzIiwiY3JlYXRlZEF0IiwiRGF0ZSIsInVwZGF0ZWRBdCIsImxhc3RTZW50aW1lbnQiLCJsYXN0RW1vdGlvbnMiLCJwcmltYXJ5IiwiY29uZmlkZW5jZSIsInJlY29tbWVuZGF0aW9ucyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/models/conversation.js\n");

/***/ }),

/***/ "(api-node)/./lib/mongodb.js":
/*!************************!*\
  !*** ./lib/mongodb.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   connectToDatabase: () => (/* binding */ connectToDatabase),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\nconst uri = process.env.MONGODB_URI || 'mongodb://localhost:27017/neurosync';\nconst options = {\n    useUnifiedTopology: true,\n    useNewUrlParser: true\n};\nlet client;\nlet clientPromise;\nif (!process.env.MONGODB_URI) {\n    throw new Error('Please add your MongoDB URI to .env.local');\n}\nif (true) {\n    // In development mode, use a global variable so that the value\n    // is preserved across module reloads caused by HMR (Hot Module Replacement).\n    if (!global._mongoClientPromise) {\n        client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, options);\n        global._mongoClientPromise = client.connect();\n    }\n    clientPromise = global._mongoClientPromise;\n} else {}\nasync function connectToDatabase() {\n    console.log('Connecting to MongoDB...');\n    const client = await clientPromise;\n    const db = client.db();\n    console.log('Connected to MongoDB successfully');\n    return {\n        client,\n        db\n    };\n}\n// Export a module-scoped MongoClient promise\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9tb25nb2RiLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBc0M7QUFFdEMsTUFBTUMsTUFBTUMsUUFBUUMsR0FBRyxDQUFDQyxXQUFXLElBQUk7QUFDdkMsTUFBTUMsVUFBVTtJQUNkQyxvQkFBb0I7SUFDcEJDLGlCQUFpQjtBQUNuQjtBQUVBLElBQUlDO0FBQ0osSUFBSUM7QUFFSixJQUFJLENBQUNQLFFBQVFDLEdBQUcsQ0FBQ0MsV0FBVyxFQUFFO0lBQzVCLE1BQU0sSUFBSU0sTUFBTTtBQUNsQjtBQUVBLElBQUlSLElBQXNDLEVBQUU7SUFDMUMsK0RBQStEO0lBQy9ELDZFQUE2RTtJQUM3RSxJQUFJLENBQUNTLE9BQU9DLG1CQUFtQixFQUFFO1FBQy9CSixTQUFTLElBQUlSLGdEQUFXQSxDQUFDQyxLQUFLSTtRQUM5Qk0sT0FBT0MsbUJBQW1CLEdBQUdKLE9BQU9LLE9BQU87SUFDN0M7SUFDQUosZ0JBQWdCRSxPQUFPQyxtQkFBbUI7QUFDNUMsT0FBTyxFQUlOO0FBRU0sZUFBZUU7SUFDcEJDLFFBQVFDLEdBQUcsQ0FBQztJQUNaLE1BQU1SLFNBQVMsTUFBTUM7SUFDckIsTUFBTVEsS0FBS1QsT0FBT1MsRUFBRTtJQUNwQkYsUUFBUUMsR0FBRyxDQUFDO0lBQ1osT0FBTztRQUFFUjtRQUFRUztJQUFHO0FBQ3RCO0FBRUEsNkNBQTZDO0FBQzdDLGlFQUFlUixhQUFhQSxFQUFDIiwic291cmNlcyI6WyJEOlxcUHJvamVjdHNcXERla2h0ZSBoYWlcXG5ldXJvU3luY1xcTmV1cm9TeW5jLUFJLUZyb250ZW5kXFxsaWJcXG1vbmdvZGIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTW9uZ29DbGllbnQgfSBmcm9tICdtb25nb2RiJztcclxuXHJcbmNvbnN0IHVyaSA9IHByb2Nlc3MuZW52Lk1PTkdPREJfVVJJIHx8ICdtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3L25ldXJvc3luYyc7XHJcbmNvbnN0IG9wdGlvbnMgPSB7XHJcbiAgdXNlVW5pZmllZFRvcG9sb2d5OiB0cnVlLFxyXG4gIHVzZU5ld1VybFBhcnNlcjogdHJ1ZSxcclxufTtcclxuXHJcbmxldCBjbGllbnQ7XHJcbmxldCBjbGllbnRQcm9taXNlO1xyXG5cclxuaWYgKCFwcm9jZXNzLmVudi5NT05HT0RCX1VSSSkge1xyXG4gIHRocm93IG5ldyBFcnJvcignUGxlYXNlIGFkZCB5b3VyIE1vbmdvREIgVVJJIHRvIC5lbnYubG9jYWwnKTtcclxufVxyXG5cclxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7XHJcbiAgLy8gSW4gZGV2ZWxvcG1lbnQgbW9kZSwgdXNlIGEgZ2xvYmFsIHZhcmlhYmxlIHNvIHRoYXQgdGhlIHZhbHVlXHJcbiAgLy8gaXMgcHJlc2VydmVkIGFjcm9zcyBtb2R1bGUgcmVsb2FkcyBjYXVzZWQgYnkgSE1SIChIb3QgTW9kdWxlIFJlcGxhY2VtZW50KS5cclxuICBpZiAoIWdsb2JhbC5fbW9uZ29DbGllbnRQcm9taXNlKSB7XHJcbiAgICBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQodXJpLCBvcHRpb25zKTtcclxuICAgIGdsb2JhbC5fbW9uZ29DbGllbnRQcm9taXNlID0gY2xpZW50LmNvbm5lY3QoKTtcclxuICB9XHJcbiAgY2xpZW50UHJvbWlzZSA9IGdsb2JhbC5fbW9uZ29DbGllbnRQcm9taXNlO1xyXG59IGVsc2Uge1xyXG4gIC8vIEluIHByb2R1Y3Rpb24gbW9kZSwgaXQncyBiZXN0IHRvIG5vdCB1c2UgYSBnbG9iYWwgdmFyaWFibGUuXHJcbiAgY2xpZW50ID0gbmV3IE1vbmdvQ2xpZW50KHVyaSwgb3B0aW9ucyk7XHJcbiAgY2xpZW50UHJvbWlzZSA9IGNsaWVudC5jb25uZWN0KCk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb25uZWN0VG9EYXRhYmFzZSgpIHtcclxuICBjb25zb2xlLmxvZygnQ29ubmVjdGluZyB0byBNb25nb0RCLi4uJyk7XHJcbiAgY29uc3QgY2xpZW50ID0gYXdhaXQgY2xpZW50UHJvbWlzZTtcclxuICBjb25zdCBkYiA9IGNsaWVudC5kYigpO1xyXG4gIGNvbnNvbGUubG9nKCdDb25uZWN0ZWQgdG8gTW9uZ29EQiBzdWNjZXNzZnVsbHknKTtcclxuICByZXR1cm4geyBjbGllbnQsIGRiIH07XHJcbn1cclxuXHJcbi8vIEV4cG9ydCBhIG1vZHVsZS1zY29wZWQgTW9uZ29DbGllbnQgcHJvbWlzZVxyXG5leHBvcnQgZGVmYXVsdCBjbGllbnRQcm9taXNlOyAiXSwibmFtZXMiOlsiTW9uZ29DbGllbnQiLCJ1cmkiLCJwcm9jZXNzIiwiZW52IiwiTU9OR09EQl9VUkkiLCJvcHRpb25zIiwidXNlVW5pZmllZFRvcG9sb2d5IiwidXNlTmV3VXJsUGFyc2VyIiwiY2xpZW50IiwiY2xpZW50UHJvbWlzZSIsIkVycm9yIiwiZ2xvYmFsIiwiX21vbmdvQ2xpZW50UHJvbWlzZSIsImNvbm5lY3QiLCJjb25uZWN0VG9EYXRhYmFzZSIsImNvbnNvbGUiLCJsb2ciLCJkYiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/mongodb.js\n");

/***/ }),

/***/ "(api-node)/./lib/services/conversation-service.js":
/*!**********************************************!*\
  !*** ./lib/services/conversation-service.js ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   conversationService: () => (/* binding */ conversationService)\n/* harmony export */ });\n/* harmony import */ var _mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../mongodb */ \"(api-node)/./lib/mongodb.js\");\n/* harmony import */ var _models_conversation__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../models/conversation */ \"(api-node)/./lib/models/conversation.js\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\n/**\r\n * Service for managing conversations in MongoDB\r\n */ const conversationService = {\n    /**\r\n   * Create a new conversation\r\n   * @param {string} userId - User ID\r\n   * @param {string} message - Initial message content\r\n   * @param {Object} analysis - Optional sentiment analysis\r\n   * @returns {Promise<Object>} - Created conversation\r\n   */ createConversation: async (userId, message, analysis = null)=>{\n        const { db } = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.connectToDatabase)();\n        // Validate userId\n        if (!userId || typeof userId !== 'string' || userId === 'undefined') {\n            console.error('Invalid userId provided to createConversation:', userId);\n            throw new Error('Invalid user ID');\n        }\n        try {\n            const newConversation = {\n                ..._models_conversation__WEBPACK_IMPORTED_MODULE_1__.conversationSchema,\n                userId: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(userId),\n                title: `Conversation ${new Date().toLocaleString()}`,\n                messages: [\n                    {\n                        sender: 'user',\n                        content: message,\n                        timestamp: new Date(),\n                        analysis: analysis || null\n                    }\n                ],\n                createdAt: new Date(),\n                updatedAt: new Date()\n            };\n            const result = await db.collection('conversations').insertOne(newConversation);\n            return {\n                ...newConversation,\n                _id: result.insertedId\n            };\n        } catch (error) {\n            console.error('Error in createConversation:', error);\n            throw error;\n        }\n    },\n    /**\r\n   * Add a message to an existing conversation\r\n   * @param {string} conversationId - Conversation ID\r\n   * @param {Object} message - Message object\r\n   * @param {Object} analysis - Sentiment analysis results\r\n   * @returns {Promise<Object>} - Updated conversation\r\n   */ addMessage: async (conversationId, message, analysis = null)=>{\n        const { db } = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.connectToDatabase)();\n        if (!conversationId) {\n            console.error('Invalid conversationId provided to addMessage');\n            throw new Error('Invalid conversation ID');\n        }\n        try {\n            const updateData = {\n                $push: {\n                    messages: message\n                },\n                $set: {\n                    updatedAt: new Date()\n                }\n            };\n            // Add sentiment analysis if available\n            if (analysis) {\n                updateData.$set.lastSentiment = analysis.sentiment;\n                updateData.$set.lastEmotions = analysis.emotions;\n                if (analysis.recommendations) {\n                    updateData.$set.recommendations = analysis.recommendations;\n                }\n            }\n            await db.collection('conversations').updateOne({\n                _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(conversationId)\n            }, updateData);\n            return await conversationService.getConversation(conversationId);\n        } catch (error) {\n            console.error('Error in addMessage:', error);\n            throw error;\n        }\n    },\n    /**\r\n   * Get a conversation by ID\r\n   * @param {string} conversationId - Conversation ID\r\n   * @returns {Promise<Object>} - Conversation\r\n   */ getConversation: async (conversationId)=>{\n        const { db } = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.connectToDatabase)();\n        if (!conversationId) {\n            console.error('Invalid conversationId provided to getConversation');\n            return null;\n        }\n        try {\n            return await db.collection('conversations').findOne({\n                _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(conversationId)\n            });\n        } catch (error) {\n            console.error('Error in getConversation:', error);\n            return null;\n        }\n    },\n    /**\r\n   * Get all conversations for a user\r\n   * @param {string} userId - User ID\r\n   * @returns {Promise<Array>} - List of conversations\r\n   */ getUserConversations: async (userId)=>{\n        const { db } = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.connectToDatabase)();\n        // Handle case when userId is invalid or undefined\n        if (!userId || typeof userId !== 'string' || userId === 'undefined') {\n            console.log('Invalid userId provided to getUserConversations:', userId);\n            return [];\n        }\n        try {\n            return await db.collection('conversations').find({\n                userId: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(userId)\n            }).sort({\n                updatedAt: -1\n            }).toArray();\n        } catch (error) {\n            console.error('Error in getUserConversations:', error);\n            return [];\n        }\n    },\n    /**\r\n   * Delete a conversation\r\n   * @param {string} conversationId - Conversation ID\r\n   * @returns {Promise<boolean>} - Success status\r\n   */ deleteConversation: async (conversationId)=>{\n        const { db } = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.connectToDatabase)();\n        if (!conversationId) {\n            console.error('Invalid conversationId provided to deleteConversation');\n            return false;\n        }\n        try {\n            const result = await db.collection('conversations').deleteOne({\n                _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(conversationId)\n            });\n            return result.deletedCount === 1;\n        } catch (error) {\n            console.error('Error in deleteConversation:', error);\n            return false;\n        }\n    },\n    /**\r\n   * Delete all conversations for a user\r\n   * @param {string} userId - User ID\r\n   * @returns {Promise<number>} - Number of deleted conversations\r\n   */ deleteAllConversations: async (userId)=>{\n        const { db } = await (0,_mongodb__WEBPACK_IMPORTED_MODULE_0__.connectToDatabase)();\n        if (!userId || typeof userId !== 'string' || userId === 'undefined') {\n            console.error('Invalid userId provided to deleteAllConversations:', userId);\n            return 0;\n        }\n        try {\n            const result = await db.collection('conversations').deleteMany({\n                userId: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(userId)\n            });\n            return result.deletedCount;\n        } catch (error) {\n            console.error('Error in deleteAllConversations:', error);\n            return 0;\n        }\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9zZXJ2aWNlcy9jb252ZXJzYXRpb24tc2VydmljZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUErQztBQUNhO0FBQ3pCO0FBRW5DOztDQUVDLEdBQ00sTUFBTUcsc0JBQXNCO0lBQ2pDOzs7Ozs7R0FNQyxHQUNEQyxvQkFBb0IsT0FBT0MsUUFBUUMsU0FBU0MsV0FBVyxJQUFJO1FBQ3pELE1BQU0sRUFBRUMsRUFBRSxFQUFFLEdBQUcsTUFBTVIsMkRBQWlCQTtRQUV0QyxrQkFBa0I7UUFDbEIsSUFBSSxDQUFDSyxVQUFVLE9BQU9BLFdBQVcsWUFBWUEsV0FBVyxhQUFhO1lBQ25FSSxRQUFRQyxLQUFLLENBQUMsa0RBQWtETDtZQUNoRSxNQUFNLElBQUlNLE1BQU07UUFDbEI7UUFFQSxJQUFJO1lBQ0YsTUFBTUMsa0JBQWtCO2dCQUN0QixHQUFHWCxvRUFBa0I7Z0JBQ3JCSSxRQUFRLElBQUlILDZDQUFRQSxDQUFDRztnQkFDckJRLE9BQU8sQ0FBQyxhQUFhLEVBQUUsSUFBSUMsT0FBT0MsY0FBYyxJQUFJO2dCQUNwREMsVUFBVTtvQkFDUjt3QkFDRUMsUUFBUTt3QkFDUkMsU0FBU1o7d0JBQ1RhLFdBQVcsSUFBSUw7d0JBQ2ZQLFVBQVVBLFlBQVk7b0JBQ3hCO2lCQUNEO2dCQUNEYSxXQUFXLElBQUlOO2dCQUNmTyxXQUFXLElBQUlQO1lBQ2pCO1lBRUEsTUFBTVEsU0FBUyxNQUFNZCxHQUFHZSxVQUFVLENBQUMsaUJBQWlCQyxTQUFTLENBQUNaO1lBQzlELE9BQU87Z0JBQUUsR0FBR0EsZUFBZTtnQkFBRWEsS0FBS0gsT0FBT0ksVUFBVTtZQUFDO1FBQ3RELEVBQUUsT0FBT2hCLE9BQU87WUFDZEQsUUFBUUMsS0FBSyxDQUFDLGdDQUFnQ0E7WUFDOUMsTUFBTUE7UUFDUjtJQUNGO0lBRUE7Ozs7OztHQU1DLEdBQ0RpQixZQUFZLE9BQU9DLGdCQUFnQnRCLFNBQVNDLFdBQVcsSUFBSTtRQUN6RCxNQUFNLEVBQUVDLEVBQUUsRUFB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QkE7UUFFdEMsSUFBSSxDQUFDSyxVQUFVLE9BQU9BLFdBQVcsWUFBWUEsV0FBVyxhQUFhO1lBQ25FSSxRQUFRQyxLQUFLLENBQUMsc0RBQXNETDtZQUNwRSxPQUFPO1FBQ1Q7UUFFQSxJQUFJO1lBQ0YsTUFBTWlCLFNBQVMsTUFBTWQsR0FBR2UsVUFBVSxDQUFDLGlCQUFpQjBCLFVBQVUsQ0FBQztnQkFDN0Q1QyxRQUFRLElBQUlILDZDQUFRQSxDQUFDRztZQUN2QjtZQUVBLE9BQU9pQixPQUFPeUIsWUFBWTtRQUM1QixFQUFFLE9BQU9yQyxPQUFPO1lBQ2RELFFBQVFDLEtBQUssQ0FBQyxvQ0FBb0NBO1lBQ2xELE9BQU87UUFDVDtJQUNGO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsiRDpcXFByb2plY3RzXFxEZWtodGUgaGFpXFxuZXVyb1N5bmNcXE5ldXJvU3luYy1BSS1Gcm9udGVuZFxcbGliXFxzZXJ2aWNlc1xcY29udmVyc2F0aW9uLXNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29ubmVjdFRvRGF0YWJhc2UgfSBmcm9tICcuLi9tb25nb2RiJztcclxuaW1wb3J0IHsgY29udmVyc2F0aW9uU2NoZW1hIH0gZnJvbSAnLi4vbW9kZWxzL2NvbnZlcnNhdGlvbic7XHJcbmltcG9ydCB7IE9iamVjdElkIH0gZnJvbSAnbW9uZ29kYic7XHJcblxyXG4vKipcclxuICogU2VydmljZSBmb3IgbWFuYWdpbmcgY29udmVyc2F0aW9ucyBpbiBNb25nb0RCXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgY29udmVyc2F0aW9uU2VydmljZSA9IHtcclxuICAvKipcclxuICAgKiBDcmVhdGUgYSBuZXcgY29udmVyc2F0aW9uXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIEluaXRpYWwgbWVzc2FnZSBjb250ZW50XHJcbiAgICogQHBhcmFtIHtPYmplY3R9IGFuYWx5c2lzIC0gT3B0aW9uYWwgc2VudGltZW50IGFuYWx5c2lzXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gLSBDcmVhdGVkIGNvbnZlcnNhdGlvblxyXG4gICAqL1xyXG4gIGNyZWF0ZUNvbnZlcnNhdGlvbjogYXN5bmMgKHVzZXJJZCwgbWVzc2FnZSwgYW5hbHlzaXMgPSBudWxsKSA9PiB7XHJcbiAgICBjb25zdCB7IGRiIH0gPSBhd2FpdCBjb25uZWN0VG9EYXRhYmFzZSgpO1xyXG4gICAgXHJcbiAgICAvLyBWYWxpZGF0ZSB1c2VySWRcclxuICAgIGlmICghdXNlcklkIHx8IHR5cGVvZiB1c2VySWQgIT09ICdzdHJpbmcnIHx8IHVzZXJJZCA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignSW52YWxpZCB1c2VySWQgcHJvdmlkZWQgdG8gY3JlYXRlQ29udmVyc2F0aW9uOicsIHVzZXJJZCk7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCB1c2VyIElEJyk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgbmV3Q29udmVyc2F0aW9uID0ge1xyXG4gICAgICAgIC4uLmNvbnZlcnNhdGlvblNjaGVtYSxcclxuICAgICAgICB1c2VySWQ6IG5ldyBPYmplY3RJZCh1c2VySWQpLFxyXG4gICAgICAgIHRpdGxlOiBgQ29udmVyc2F0aW9uICR7bmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygpfWAsXHJcbiAgICAgICAgbWVzc2FnZXM6IFtcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgc2VuZGVyOiAndXNlcicsXHJcbiAgICAgICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2UsXHJcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgICAgICAgYW5hbHlzaXM6IGFuYWx5c2lzIHx8IG51bGxcclxuICAgICAgICAgIH1cclxuICAgICAgICBdLFxyXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcclxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcclxuICAgICAgfTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2NvbnZlcnNhdGlvbnMnKS5pbnNlcnRPbmUobmV3Q29udmVyc2F0aW9uKTtcclxuICAgICAgcmV0dXJuIHsgLi4ubmV3Q29udmVyc2F0aW9uLCBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBjcmVhdGVDb252ZXJzYXRpb246JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9LFxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIEFkZCBhIG1lc3NhZ2UgdG8gYW4gZXhpc3RpbmcgY29udmVyc2F0aW9uXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNvbnZlcnNhdGlvbklkIC0gQ29udmVyc2F0aW9uIElEXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IG1lc3NhZ2UgLSBNZXNzYWdlIG9iamVjdFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBhbmFseXNpcyAtIFNlbnRpbWVudCBhbmFseXNpcyByZXN1bHRzXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gLSBVcGRhdGVkIGNvbnZlcnNhdGlvblxyXG4gICAqL1xyXG4gIGFkZE1lc3NhZ2U6IGFzeW5jIChjb252ZXJzYXRpb25JZCwgbWVzc2FnZSwgYW5hbHlzaXMgPSBudWxsKSA9PiB7XHJcbiAgICBjb25zdCB7IGRiIH0gPSBhd2FpdCBjb25uZWN0VG9EYXRhYmFzZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoIWNvbnZlcnNhdGlvbklkKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgY29udmVyc2F0aW9uSWQgcHJvdmlkZWQgdG8gYWRkTWVzc2FnZScpO1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgY29udmVyc2F0aW9uIElEJyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZURhdGEgPSB7XHJcbiAgICAgICAgJHB1c2g6IHsgbWVzc2FnZXM6IG1lc3NhZ2UgfSxcclxuICAgICAgICAkc2V0OiB7IHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9XHJcbiAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBBZGQgc2VudGltZW50IGFuYWx5c2lzIGlmIGF2YWlsYWJsZVxyXG4gICAgICBpZiAoYW5hbHlzaXMpIHtcclxuICAgICAgICB1cGRhdGVEYXRhLiRzZXQubGFzdFNlbnRpbWVudCA9IGFuYWx5c2lzLnNlbnRpbWVudDtcclxuICAgICAgICB1cGRhdGVEYXRhLiRzZXQubGFzdEVtb3Rpb25zID0gYW5hbHlzaXMuZW1vdGlvbnM7XHJcbiAgICAgICAgaWYgKGFuYWx5c2lzLnJlY29tbWVuZGF0aW9ucykge1xyXG4gICAgICAgICAgdXBkYXRlRGF0YS4kc2V0LnJlY29tbWVuZGF0aW9ucyA9IGFuYWx5c2lzLnJlY29tbWVuZGF0aW9ucztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2NvbnZlcnNhdGlvbnMnKS51cGRhdGVPbmUoXHJcbiAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChjb252ZXJzYXRpb25JZCkgfSxcclxuICAgICAgICB1cGRhdGVEYXRhXHJcbiAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gYXdhaXQgY29udmVyc2F0aW9uU2VydmljZS5nZXRDb252ZXJzYXRpb24oY29udmVyc2F0aW9uSWQpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gYWRkTWVzc2FnZTonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH0sXHJcbiAgXHJcbiAgLyoqXHJcbiAgICogR2V0IGEgY29udmVyc2F0aW9uIGJ5IElEXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNvbnZlcnNhdGlvbklkIC0gQ29udmVyc2F0aW9uIElEXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gLSBDb252ZXJzYXRpb25cclxuICAgKi9cclxuICBnZXRDb252ZXJzYXRpb246IGFzeW5jIChjb252ZXJzYXRpb25JZCkgPT4ge1xyXG4gICAgY29uc3QgeyBkYiB9ID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICAgIFxyXG4gICAgaWYgKCFjb252ZXJzYXRpb25JZCkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIGNvbnZlcnNhdGlvbklkIHByb3ZpZGVkIHRvIGdldENvbnZlcnNhdGlvbicpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2NvbnZlcnNhdGlvbnMnKS5maW5kT25lKHtcclxuICAgICAgICBfaWQ6IG5ldyBPYmplY3RJZChjb252ZXJzYXRpb25JZClcclxuICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRDb252ZXJzYXRpb246JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9LFxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIEdldCBhbGwgY29udmVyc2F0aW9ucyBmb3IgYSB1c2VyXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxBcnJheT59IC0gTGlzdCBvZiBjb252ZXJzYXRpb25zXHJcbiAgICovXHJcbiAgZ2V0VXNlckNvbnZlcnNhdGlvbnM6IGFzeW5jICh1c2VySWQpID0+IHtcclxuICAgIGNvbnN0IHsgZGIgfSA9IGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XHJcbiAgICBcclxuICAgIC8vIEhhbmRsZSBjYXNlIHdoZW4gdXNlcklkIGlzIGludmFsaWQgb3IgdW5kZWZpbmVkXHJcbiAgICBpZiAoIXVzZXJJZCB8fCB0eXBlb2YgdXNlcklkICE9PSAnc3RyaW5nJyB8fCB1c2VySWQgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdJbnZhbGlkIHVzZXJJZCBwcm92aWRlZCB0byBnZXRVc2VyQ29udmVyc2F0aW9uczonLCB1c2VySWQpO1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjb252ZXJzYXRpb25zJylcclxuICAgICAgICAuZmluZCh7IHVzZXJJZDogbmV3IE9iamVjdElkKHVzZXJJZCkgfSlcclxuICAgICAgICAuc29ydCh7IHVwZGF0ZWRBdDogLTEgfSlcclxuICAgICAgICAudG9BcnJheSgpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0VXNlckNvbnZlcnNhdGlvbnM6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgfSxcclxuICBcclxuICAvKipcclxuICAgKiBEZWxldGUgYSBjb252ZXJzYXRpb25cclxuICAgKiBAcGFyYW0ge3N0cmluZ30gY29udmVyc2F0aW9uSWQgLSBDb252ZXJzYXRpb24gSURcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gLSBTdWNjZXNzIHN0YXR1c1xyXG4gICAqL1xyXG4gIGRlbGV0ZUNvbnZlcnNhdGlvbjogYXN5bmMgKGNvbnZlcnNhdGlvbklkKSA9PiB7XHJcbiAgICBjb25zdCB7IGRiIH0gPSBhd2FpdCBjb25uZWN0VG9EYXRhYmFzZSgpO1xyXG4gICAgXHJcbiAgICBpZiAoIWNvbnZlcnNhdGlvbklkKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgY29udmVyc2F0aW9uSWQgcHJvdmlkZWQgdG8gZGVsZXRlQ29udmVyc2F0aW9uJyk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuY29sbGVjdGlvbignY29udmVyc2F0aW9ucycpLmRlbGV0ZU9uZSh7XHJcbiAgICAgICAgX2lkOiBuZXcgT2JqZWN0SWQoY29udmVyc2F0aW9uSWQpXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHJlc3VsdC5kZWxldGVkQ291bnQgPT09IDE7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBkZWxldGVDb252ZXJzYXRpb246JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfSxcclxuICBcclxuICAvKipcclxuICAgKiBEZWxldGUgYWxsIGNvbnZlcnNhdGlvbnMgZm9yIGEgdXNlclxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1c2VySWQgLSBVc2VyIElEXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8bnVtYmVyPn0gLSBOdW1iZXIgb2YgZGVsZXRlZCBjb252ZXJzYXRpb25zXHJcbiAgICovXHJcbiAgZGVsZXRlQWxsQ29udmVyc2F0aW9uczogYXN5bmMgKHVzZXJJZCkgPT4ge1xyXG4gICAgY29uc3QgeyBkYiB9ID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICAgIFxyXG4gICAgaWYgKCF1c2VySWQgfHwgdHlwZW9mIHVzZXJJZCAhPT0gJ3N0cmluZycgfHwgdXNlcklkID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIHVzZXJJZCBwcm92aWRlZCB0byBkZWxldGVBbGxDb252ZXJzYXRpb25zOicsIHVzZXJJZCk7XHJcbiAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5jb2xsZWN0aW9uKCdjb252ZXJzYXRpb25zJykuZGVsZXRlTWFueSh7XHJcbiAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQodXNlcklkKVxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiByZXN1bHQuZGVsZXRlZENvdW50O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZGVsZXRlQWxsQ29udmVyc2F0aW9uczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG4gIH1cclxufTsgIl0sIm5hbWVzIjpbImNvbm5lY3RUb0RhdGFiYXNlIiwiY29udmVyc2F0aW9uU2NoZW1hIiwiT2JqZWN0SWQiLCJjb252ZXJzYXRpb25TZXJ2aWNlIiwiY3JlYXRlQ29udmVyc2F0aW9uIiwidXNlcklkIiwibWVzc2FnZSIsImFuYWx5c2lzIiwiZGIiLCJjb25zb2xlIiwiZXJyb3IiLCJFcnJvciIsIm5ld0NvbnZlcnNhdGlvbiIsInRpdGxlIiwiRGF0ZSIsInRvTG9jYWxlU3RyaW5nIiwibWVzc2FnZXMiLCJzZW5kZXIiLCJjb250ZW50IiwidGltZXN0YW1wIiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwicmVzdWx0IiwiY29sbGVjdGlvbiIsImluc2VydE9uZSIsIl9pZCIsImluc2VydGVkSWQiLCJhZGRNZXNzYWdlIiwiY29udmVyc2F0aW9uSWQiLCJ1cGRhdGVEYXRhIiwiJHB1c2giLCIkc2V0IiwibGFzdFNlbnRpbWVudCIsInNlbnRpbWVudCIsImxhc3RFbW90aW9ucyIsImVtb3Rpb25zIiwicmVjb21tZW5kYXRpb25zIiwidXBkYXRlT25lIiwiZ2V0Q29udmVyc2F0aW9uIiwiZmluZE9uZSIsImdldFVzZXJDb252ZXJzYXRpb25zIiwibG9nIiwiZmluZCIsInNvcnQiLCJ0b0FycmF5IiwiZGVsZXRlQ29udmVyc2F0aW9uIiwiZGVsZXRlT25lIiwiZGVsZXRlZENvdW50IiwiZGVsZXRlQWxsQ29udmVyc2F0aW9ucyIsImRlbGV0ZU1hbnkiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/services/conversation-service.js\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fai%2Flocal-chat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cai%5Clocal-chat.js&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fai%2Flocal-chat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cai%5Clocal-chat.js&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_ai_local_chat_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\ai\\local-chat.js */ \"(api-node)/./pages/api/ai/local-chat.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_ai_local_chat_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_ai_local_chat_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_ai_local_chat_js__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_ai_local_chat_js__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/ai/local-chat\",\n        pathname: \"/api/ai/local-chat\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_ai_local_chat_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGYWklMkZsb2NhbC1jaGF0JnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNhaSU1Q2xvY2FsLWNoYXQuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ0U7QUFDMUQ7QUFDNEQ7QUFDNUQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHdEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyx3REFBUTtBQUNwQztBQUNPLHdCQUF3Qix5R0FBbUI7QUFDbEQ7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxhaVxcXFxsb2NhbC1jaGF0LmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsICdkZWZhdWx0Jyk7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCAnY29uZmlnJyk7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9haS9sb2NhbC1jaGF0XCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYWkvbG9jYWwtY2hhdFwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6ICcnLFxuICAgICAgICBmaWxlbmFtZTogJydcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fai%2Flocal-chat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cai%5Clocal-chat.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/ai/local-chat.js":
/*!************************************!*\
  !*** ./pages/api/ai/local-chat.js ***!
  \************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_local_ai_middleware__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/local-ai-middleware */ \"(api-node)/./lib/local-ai-middleware.js\");\n/* harmony import */ var _lib_services_conversation_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/services/conversation-service */ \"(api-node)/./lib/services/conversation-service.js\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _lib_mongodb__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../lib/mongodb */ \"(api-node)/./lib/mongodb.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_local_ai_middleware__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_local_ai_middleware__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// Sample recommendation data for fallback\nconst SAMPLE_RECOMMENDATIONS = [\n    {\n        type: 'exercise',\n        title: 'Deep Breathing Exercise',\n        description: 'Take 5 deep breaths, inhaling for 4 seconds and exhaling for 6 seconds.',\n        actionUrl: '/resources/exercises/breathing',\n        actionText: 'Start Exercise'\n    },\n    {\n        type: 'resource',\n        title: 'Understanding Anxiety',\n        description: 'Learn about the causes and effects of anxiety in everyday life.',\n        actionUrl: '/resources/articles/anxiety',\n        actionText: 'Read Article'\n    },\n    {\n        type: 'checkin',\n        title: 'Mood Check-in',\n        description: \"Record how you're feeling right now to track your emotional patterns.\",\n        actionUrl: '/checkin',\n        actionText: 'Check In'\n    }\n];\nasync function handler(req, res) {\n    // Only allow POST requests\n    if (req.method !== 'POST') {\n        return res.status(405).json({\n            message: 'Method not allowed'\n        });\n    }\n    try {\n        const { message, history, userId, conversationId } = req.body;\n        if (!message) {\n            return res.status(400).json({\n                message: 'Message is required'\n            });\n        }\n        // Get user profile if userId is provided\n        let userProfile = {};\n        if (userId) {\n            // In a real implementation, fetch user profile from database\n            userProfile = {\n                id: userId,\n                name: \"User\"\n            };\n        }\n        try {\n            // Process the message through local LLaMA middleware\n            const result = await _lib_local_ai_middleware__WEBPACK_IMPORTED_MODULE_0__.localAiMiddleware.processInput(message, history, userProfile);\n            // Save to MongoDB based on whether it's a new or existing conversation\n            let savedConversationId = conversationId;\n            let savedConversation;\n            // Create or update conversation in MongoDB\n            try {\n                if (!conversationId) {\n                    // New conversation\n                    savedConversation = await _lib_services_conversation_service__WEBPACK_IMPORTED_MODULE_1__.conversationService.createConversation(userId, message, {\n                        sentiment: result.sentiment,\n                        emotions: result.emotions\n                    });\n                    savedConversationId = savedConversation._id.toString();\n                    // Add AI response to the conversation\n                    await _lib_services_conversation_service__WEBPACK_IMPORTED_MODULE_1__.conversationService.addMessage(savedConversationId, {\n                        sender: 'bot',\n                        content: result.response,\n                        timestamp: new Date()\n                    });\n                } else {\n                    // Add message to existing conversation\n                    await _lib_services_conversation_service__WEBPACK_IMPORTED_MODULE_1__.conversationService.addMessage(conversationId, {\n                        sender: 'user',\n                        content: message,\n                        timestamp: new Date(),\n                        analysis: {\n                            sentiment: result.sentiment,\n                            emotions: result.emotions\n                        }\n                    });\n                    // Add AI response to the conversation\n                    savedConversation = await _lib_services_conversation_service__WEBPACK_IMPORTED_MODULE_1__.conversationService.addMessage(conversationId, {\n                        sender: 'bot',\n                        content: result.response,\n                        timestamp: new Date()\n                    });\n                }\n                // Update recommendations if available\n                if (result.recommendations && Array.isArray(result.recommendations) && result.recommendations.length > 0) {\n                    const { db } = await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_3__.connectToDatabase)();\n                    await db.collection('conversations').updateOne({\n                        _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(savedConversationId)\n                    }, {\n                        $set: {\n                            recommendations: result.recommendations\n                        }\n                    });\n                }\n            } catch (dbError) {\n                console.error('Error saving conversation to MongoDB:', dbError);\n            // Continue even if DB save fails\n            }\n            // Return AI response to client\n            res.status(200).json({\n                message: result.response,\n                sentiment: result.sentiment,\n                emotions: result.emotions,\n                recommendations: result.recommendations,\n                conversationId: savedConversationId\n            });\n        } catch (error) {\n            console.error('Error in local LLaMA processing:', error);\n            // Fallback response\n            const lowerMessage = message.toLowerCase();\n            let sentiment = 'neutral';\n            let responseText = \"I understand what you're saying. How else can I help you today?\";\n            let emotions = {\n                primary: 'neutral',\n                confidence: 0.8\n            };\n            if (lowerMessage.includes('sad') || lowerMessage.includes('depress') || lowerMessage.includes('upset')) {\n                sentiment = 'negative';\n                emotions = {\n                    primary: 'sad',\n                    confidence: 0.8\n                };\n                responseText = \"I'm sorry to hear you're feeling down. Remember that it's okay to have these feelings, and there are resources available to help.\";\n            } else if (lowerMessage.includes('happy') || lowerMessage.includes('great') || lowerMessage.includes('good')) {\n                sentiment = 'positive';\n                emotions = {\n                    primary: 'happy',\n                    confidence: 0.8\n                };\n                responseText = \"I'm glad to hear you're feeling positive! That's wonderful.\";\n            } else if (lowerMessage.includes('anxious') || lowerMessage.includes('worry') || lowerMessage.includes('stress')) {\n                sentiment = 'negative';\n                emotions = {\n                    primary: 'anxious',\n                    confidence: 0.8\n                };\n                responseText = \"It sounds like you might be feeling anxious. Deep breathing can sometimes help in moments like this.\";\n            } else if (lowerMessage.includes('suicide') || lowerMessage.includes('kill myself') || lowerMessage.includes('end my life')) {\n                sentiment = 'negative';\n                emotions = {\n                    primary: 'distressed',\n                    confidence: 0.9\n                };\n                responseText = \"I'm concerned about what you're saying. If you're having thoughts of harming yourself, please reach out to a crisis helpline immediately. In the US, you can call or text 988 to reach the Suicide and Crisis Lifeline, or chat at 988lifeline.org. They provide free, confidential support 24/7. Your life matters, and help is available.\";\n            }\n            // Save to MongoDB even in fallback case\n            let savedConversationId = conversationId;\n            try {\n                if (!conversationId) {\n                    // New conversation\n                    const savedConversation = await _lib_services_conversation_service__WEBPACK_IMPORTED_MODULE_1__.conversationService.createConversation(userId, message, {\n                        sentiment: sentiment,\n                        emotions: emotions\n                    });\n                    savedConversationId = savedConversation._id.toString();\n                    // Add AI response\n                    await _lib_services_conversation_service__WEBPACK_IMPORTED_MODULE_1__.conversationService.addMessage(savedConversationId, {\n                        sender: 'bot',\n                        content: responseText,\n                        timestamp: new Date()\n                    });\n                } else {\n                    // Add to existing conversation\n                    await _lib_services_conversation_service__WEBPACK_IMPORTED_MODULE_1__.conversationService.addMessage(conversationId, {\n                        sender: 'user',\n                        content: message,\n                        timestamp: new Date(),\n                        analysis: {\n                            sentiment: sentiment,\n                            emotions: emotions\n                        }\n                    });\n                    // Add AI response\n                    await _lib_services_conversation_service__WEBPACK_IMPORTED_MODULE_1__.conversationService.addMessage(conversationId, {\n                        sender: 'bot',\n                        content: responseText,\n                        timestamp: new Date()\n                    });\n                }\n            } catch (dbError) {\n                console.error('Error saving fallback response to MongoDB:', dbError);\n            }\n            res.status(200).json({\n                message: responseText,\n                sentiment: sentiment,\n                emotions: emotions,\n                recommendations: SAMPLE_RECOMMENDATIONS,\n                conversationId: savedConversationId\n            });\n        }\n    } catch (error) {\n        console.error('Error in local chat API:', error);\n        res.status(500).json({\n            message: 'An error occurred while processing your message',\n            error:  true ? error.message : 0\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WUFDOUQ7WUFFQXBDLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQ25CQyxTQUFTcUM7Z0JBQ1R4QixXQUFXQTtnQkFDWEMsVUFBVUE7Z0JBQ1ZVLGlCQUFpQnBDO2dCQUNqQmUsZ0JBQWdCTztZQUNsQjtRQUNGO0lBQ0YsRUFBRSxPQUFPd0IsT0FBTztRQUNkRCxRQUFRQyxLQUFLLENBQUMsNEJBQTRCQTtRQUMxQ3RDLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFDbkJDLFNBQVM7WUFDVGtDLE9BQU9PLEtBQXNDLEdBQUdQLE1BQU1sQyxPQUFPLEdBQUcwQyxDQUFTQTtRQUMzRTtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIkQ6XFxQcm9qZWN0c1xcRGVraHRlIGhhaVxcbmV1cm9TeW5jXFxOZXVyb1N5bmMtQUktRnJvbnRlbmRcXHBhZ2VzXFxhcGlcXGFpXFxsb2NhbC1jaGF0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGxvY2FsQWlNaWRkbGV3YXJlIH0gZnJvbSAnLi4vLi4vLi4vbGliL2xvY2FsLWFpLW1pZGRsZXdhcmUnO1xyXG5pbXBvcnQgeyBjb252ZXJzYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vbGliL3NlcnZpY2VzL2NvbnZlcnNhdGlvbi1zZXJ2aWNlJztcclxuaW1wb3J0IHsgT2JqZWN0SWQgfSBmcm9tICdtb25nb2RiJztcclxuaW1wb3J0IHsgY29ubmVjdFRvRGF0YWJhc2UgfSBmcm9tICcuLi8uLi8uLi9saWIvbW9uZ29kYic7XHJcblxyXG4vLyBTYW1wbGUgcmVjb21tZW5kYXRpb24gZGF0YSBmb3IgZmFsbGJhY2tcclxuY29uc3QgU0FNUExFX1JFQ09NTUVOREFUSU9OUyA9IFtcclxuICB7XHJcbiAgICB0eXBlOiAnZXhlcmNpc2UnLFxyXG4gICAgdGl0bGU6ICdEZWVwIEJyZWF0aGluZyBFeGVyY2lzZScsXHJcbiAgICBkZXNjcmlwdGlvbjogJ1Rha2UgNSBkZWVwIGJyZWF0aHMsIGluaGFsaW5nIGZvciA0IHNlY29uZHMgYW5kIGV4aGFsaW5nIGZvciA2IHNlY29uZHMuJyxcclxuICAgIGFjdGlvblVybDogJy9yZXNvdXJjZXMvZXhlcmNpc2VzL2JyZWF0aGluZycsXHJcbiAgICBhY3Rpb25UZXh0OiAnU3RhcnQgRXhlcmNpc2UnXHJcbiAgfSxcclxuICB7XHJcbiAgICB0eXBlOiAncmVzb3VyY2UnLFxyXG4gICAgdGl0bGU6ICdVbmRlcnN0YW5kaW5nIEFueGlldHknLFxyXG4gICAgZGVzY3JpcHRpb246ICdMZWFybiBhYm91dCB0aGUgY2F1c2VzIGFuZCBlZmZlY3RzIG9mIGFueGlldHkgaW4gZXZlcnlkYXkgbGlmZS4nLFxyXG4gICAgYWN0aW9uVXJsOiAnL3Jlc291cmNlcy9hcnRpY2xlcy9hbnhpZXR5JyxcclxuICAgIGFjdGlvblRleHQ6ICdSZWFkIEFydGljbGUnXHJcbiAgfSxcclxuICB7XHJcbiAgICB0eXBlOiAnY2hlY2tpbicsXHJcbiAgICB0aXRsZTogJ01vb2QgQ2hlY2staW4nLFxyXG4gICAgZGVzY3JpcHRpb246IFwiUmVjb3JkIGhvdyB5b3UncmUgZmVlbGluZyByaWdodCBub3cgdG8gdHJhY2sgeW91ciBlbW90aW9uYWwgcGF0dGVybnMuXCIsXHJcbiAgICBhY3Rpb25Vcmw6ICcvY2hlY2tpbicsXHJcbiAgICBhY3Rpb25UZXh0OiAnQ2hlY2sgSW4nXHJcbiAgfVxyXG5dO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcykge1xyXG4gIC8vIE9ubHkgYWxsb3cgUE9TVCByZXF1ZXN0c1xyXG4gIGlmIChyZXEubWV0aG9kICE9PSAnUE9TVCcpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IG1lc3NhZ2U6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgbWVzc2FnZSwgaGlzdG9yeSwgdXNlcklkLCBjb252ZXJzYXRpb25JZCB9ID0gcmVxLmJvZHk7XHJcbiAgICBcclxuICAgIGlmICghbWVzc2FnZSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnTWVzc2FnZSBpcyByZXF1aXJlZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2V0IHVzZXIgcHJvZmlsZSBpZiB1c2VySWQgaXMgcHJvdmlkZWRcclxuICAgIGxldCB1c2VyUHJvZmlsZSA9IHt9O1xyXG4gICAgaWYgKHVzZXJJZCkge1xyXG4gICAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIGZldGNoIHVzZXIgcHJvZmlsZSBmcm9tIGRhdGFiYXNlXHJcbiAgICAgIHVzZXJQcm9maWxlID0ge1xyXG4gICAgICAgIGlkOiB1c2VySWQsXHJcbiAgICAgICAgbmFtZTogXCJVc2VyXCIsIC8vIFRoaXMgd291bGQgYmUgZmV0Y2hlZCBmcm9tIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgIC8vIE90aGVyIHVzZXIgZGF0YSB3b3VsZCBiZSBmZXRjaGVkIGZyb20gZGF0YWJhc2VcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBQcm9jZXNzIHRoZSBtZXNzYWdlIHRocm91Z2ggbG9jYWwgTExhTUEgbWlkZGxld2FyZVxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBsb2NhbEFpTWlkZGxld2FyZS5wcm9jZXNzSW5wdXQobWVzc2FnZSwgaGlzdG9yeSwgdXNlclByb2ZpbGUpO1xyXG4gICAgICBcclxuICAgICAgLy8gU2F2ZSB0byBNb25nb0RCIGJhc2VkIG9uIHdoZXRoZXIgaXQncyBhIG5ldyBvciBleGlzdGluZyBjb252ZXJzYXRpb25cclxuICAgICAgbGV0IHNhdmVkQ29udmVyc2F0aW9uSWQgPSBjb252ZXJzYXRpb25JZDtcclxuICAgICAgbGV0IHNhdmVkQ29udmVyc2F0aW9uO1xyXG4gICAgICBcclxuICAgICAgLy8gQ3JlYXRlIG9yIHVwZGF0ZSBjb252ZXJzYXRpb24gaW4gTW9uZ29EQlxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGlmICghY29udmVyc2F0aW9uSWQpIHtcclxuICAgICAgICAgIC8vIE5ldyBjb252ZXJzYXRpb25cclxuICAgICAgICAgIHNhdmVkQ29udmVyc2F0aW9uID0gYXdhaXQgY29udmVyc2F0aW9uU2VydmljZS5jcmVhdGVDb252ZXJzYXRpb24oXHJcbiAgICAgICAgICAgIHVzZXJJZCxcclxuICAgICAgICAgICAgbWVzc2FnZSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgIHNlbnRpbWVudDogcmVzdWx0LnNlbnRpbWVudCxcclxuICAgICAgICAgICAgICBlbW90aW9uczogcmVzdWx0LmVtb3Rpb25zXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBzYXZlZENvbnZlcnNhdGlvbklkID0gc2F2ZWRDb252ZXJzYXRpb24uX2lkLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIEFkZCBBSSByZXNwb25zZSB0byB0aGUgY29udmVyc2F0aW9uXHJcbiAgICAgICAgICBhd2FpdCBjb252ZXJzYXRpb25TZXJ2aWNlLmFkZE1lc3NhZ2UoXHJcbiAgICAgICAgICAgIHNhdmVkQ29udmVyc2F0aW9uSWQsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBzZW5kZXI6ICdib3QnLFxyXG4gICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3VsdC5yZXNwb25zZSxcclxuICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gQWRkIG1lc3NhZ2UgdG8gZXhpc3RpbmcgY29udmVyc2F0aW9uXHJcbiAgICAgICAgICBhd2FpdCBjb252ZXJzYXRpb25TZXJ2aWNlLmFkZE1lc3NhZ2UoXHJcbiAgICAgICAgICAgIGNvbnZlcnNhdGlvbklkLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgc2VuZGVyOiAndXNlcicsXHJcbiAgICAgICAgICAgICAgY29udGVudDogbWVzc2FnZSxcclxuICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgICAgICAgYW5hbHlzaXM6IHtcclxuICAgICAgICAgICAgICAgIHNlbnRpbWVudDogcmVzdWx0LnNlbnRpbWVudCxcclxuICAgICAgICAgICAgICAgIGVtb3Rpb25zOiByZXN1bHQuZW1vdGlvbnNcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIEFkZCBBSSByZXNwb25zZSB0byB0aGUgY29udmVyc2F0aW9uXHJcbiAgICAgICAgICBzYXZlZENvbnZlcnNhdGlvbiA9IGF3YWl0IGNvbnZlcnNhdGlvblNlcnZpY2UuYWRkTWVzc2FnZShcclxuICAgICAgICAgICAgY29udmVyc2F0aW9uSWQsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBzZW5kZXI6ICdib3QnLFxyXG4gICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3VsdC5yZXNwb25zZSxcclxuICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gVXBkYXRlIHJlY29tbWVuZGF0aW9ucyBpZiBhdmFpbGFibGVcclxuICAgICAgICBpZiAocmVzdWx0LnJlY29tbWVuZGF0aW9ucyAmJiBBcnJheS5pc0FycmF5KHJlc3VsdC5yZWNvbW1lbmRhdGlvbnMpICYmIHJlc3VsdC5yZWNvbW1lbmRhdGlvbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgY29uc3QgeyBkYiB9ID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcclxuICAgICAgICAgIGF3YWl0IGRiLmNvbGxlY3Rpb24oJ2NvbnZlcnNhdGlvbnMnKS51cGRhdGVPbmUoXHJcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoc2F2ZWRDb252ZXJzYXRpb25JZCkgfSxcclxuICAgICAgICAgICAgeyAkc2V0OiB7IHJlY29tbWVuZGF0aW9uczogcmVzdWx0LnJlY29tbWVuZGF0aW9ucyB9IH1cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGNhdGNoIChkYkVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc2F2aW5nIGNvbnZlcnNhdGlvbiB0byBNb25nb0RCOicsIGRiRXJyb3IpO1xyXG4gICAgICAgIC8vIENvbnRpbnVlIGV2ZW4gaWYgREIgc2F2ZSBmYWlsc1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBSZXR1cm4gQUkgcmVzcG9uc2UgdG8gY2xpZW50XHJcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgICBtZXNzYWdlOiByZXN1bHQucmVzcG9uc2UsXHJcbiAgICAgICAgc2VudGltZW50OiByZXN1bHQuc2VudGltZW50LFxyXG4gICAgICAgIGVtb3Rpb25zOiByZXN1bHQuZW1vdGlvbnMsXHJcbiAgICAgICAgcmVjb21tZW5kYXRpb25zOiByZXN1bHQucmVjb21tZW5kYXRpb25zLFxyXG4gICAgICAgIGNvbnZlcnNhdGlvbklkOiBzYXZlZENvbnZlcnNhdGlvbklkXHJcbiAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gbG9jYWwgTExhTUEgcHJvY2Vzc2luZzonLCBlcnJvcik7XHJcbiAgICAgIFxyXG4gICAgICAvLyBGYWxsYmFjayByZXNwb25zZVxyXG4gICAgICBjb25zdCBsb3dlck1lc3NhZ2UgPSBtZXNzYWdlLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIGxldCBzZW50aW1lbnQgPSAnbmV1dHJhbCc7XHJcbiAgICAgIGxldCByZXNwb25zZVRleHQgPSBcIkkgdW5kZXJzdGFuZCB3aGF0IHlvdSdyZSBzYXlpbmcuIEhvdyBlbHNlIGNhbiBJIGhlbHAgeW91IHRvZGF5P1wiO1xyXG4gICAgICBsZXQgZW1vdGlvbnMgPSB7IHByaW1hcnk6ICduZXV0cmFsJywgY29uZmlkZW5jZTogMC44IH07XHJcbiAgICAgIFxyXG4gICAgICBpZiAobG93ZXJNZXNzYWdlLmluY2x1ZGVzKCdzYWQnKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ2RlcHJlc3MnKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ3Vwc2V0JykpIHtcclxuICAgICAgICBzZW50aW1lbnQgPSAnbmVnYXRpdmUnO1xyXG4gICAgICAgIGVtb3Rpb25zID0geyBwcmltYXJ5OiAnc2FkJywgY29uZmlkZW5jZTogMC44IH07XHJcbiAgICAgICAgcmVzcG9uc2VUZXh0ID0gXCJJJ20gc29ycnkgdG8gaGVhciB5b3UncmUgZmVlbGluZyBkb3duLiBSZW1lbWJlciB0aGF0IGl0J3Mgb2theSB0byBoYXZlIHRoZXNlIGZlZWxpbmdzLCBhbmQgdGhlcmUgYXJlIHJlc291cmNlcyBhdmFpbGFibGUgdG8gaGVscC5cIjtcclxuICAgICAgfSBlbHNlIGlmIChsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ2hhcHB5JykgfHwgbG93ZXJNZXNzYWdlLmluY2x1ZGVzKCdncmVhdCcpIHx8IGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnZ29vZCcpKSB7XHJcbiAgICAgICAgc2VudGltZW50ID0gJ3Bvc2l0aXZlJztcclxuICAgICAgICBlbW90aW9ucyA9IHsgcHJpbWFyeTogJ2hhcHB5JywgY29uZmlkZW5jZTogMC44IH07XHJcbiAgICAgICAgcmVzcG9uc2VUZXh0ID0gXCJJJ20gZ2xhZCB0byBoZWFyIHlvdSdyZSBmZWVsaW5nIHBvc2l0aXZlISBUaGF0J3Mgd29uZGVyZnVsLlwiO1xyXG4gICAgICB9IGVsc2UgaWYgKGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnYW54aW91cycpIHx8IGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnd29ycnknKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ3N0cmVzcycpKSB7XHJcbiAgICAgICAgc2VudGltZW50ID0gJ25lZ2F0aXZlJztcclxuICAgICAgICBlbW90aW9ucyA9IHsgcHJpbWFyeTogJ2FueGlvdXMnLCBjb25maWRlbmNlOiAwLjggfTtcclxuICAgICAgICByZXNwb25zZVRleHQgPSBcIkl0IHNvdW5kcyBsaWtlIHlvdSBtaWdodCBiZSBmZWVsaW5nIGFueGlvdXMuIERlZXAgYnJlYXRoaW5nIGNhbiBzb21ldGltZXMgaGVscCBpbiBtb21lbnRzIGxpa2UgdGhpcy5cIjtcclxuICAgICAgfSBlbHNlIGlmIChsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ3N1aWNpZGUnKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ2tpbGwgbXlzZWxmJykgfHwgbG93ZXJNZXNzYWdlLmluY2x1ZGVzKCdlbmQgbXkgbGlmZScpKSB7XHJcbiAgICAgICAgc2VudGltZW50ID0gJ25lZ2F0aXZlJztcclxuICAgICAgICBlbW90aW9ucyA9IHsgcHJpbWFyeTogJ2Rpc3RyZXNzZWQnLCBjb25maWRlbmNlOiAwLjkgfTtcclxuICAgICAgICByZXNwb25zZVRleHQgPSBcIkknbSBjb25jZXJuZWQgYWJvdXQgd2hhdCB5b3UncmUgc2F5aW5nLiBJZiB5b3UncmUgaGF2aW5nIHRob3VnaHRzIG9mIGhhcm1pbmcgeW91cnNlbGYsIHBsZWFzZSByZWFjaCBvdXQgdG8gYSBjcmlzaXMgaGVscGxpbmUgaW1tZWRpYXRlbHkuIEluIHRoZSBVUywgeW91IGNhbiBjYWxsIG9yIHRleHQgOTg4IHRvIHJlYWNoIHRoZSBTdWljaWRlIGFuZCBDcmlzaXMgTGlmZWxpbmUsIG9yIGNoYXQgYXQgOTg4bGlmZWxpbmUub3JnLiBUaGV5IHByb3ZpZGUgZnJlZSwgY29uZmlkZW50aWFsIHN1cHBvcnQgMjQvNy4gWW91ciBsaWZlIG1hdHRlcnMsIGFuZCBoZWxwIGlzIGF2YWlsYWJsZS5cIjtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gU2F2ZSB0byBNb25nb0RCIGV2ZW4gaW4gZmFsbGJhY2sgY2FzZVxyXG4gICAgICBsZXQgc2F2ZWRDb252ZXJzYXRpb25JZCA9IGNvbnZlcnNhdGlvbklkO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGlmICghY29udmVyc2F0aW9uSWQpIHtcclxuICAgICAgICAgIC8vIE5ldyBjb252ZXJzYXRpb25cclxuICAgICAgICAgIGNvbnN0IHNhdmVkQ29udmVyc2F0aW9uID0gYXdhaXQgY29udmVyc2F0aW9uU2VydmljZS5jcmVhdGVDb252ZXJzYXRpb24oXHJcbiAgICAgICAgICAgIHVzZXJJZCxcclxuICAgICAgICAgICAgbWVzc2FnZSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgIHNlbnRpbWVudDogc2VudGltZW50LFxyXG4gICAgICAgICAgICAgIGVtb3Rpb25zOiBlbW90aW9uc1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgc2F2ZWRDb252ZXJzYXRpb25JZCA9IHNhdmVkQ29udmVyc2F0aW9uLl9pZC50b1N0cmluZygpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBBZGQgQUkgcmVzcG9uc2VcclxuICAgICAgICAgIGF3YWl0IGNvbnZlcnNhdGlvblNlcnZpY2UuYWRkTWVzc2FnZShcclxuICAgICAgICAgICAgc2F2ZWRDb252ZXJzYXRpb25JZCxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgIHNlbmRlcjogJ2JvdCcsXHJcbiAgICAgICAgICAgICAgY29udGVudDogcmVzcG9uc2VUZXh0LFxyXG4gICAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBBZGQgdG8gZXhpc3RpbmcgY29udmVyc2F0aW9uXHJcbiAgICAgICAgICBhd2FpdCBjb252ZXJzYXRpb25TZXJ2aWNlLmFkZE1lc3NhZ2UoXHJcbiAgICAgICAgICAgIGNvbnZlcnNhdGlvbklkLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgc2VuZGVyOiAndXNlcicsXHJcbiAgICAgICAgICAgICAgY29udGVudDogbWVzc2FnZSxcclxuICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgICAgICAgYW5hbHlzaXM6IHtcclxuICAgICAgICAgICAgICAgIHNlbnRpbWVudDogc2VudGltZW50LFxyXG4gICAgICAgICAgICAgICAgZW1vdGlvbnM6IGVtb3Rpb25zXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBBZGQgQUkgcmVzcG9uc2VcclxuICAgICAgICAgIGF3YWl0IGNvbnZlcnNhdGlvblNlcnZpY2UuYWRkTWVzc2FnZShcclxuICAgICAgICAgICAgY29udmVyc2F0aW9uSWQsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBzZW5kZXI6ICdib3QnLFxyXG4gICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlVGV4dCxcclxuICAgICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKGRiRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzYXZpbmcgZmFsbGJhY2sgcmVzcG9uc2UgdG8gTW9uZ29EQjonLCBkYkVycm9yKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG4gICAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlVGV4dCxcclxuICAgICAgICBzZW50aW1lbnQ6IHNlbnRpbWVudCxcclxuICAgICAgICBlbW90aW9uczogZW1vdGlvbnMsXHJcbiAgICAgICAgcmVjb21tZW5kYXRpb25zOiBTQU1QTEVfUkVDT01NRU5EQVRJT05TLFxyXG4gICAgICAgIGNvbnZlcnNhdGlvbklkOiBzYXZlZENvbnZlcnNhdGlvbklkXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBsb2NhbCBjaGF0IEFQSTonLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxyXG4gICAgICBtZXNzYWdlOiAnQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgcHJvY2Vzc2luZyB5b3VyIG1lc3NhZ2UnLFxyXG4gICAgICBlcnJvcjogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5tZXNzYWdlIDogdW5kZWZpbmVkXHJcbiAgICB9KTtcclxuICB9XHJcbn0gIl0sIm5hbWVzIjpbImxvY2FsQWlNaWRkbGV3YXJlIiwiY29udmVyc2F0aW9uU2VydmljZSIsIk9iamVjdElkIiwiY29ubmVjdFRvRGF0YWJhc2UiLCJTQU1QTEVfUkVDT01NRU5EQVRJT05TIiwidHlwZSIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJhY3Rpb25VcmwiLCJhY3Rpb25UZXh0IiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJtZXNzYWdlIiwiaGlzdG9yeSIsInVzZXJJZCIsImNvbnZlcnNhdGlvbklkIiwiYm9keSIsInVzZXJQcm9maWxlIiwiaWQiLCJuYW1lIiwicmVzdWx0IiwicHJvY2Vzc0lucHV0Iiwic2F2ZWRDb252ZXJzYXRpb25JZCIsInNhdmVkQ29udmVyc2F0aW9uIiwiY3JlYXRlQ29udmVyc2F0aW9uIiwic2VudGltZW50IiwiZW1vdGlvbnMiLCJfaWQiLCJ0b1N0cmluZyIsImFkZE1lc3NhZ2UiLCJzZW5kZXIiLCJjb250ZW50IiwicmVzcG9uc2UiLCJ0aW1lc3RhbXAiLCJEYXRlIiwiYW5hbHlzaXMiLCJyZWNvbW1lbmRhdGlvbnMiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJkYiIsImNvbGxlY3Rpb24iLCJ1cGRhdGVPbmUiLCIkc2V0IiwiZGJFcnJvciIsImNvbnNvbGUiLCJlcnJvciIsImxvd2VyTWVzc2FnZSIsInRvTG93ZXJDYXNlIiwicmVzcG9uc2VUZXh0IiwicHJpbWFyeSIsImNvbmZpZGVuY2UiLCJpbmNsdWRlcyIsInByb2Nlc3MiLCJ1bmRlZmluZWQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/ai/local-chat.js\n");

/***/ }),

/***/ "axios":
/*!************************!*\
  !*** external "axios" ***!
  \************************/
/***/ ((module) => {

module.exports = import("axios");;

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fai%2Flocal-chat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cai%5Clocal-chat.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();