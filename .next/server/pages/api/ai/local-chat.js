"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/ai/local-chat";
exports.ids = ["pages/api/ai/local-chat"];
exports.modules = {

/***/ "(api-node)/./lib/llama-service.js":
/*!******************************!*\
  !*** ./lib/llama-service.js ***!
  \******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   llamaService: () => (/* binding */ llamaService)\n/* harmony export */ });\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! axios */ \"axios?daaa\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([axios__WEBPACK_IMPORTED_MODULE_0__]);\naxios__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n// Environment variables\nconst LLAMA_API_URL = \"http://127.0.0.1:11434\" || 0;\nconst LLAMA_MODEL = \"llama3.2:latest\" || 0;\n// Default response templates for different emotional states\nconst DEFAULT_RESPONSES = {\n    happy: \"I'm glad you're feeling positive! What's been going well for you?\",\n    sad: \"I'm sorry to hear you're feeling down. Would you like to talk about what's troubling you?\",\n    anxious: \"It sounds like you might be experiencing some anxiety. Deep breathing can sometimes help in moments like this. Would you like to try a simple breathing exercise?\",\n    angry: \"I can sense you're feeling frustrated. It's completely valid to feel this way. Would it help to talk through what's causing these feelings?\",\n    distressed: \"I'm concerned about what you're sharing. If you're having thoughts of harming yourself, please reach out to the Suicide & Crisis Lifeline: call/text 988 or chat at 988lifeline.org. Would it be helpful to talk through some immediate coping strategies?\",\n    confused: \"I understand this might be confusing. Let's break things down together. What specific aspect would you like me to clarify?\",\n    neutral: \"I'm here to support you. How can I help you today?\"\n};\n// Predefined recommendations for different emotional states\nconst QUICK_RECOMMENDATIONS = {\n    happy: [\n        {\n            type: 'activity',\n            title: 'Gratitude Journal',\n            description: \"Maintain your positive mood by writing down three things you're grateful for today.\",\n            actionUrl: '/resources/activities/gratitude',\n            actionText: 'Start Journaling'\n        },\n        {\n            type: 'resource',\n            title: 'Positive Psychology',\n            description: 'Learn techniques to maintain and enhance positive emotions.',\n            actionUrl: '/resources/articles/positive-psychology',\n            actionText: 'Read More'\n        }\n    ],\n    sad: [\n        {\n            type: 'exercise',\n            title: 'Mindful Breathing',\n            description: 'Try this 5-minute breathing exercise to help center yourself.',\n            actionUrl: '/resources/exercises/breathing',\n            actionText: 'Start Exercise'\n        },\n        {\n            type: 'resource',\n            title: 'Understanding Low Mood',\n            description: 'Learn about the causes and management of sadness.',\n            actionUrl: '/resources/articles/mood',\n            actionText: 'Read Article'\n        },\n        {\n            type: 'activity',\n            title: 'Mood Booster',\n            description: 'Simple activities that can help lift your mood.',\n            actionUrl: '/resources/activities/mood-boost',\n            actionText: 'Try Now'\n        }\n    ],\n    anxious: [\n        {\n            type: 'exercise',\n            title: '5-4-3-2-1 Grounding Technique',\n            description: 'A simple exercise to help manage anxiety in the moment.',\n            actionUrl: '/resources/exercises/grounding',\n            actionText: 'Try Now'\n        },\n        {\n            type: 'resource',\n            title: 'Understanding Anxiety',\n            description: 'Learn about the causes and effective coping strategies for anxiety.',\n            actionUrl: '/resources/articles/anxiety',\n            actionText: 'Read Article'\n        }\n    ],\n    angry: [\n        {\n            type: 'exercise',\n            title: 'Progressive Muscle Relaxation',\n            description: 'Reduce tension through progressive muscle relaxation.',\n            actionUrl: '/resources/exercises/pmr',\n            actionText: 'Start Exercise'\n        },\n        {\n            type: 'activity',\n            title: 'Physical Activity Break',\n            description: 'A short physical activity can help release tension.',\n            actionUrl: '/resources/activities/movement',\n            actionText: 'Get Moving'\n        }\n    ],\n    distressed: [\n        {\n            type: 'hotline',\n            title: 'Crisis Support',\n            description: \"If you're in crisis, contact the Suicide & Crisis Lifeline: call/text 988 or chat at 988lifeline.org.\",\n            actionUrl: 'tel:988',\n            actionText: 'Call 988'\n        },\n        {\n            type: 'exercise',\n            title: 'Urge Surfing',\n            description: 'A technique to manage overwhelming urges or thoughts.',\n            actionUrl: '/resources/exercises/urge-surfing',\n            actionText: 'Learn More'\n        }\n    ],\n    neutral: [\n        {\n            type: 'checkin',\n            title: 'Daily Mood Check-in',\n            description: 'Track your emotional patterns over time.',\n            actionUrl: '/checkin',\n            actionText: 'Check In'\n        },\n        {\n            type: 'resource',\n            title: 'Mental Wellness Basics',\n            description: 'Explore fundamental concepts of mental wellbeing.',\n            actionUrl: '/resources/articles/wellness-basics',\n            actionText: 'Read Article'\n        }\n    ]\n};\n// Simple emotion detection with keyword matching\nconst detectEmotion = (text)=>{\n    const lowerText = text.toLowerCase();\n    // Crisis detection takes priority\n    if (lowerText.includes('suicide') || lowerText.includes('kill myself') || lowerText.includes('end my life') || lowerText.includes('don\\'t want to live') || lowerText.includes('want to die')) {\n        return {\n            sentiment: 'negative',\n            emotions: {\n                primary: 'distressed',\n                confidence: 0.9\n            }\n        };\n    }\n    // Detect positive emotions - check these patterns first\n    if (lowerText.includes('feeling good') || lowerText.includes('feel good') || lowerText.includes('feeling great') || lowerText.includes('happy') || lowerText.includes('joy') || lowerText.includes('excited') || lowerText.includes('wonderful') || lowerText.includes('fantastic') || lowerText.includes('awesome') || lowerText.includes('excellent') || lowerText.includes('glad') || lowerText.includes('positive') || lowerText.includes('feeling better')) {\n        return {\n            sentiment: 'positive',\n            emotions: {\n                primary: 'happy',\n                confidence: 0.9\n            }\n        };\n    }\n    // Detect negative emotions\n    if (lowerText.includes('sad') || lowerText.includes('depress') || lowerText.includes('down') || lowerText.includes('unhappy') || lowerText.includes('miserable') || lowerText.includes('hurt') || lowerText.includes('pain')) {\n        return {\n            sentiment: 'negative',\n            emotions: {\n                primary: 'sad',\n                confidence: 0.85\n            }\n        };\n    }\n    if (lowerText.includes('anxious') || lowerText.includes('worry') || lowerText.includes('stress') || lowerText.includes('nervous') || lowerText.includes('afraid') || lowerText.includes('fear') || lowerText.includes('panic')) {\n        return {\n            sentiment: 'negative',\n            emotions: {\n                primary: 'anxious',\n                confidence: 0.85\n            }\n        };\n    }\n    if (lowerText.includes('angry') || lowerText.includes('mad') || lowerText.includes('frustrated') || lowerText.includes('annoyed') || lowerText.includes('irritated') || lowerText.includes('upset')) {\n        return {\n            sentiment: 'negative',\n            emotions: {\n                primary: 'angry',\n                confidence: 0.85\n            }\n        };\n    }\n    if (lowerText.includes('confused') || lowerText.includes('don\\'t understand') || lowerText.includes('puzzled') || lowerText.includes('unsure') || lowerText.includes('uncertain')) {\n        return {\n            sentiment: 'neutral',\n            emotions: {\n                primary: 'confused',\n                confidence: 0.8\n            }\n        };\n    }\n    // Check for greeting patterns\n    if (lowerText.match(/^(hi|hello|hey|greetings|howdy)/) || lowerText.includes('how are you') || lowerText.includes('how\\'s it going')) {\n        return {\n            sentiment: 'neutral',\n            emotions: {\n                primary: 'greeting',\n                confidence: 0.85\n            }\n        };\n    }\n    // Default to neutral\n    return {\n        sentiment: 'neutral',\n        emotions: {\n            primary: 'neutral',\n            confidence: 0.6\n        }\n    };\n};\n/**\n * Service for interacting with local LLaMA API\n */ const llamaService = {\n    /**\n   * Check if the Ollama server is available\n   * @returns {Promise<Object>} - Server status\n   */ async checkServerStatus () {\n        try {\n            const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].get(`${LLAMA_API_URL}/api/tags`, {\n                timeout: 2000 // Fast timeout for checking\n            });\n            return {\n                isAvailable: response.status === 200,\n                status: response.status,\n                models: response.data?.models || []\n            };\n        } catch (error) {\n            console.error('Ollama server check failed:', error.message);\n            return {\n                isAvailable: false,\n                error: error.message\n            };\n        }\n    },\n    /**\n   * Process a message through the LLaMA model\n   * @param {string} userName - User's name\n   * @param {string} message - User's message\n   * @param {Array} chatHistory - Chat history\n   * @param {Function} onStream - Callback function for streaming response\n   * @param {string} detectedEmotion - Pre-detected emotion for context\n   * @returns {Promise<string>} - Model response\n   */ async processMessage (userName, message, chatHistory, onStream = null, detectedEmotion = null) {\n        try {\n            const formattedHistory = this.formatChatHistory(chatHistory);\n            // Use the provided emotion or get one if not provided\n            const emotion = detectedEmotion ? {\n                emotions: {\n                    primary: detectedEmotion\n                }\n            } : await this.quickAnalyzeSentiment(message);\n            const normalizedMessage = message.trim();\n            // Log request details for debugging\n            console.log(`Sending request to LLaMA model: ${LLAMA_MODEL}`);\n            console.log(`API URL: ${LLAMA_API_URL}/api/chat`);\n            const chatMessages = [\n                {\n                    role: \"system\",\n                    content: `You are NeuroSync AI, an empathetic mental health assistant. \nBe caring but stay realistic. You've detected the user is feeling: ${emotion.emotions.primary || 'neutral'}.\nIf the user seems in a crisis, prioritize their safety and suggest immediate professional help.\nProvide concise, practical advice. Avoid generic platitudes. Be authentic, warm, and honest.`\n                }\n            ];\n            // Add chat history as context (if any)\n            if (formattedHistory && formattedHistory.length > 0) {\n                formattedHistory.forEach((entry)=>{\n                    chatMessages.push({\n                        role: entry.role,\n                        content: entry.content\n                    });\n                });\n            }\n            // Add the current user message\n            chatMessages.push({\n                role: \"user\",\n                content: normalizedMessage\n            });\n            try {\n                let fullResponse = '';\n                if (onStream) {\n                    // Streaming mode\n                    const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].post(`${LLAMA_API_URL}/api/chat`, {\n                        model: LLAMA_MODEL,\n                        messages: chatMessages,\n                        stream: true,\n                        options: {\n                            temperature: 0.7\n                        }\n                    }, {\n                        timeout: 30000,\n                        responseType: 'stream'\n                    });\n                    const stream = response.data;\n                    return new Promise((resolve, reject)=>{\n                        stream.on('data', (chunk)=>{\n                            try {\n                                const lines = chunk.toString().split('\\n').filter((line)=>line.trim() !== '');\n                                for (const line of lines){\n                                    if (line.includes('data: [DONE]')) continue;\n                                    if (line.startsWith('data: ')) {\n                                        const jsonData = JSON.parse(line.substring(6));\n                                        if (jsonData.message && jsonData.message.content) {\n                                            const content = jsonData.message.content;\n                                            fullResponse += content;\n                                            onStream(content);\n                                        }\n                                    }\n                                }\n                            } catch (e) {\n                                console.error('Error processing stream chunk:', e);\n                            }\n                        });\n                        stream.on('end', ()=>{\n                            resolve(fullResponse);\n                        });\n                        stream.on('error', (error)=>{\n                            reject(error);\n                        });\n                    });\n                } else {\n                    // Non-streaming mode - simplified to ensure proper JSON formatting\n                    console.log('Sending non-streaming request to Ollama API');\n                    const requestData = {\n                        model: LLAMA_MODEL,\n                        messages: chatMessages,\n                        stream: false,\n                        options: {\n                            temperature: 0.7\n                        }\n                    };\n                    console.log('Request payload:', JSON.stringify(requestData).substring(0, 150) + '...');\n                    const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].post(`${LLAMA_API_URL}/api/chat`, requestData, {\n                        timeout: 30000 // Increased timeout to 30 seconds\n                    });\n                    console.log('Response received, status:', response.status);\n                    if (response.data && response.data.message && response.data.message.content) {\n                        return response.data.message.content;\n                    }\n                    // Fallback for other response formats\n                    if (response.data && response.data.response) {\n                        return response.data.response;\n                    }\n                    throw new Error('Unexpected response format from LLaMA API');\n                }\n            } catch (error) {\n                console.error('Error calling LLaMA API:', error);\n                if (error.response) {\n                    console.error('Response status:', error.response.status);\n                    console.error('Response data:', error.response.data);\n                }\n                // Provide a fallback response based on the detected emotion\n                return this.getFallbackResponse(emotion.emotions.primary || 'neutral');\n            }\n        } catch (error) {\n            console.error('Error in processMessage:', error);\n            return \"I'm having trouble processing your message right now. Can we try again?\";\n        }\n    },\n    /**\n   * Quick sentiment analysis using pattern matching\n   * @param {string} text - Text to analyze\n   * @returns {Object} - Sentiment analysis result\n   */ async quickAnalyzeSentiment (text) {\n        try {\n            // Check for simple cases using pattern matching first for speed\n            const quickResult = detectEmotion(text);\n            if (quickResult.emotions.confidence > 0.8) {\n                console.log('Using fast pattern matching for sentiment:', quickResult);\n                return quickResult;\n            }\n            // Try to use LLaMA for analysis with a simplified prompt\n            try {\n                const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].post(`${LLAMA_API_URL}/api/chat`, {\n                    model: LLAMA_MODEL,\n                    messages: [\n                        {\n                            role: \"system\",\n                            content: \"You are a sentiment analyzer with high accuracy. Analyze the emotional content of the message and classify it correctly. Pay special attention to positive indicators like 'feeling good', 'happy', etc. Respond in JSON format only with the structure {\\\"sentiment\\\": \\\"positive|negative|neutral\\\", \\\"emotions\\\": {\\\"primary\\\": \\\"emotion_name\\\", \\\"confidence\\\": 0.0-1.0}}\"\n                        },\n                        {\n                            role: \"user\",\n                            content: `Analyze the emotional content of this message: \"${text}\"`\n                        }\n                    ],\n                    stream: false,\n                    options: {\n                        temperature: 0.1 // Lower temperature for more predictable results\n                    }\n                }, {\n                    timeout: 5000 // Reduced timeout for faster response\n                });\n                // Check for the response in the standard Ollama chat format\n                let responseContent = '';\n                if (response.data && response.data.message && response.data.message.content) {\n                    responseContent = response.data.message.content;\n                } else if (response.data && response.data.response) {\n                    // Fallback for older Ollama format\n                    responseContent = response.data.response;\n                } else {\n                    throw new Error('Unexpected response format from LLaMA API');\n                }\n                try {\n                    // Try to parse the response as JSON\n                    const parsedResponse = JSON.parse(responseContent);\n                    if (parsedResponse.sentiment && parsedResponse.emotions) {\n                        return {\n                            sentiment: parsedResponse.sentiment,\n                            emotions: parsedResponse.emotions\n                        };\n                    }\n                } catch (jsonError) {\n                    console.warn('Failed to parse Ollama sentiment response as JSON:', jsonError);\n                }\n                // If we get here, something went wrong with parsing\n                throw new Error('Invalid format returned from LLaMA sentiment analysis');\n            } catch (llamaError) {\n                console.warn('LLaMA sentiment analysis failed, using pattern matching:', llamaError.message);\n                return detectEmotion(text);\n            }\n        } catch (error) {\n            console.error('Error in sentiment analysis:', error);\n            // Return a neutral result as fallback\n            return {\n                sentiment: 'neutral',\n                emotions: {\n                    primary: 'neutral',\n                    confidence: 0.5\n                }\n            };\n        }\n    },\n    /**\n   * Get quick recommendations based on emotional state\n   * @param {string} emotionalState - User's emotional state\n   * @returns {Array} - List of recommendations\n   */ getQuickRecommendations (emotionalState) {\n        // Convert to lowercase and normalize\n        const emotion = emotionalState.toLowerCase();\n        // Return recommendations for the emotional state or default to neutral\n        return QUICK_RECOMMENDATIONS[emotion] || QUICK_RECOMMENDATIONS.neutral;\n    },\n    /**\n   * Format chat history for LLaMA API\n   * @param {Array} chatHistory - Chat history\n   * @returns {Array} - Formatted chat history\n   */ formatChatHistory (chatHistory) {\n        // Check if chatHistory is null or undefined\n        if (!chatHistory || !Array.isArray(chatHistory)) {\n            return [];\n        }\n        return chatHistory.map((msg)=>({\n                role: msg.role === 'system' ? 'system' : msg.role === 'user' ? 'user' : 'assistant',\n                content: msg.content\n            }));\n    },\n    /**\n   * Get fallback response based on detected emotion\n   * @param {string} emotion - Detected emotion\n   * @returns {string} - Fallback response\n   */ getFallbackResponse (emotion) {\n        const fallbackResponse = DEFAULT_RESPONSES[emotion] || DEFAULT_RESPONSES.neutral;\n        return `${fallbackResponse} [Note: I'm currently operating in fallback mode as I couldn't connect to the LLaMA 3.2 model. Please check if Ollama is running.]`;\n    }\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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a0JBQWtCTyxPQUFPO1FBQ2hGLE9BQU8sR0FBR3dGLGlCQUFpQixrSUFBa0ksQ0FBQztJQUNoSztBQUNGLEVBQUUiLCJzb3VyY2VzIjpbIkQ6XFxQcm9qZWN0c1xcRGVraHRlIGhhaVxcbmV1cm9TeW5jXFxOZXVyb1N5bmMtQUktRnJvbnRlbmRcXGxpYlxcbGxhbWEtc2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuXG4vLyBFbnZpcm9ubWVudCB2YXJpYWJsZXNcbmNvbnN0IExMQU1BX0FQSV9VUkwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19MTEFNQV9BUElfVVJMIHx8ICdodHRwOi8vMTI3LjAuMC4xOjExNDM0JztcbmNvbnN0IExMQU1BX01PREVMID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfTExBTUFfTU9ERUxfTkFNRSB8fCAnbGxhbWEzLjI6bGF0ZXN0JztcblxuLy8gRGVmYXVsdCByZXNwb25zZSB0ZW1wbGF0ZXMgZm9yIGRpZmZlcmVudCBlbW90aW9uYWwgc3RhdGVzXG5jb25zdCBERUZBVUxUX1JFU1BPTlNFUyA9IHtcbiAgaGFwcHk6IFwiSSdtIGdsYWQgeW91J3JlIGZlZWxpbmcgcG9zaXRpdmUhIFdoYXQncyBiZWVuIGdvaW5nIHdlbGwgZm9yIHlvdT9cIixcbiAgc2FkOiBcIkknbSBzb3JyeSB0byBoZWFyIHlvdSdyZSBmZWVsaW5nIGRvd24uIFdvdWxkIHlvdSBsaWtlIHRvIHRhbGsgYWJvdXQgd2hhdCdzIHRyb3VibGluZyB5b3U/XCIsXG4gIGFueGlvdXM6IFwiSXQgc291bmRzIGxpa2UgeW91IG1pZ2h0IGJlIGV4cGVyaWVuY2luZyBzb21lIGFueGlldHkuIERlZXAgYnJlYXRoaW5nIGNhbiBzb21ldGltZXMgaGVscCBpbiBtb21lbnRzIGxpa2UgdGhpcy4gV291bGQgeW91IGxpa2UgdG8gdHJ5IGEgc2ltcGxlIGJyZWF0aGluZyBleGVyY2lzZT9cIixcbiAgYW5ncnk6IFwiSSBjYW4gc2Vuc2UgeW91J3JlIGZlZWxpbmcgZnJ1c3RyYXRlZC4gSXQncyBjb21wbGV0ZWx5IHZhbGlkIHRvIGZlZWwgdGhpcyB3YXkuIFdvdWxkIGl0IGhlbHAgdG8gdGFsayB0aHJvdWdoIHdoYXQncyBjYXVzaW5nIHRoZXNlIGZlZWxpbmdzP1wiLFxuICBkaXN0cmVzc2VkOiBcIkknbSBjb25jZXJuZWQgYWJvdXQgd2hhdCB5b3UncmUgc2hhcmluZy4gSWYgeW91J3JlIGhhdmluZyB0aG91Z2h0cyBvZiBoYXJtaW5nIHlvdXJzZWxmLCBwbGVhc2UgcmVhY2ggb3V0IHRvIHRoZSBTdWljaWRlICYgQ3Jpc2lzIExpZmVsaW5lOiBjYWxsL3RleHQgOTg4IG9yIGNoYXQgYXQgOTg4bGlmZWxpbmUub3JnLiBXb3VsZCBpdCBiZSBoZWxwZnVsIHRvIHRhbGsgdGhyb3VnaCBzb21lIGltbWVkaWF0ZSBjb3Bpbmcgc3RyYXRlZ2llcz9cIixcbiAgY29uZnVzZWQ6IFwiSSB1bmRlcnN0YW5kIHRoaXMgbWlnaHQgYmUgY29uZnVzaW5nLiBMZXQncyBicmVhayB0aGluZ3MgZG93biB0b2dldGhlci4gV2hhdCBzcGVjaWZpYyBhc3BlY3Qgd291bGQgeW91IGxpa2UgbWUgdG8gY2xhcmlmeT9cIixcbiAgbmV1dHJhbDogXCJJJ20gaGVyZSB0byBzdXBwb3J0IHlvdS4gSG93IGNhbiBJIGhlbHAgeW91IHRvZGF5P1wiXG59O1xuXG4vLyBQcmVkZWZpbmVkIHJlY29tbWVuZGF0aW9ucyBmb3IgZGlmZmVyZW50IGVtb3Rpb25hbCBzdGF0ZXNcbmNvbnN0IFFVSUNLX1JFQ09NTUVOREFUSU9OUyA9IHtcbiAgaGFwcHk6IFtcbiAgICB7XG4gICAgICB0eXBlOiAnYWN0aXZpdHknLFxuICAgICAgdGl0bGU6ICdHcmF0aXR1ZGUgSm91cm5hbCcsXG4gICAgICBkZXNjcmlwdGlvbjogXCJNYWludGFpbiB5b3VyIHBvc2l0aXZlIG1vb2QgYnkgd3JpdGluZyBkb3duIHRocmVlIHRoaW5ncyB5b3UncmUgZ3JhdGVmdWwgZm9yIHRvZGF5LlwiLFxuICAgICAgYWN0aW9uVXJsOiAnL3Jlc291cmNlcy9hY3Rpdml0aWVzL2dyYXRpdHVkZScsXG4gICAgICBhY3Rpb25UZXh0OiAnU3RhcnQgSm91cm5hbGluZydcbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6ICdyZXNvdXJjZScsXG4gICAgICB0aXRsZTogJ1Bvc2l0aXZlIFBzeWNob2xvZ3knLFxuICAgICAgZGVzY3JpcHRpb246ICdMZWFybiB0ZWNobmlxdWVzIHRvIG1haW50YWluIGFuZCBlbmhhbmNlIHBvc2l0aXZlIGVtb3Rpb25zLicsXG4gICAgICBhY3Rpb25Vcmw6ICcvcmVzb3VyY2VzL2FydGljbGVzL3Bvc2l0aXZlLXBzeWNob2xvZ3knLFxuICAgICAgYWN0aW9uVGV4dDogJ1JlYWQgTW9yZSdcbiAgICB9XG4gIF0sXG4gIHNhZDogW1xuICAgIHtcbiAgICAgIHR5cGU6ICdleGVyY2lzZScsXG4gICAgICB0aXRsZTogJ01pbmRmdWwgQnJlYXRoaW5nJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnVHJ5IHRoaXMgNS1taW51dGUgYnJlYXRoaW5nIGV4ZXJjaXNlIHRvIGhlbHAgY2VudGVyIHlvdXJzZWxmLicsXG4gICAgICBhY3Rpb25Vcmw6ICcvcmVzb3VyY2VzL2V4ZXJjaXNlcy9icmVhdGhpbmcnLFxuICAgICAgYWN0aW9uVGV4dDogJ1N0YXJ0IEV4ZXJjaXNlJ1xuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogJ3Jlc291cmNlJyxcbiAgICAgIHRpdGxlOiAnVW5kZXJzdGFuZGluZyBMb3cgTW9vZCcsXG4gICAgICBkZXNjcmlwdGlvbjogJ0xlYXJuIGFib3V0IHRoZSBjYXVzZXMgYW5kIG1hbmFnZW1lbnQgb2Ygc2FkbmVzcy4nLFxuICAgICAgYWN0aW9uVXJsOiAnL3Jlc291cmNlcy9hcnRpY2xlcy9tb29kJyxcbiAgICAgIGFjdGlvblRleHQ6ICdSZWFkIEFydGljbGUnXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiAnYWN0aXZpdHknLFxuICAgICAgdGl0bGU6ICdNb29kIEJvb3N0ZXInLFxuICAgICAgZGVzY3JpcHRpb246ICdTaW1wbGUgYWN0aXZpdGllcyB0aGF0IGNhbiBoZWxwIGxpZnQgeW91ciBtb29kLicsXG4gICAgICBhY3Rpb25Vcmw6ICcvcmVzb3VyY2VzL2FjdGl2aXRpZXMvbW9vZC1ib29zdCcsXG4gICAgICBhY3Rpb25UZXh0OiAnVHJ5IE5vdydcbiAgICB9XG4gIF0sXG4gIGFueGlvdXM6IFtcbiAgICB7XG4gICAgICB0eXBlOiAnZXhlcmNpc2UnLFxuICAgICAgdGl0bGU6ICc1LTQtMy0yLTEgR3JvdW5kaW5nIFRlY2huaXF1ZScsXG4gICAgICBkZXNjcmlwdGlvbjogJ0Egc2ltcGxlIGV4ZXJjaXNlIHRvIGhlbHAgbWFuYWdlIGFueGlldHkgaW4gdGhlIG1vbWVudC4nLFxuICAgICAgYWN0aW9uVXJsOiAnL3Jlc291cmNlcy9leGVyY2lzZXMvZ3JvdW5kaW5nJyxcbiAgICAgIGFjdGlvblRleHQ6ICdUcnkgTm93J1xuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogJ3Jlc291cmNlJyxcbiAgICAgIHRpdGxlOiAnVW5kZXJzdGFuZGluZyBBbnhpZXR5JyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnTGVhcm4gYWJvdXQgdGhlIGNhdXNlcyBhbmQgZWZmZWN0aXZlIGNvcGluZyBzdHJhdGVnaWVzIGZvciBhbnhpZXR5LicsXG4gICAgICBhY3Rpb25Vcmw6ICcvcmVzb3VyY2VzL2FydGljbGVzL2FueGlldHknLFxuICAgICAgYWN0aW9uVGV4dDogJ1JlYWQgQXJ0aWNsZSdcbiAgICB9XG4gIF0sXG4gIGFuZ3J5OiBbXG4gICAge1xuICAgICAgdHlwZTogJ2V4ZXJjaXNlJyxcbiAgICAgIHRpdGxlOiAnUHJvZ3Jlc3NpdmUgTXVzY2xlIFJlbGF4YXRpb24nLFxuICAgICAgZGVzY3JpcHRpb246ICdSZWR1Y2UgdGVuc2lvbiB0aHJvdWdoIHByb2dyZXNzaXZlIG11c2NsZSByZWxheGF0aW9uLicsXG4gICAgICBhY3Rpb25Vcmw6ICcvcmVzb3VyY2VzL2V4ZXJjaXNlcy9wbXInLFxuICAgICAgYWN0aW9uVGV4dDogJ1N0YXJ0IEV4ZXJjaXNlJ1xuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogJ2FjdGl2aXR5JyxcbiAgICAgIHRpdGxlOiAnUGh5c2ljYWwgQWN0aXZpdHkgQnJlYWsnLFxuICAgICAgZGVzY3JpcHRpb246ICdBIHNob3J0IHBoeXNpY2FsIGFjdGl2aXR5IGNhbiBoZWxwIHJlbGVhc2UgdGVuc2lvbi4nLFxuICAgICAgYWN0aW9uVXJsOiAnL3Jlc291cmNlcy9hY3Rpdml0aWVzL21vdmVtZW50JyxcbiAgICAgIGFjdGlvblRleHQ6ICdHZXQgTW92aW5nJ1xuICAgIH1cbiAgXSxcbiAgZGlzdHJlc3NlZDogW1xuICAgIHtcbiAgICAgIHR5cGU6ICdob3RsaW5lJyxcbiAgICAgIHRpdGxlOiAnQ3Jpc2lzIFN1cHBvcnQnLFxuICAgICAgZGVzY3JpcHRpb246IFwiSWYgeW91J3JlIGluIGNyaXNpcywgY29udGFjdCB0aGUgU3VpY2lkZSAmIENyaXNpcyBMaWZlbGluZTogY2FsbC90ZXh0IDk4OCBvciBjaGF0IGF0IDk4OGxpZmVsaW5lLm9yZy5cIixcbiAgICAgIGFjdGlvblVybDogJ3RlbDo5ODgnLFxuICAgICAgYWN0aW9uVGV4dDogJ0NhbGwgOTg4J1xuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogJ2V4ZXJjaXNlJyxcbiAgICAgIHRpdGxlOiAnVXJnZSBTdXJmaW5nJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQSB0ZWNobmlxdWUgdG8gbWFuYWdlIG92ZXJ3aGVsbWluZyB1cmdlcyBvciB0aG91Z2h0cy4nLFxuICAgICAgYWN0aW9uVXJsOiAnL3Jlc291cmNlcy9leGVyY2lzZXMvdXJnZS1zdXJmaW5nJyxcbiAgICAgIGFjdGlvblRleHQ6ICdMZWFybiBNb3JlJ1xuICAgIH1cbiAgXSxcbiAgbmV1dHJhbDogW1xuICAgIHtcbiAgICAgIHR5cGU6ICdjaGVja2luJyxcbiAgICAgIHRpdGxlOiAnRGFpbHkgTW9vZCBDaGVjay1pbicsXG4gICAgICBkZXNjcmlwdGlvbjogJ1RyYWNrIHlvdXIgZW1vdGlvbmFsIHBhdHRlcm5zIG92ZXIgdGltZS4nLFxuICAgICAgYWN0aW9uVXJsOiAnL2NoZWNraW4nLFxuICAgICAgYWN0aW9uVGV4dDogJ0NoZWNrIEluJ1xuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogJ3Jlc291cmNlJyxcbiAgICAgIHRpdGxlOiAnTWVudGFsIFdlbGxuZXNzIEJhc2ljcycsXG4gICAgICBkZXNjcmlwdGlvbjogJ0V4cGxvcmUgZnVuZGFtZW50YWwgY29uY2VwdHMgb2YgbWVudGFsIHdlbGxiZWluZy4nLFxuICAgICAgYWN0aW9uVXJsOiAnL3Jlc291cmNlcy9hcnRpY2xlcy93ZWxsbmVzcy1iYXNpY3MnLFxuICAgICAgYWN0aW9uVGV4dDogJ1JlYWQgQXJ0aWNsZSdcbiAgICB9XG4gIF1cbn07XG5cbi8vIFNpbXBsZSBlbW90aW9uIGRldGVjdGlvbiB3aXRoIGtleXdvcmQgbWF0Y2hpbmdcbmNvbnN0IGRldGVjdEVtb3Rpb24gPSAodGV4dCkgPT4ge1xuICBjb25zdCBsb3dlclRleHQgPSB0ZXh0LnRvTG93ZXJDYXNlKCk7XG4gIFxuICAvLyBDcmlzaXMgZGV0ZWN0aW9uIHRha2VzIHByaW9yaXR5XG4gIGlmIChcbiAgICBsb3dlclRleHQuaW5jbHVkZXMoJ3N1aWNpZGUnKSB8fCBcbiAgICBsb3dlclRleHQuaW5jbHVkZXMoJ2tpbGwgbXlzZWxmJykgfHwgXG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdlbmQgbXkgbGlmZScpIHx8IFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygnZG9uXFwndCB3YW50IHRvIGxpdmUnKSB8fFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygnd2FudCB0byBkaWUnKVxuICApIHtcbiAgICByZXR1cm4geyBcbiAgICAgIHNlbnRpbWVudDogJ25lZ2F0aXZlJywgXG4gICAgICBlbW90aW9uczogeyBwcmltYXJ5OiAnZGlzdHJlc3NlZCcsIGNvbmZpZGVuY2U6IDAuOSB9IFxuICAgIH07XG4gIH1cbiAgXG4gIC8vIERldGVjdCBwb3NpdGl2ZSBlbW90aW9ucyAtIGNoZWNrIHRoZXNlIHBhdHRlcm5zIGZpcnN0XG4gIGlmIChcbiAgICBsb3dlclRleHQuaW5jbHVkZXMoJ2ZlZWxpbmcgZ29vZCcpIHx8IFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygnZmVlbCBnb29kJykgfHwgXG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdmZWVsaW5nIGdyZWF0JykgfHwgXG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdoYXBweScpIHx8IFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygnam95JykgfHwgXG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdleGNpdGVkJykgfHxcbiAgICBsb3dlclRleHQuaW5jbHVkZXMoJ3dvbmRlcmZ1bCcpIHx8XG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdmYW50YXN0aWMnKSB8fFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygnYXdlc29tZScpIHx8XG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdleGNlbGxlbnQnKSB8fFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygnZ2xhZCcpIHx8XG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdwb3NpdGl2ZScpIHx8XG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdmZWVsaW5nIGJldHRlcicpXG4gICkge1xuICAgIHJldHVybiB7IFxuICAgICAgc2VudGltZW50OiAncG9zaXRpdmUnLCBcbiAgICAgIGVtb3Rpb25zOiB7IHByaW1hcnk6ICdoYXBweScsIGNvbmZpZGVuY2U6IDAuOSB9IFxuICAgIH07XG4gIH1cbiAgXG4gIC8vIERldGVjdCBuZWdhdGl2ZSBlbW90aW9uc1xuICBpZiAoXG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdzYWQnKSB8fCBcbiAgICBsb3dlclRleHQuaW5jbHVkZXMoJ2RlcHJlc3MnKSB8fCBcbiAgICBsb3dlclRleHQuaW5jbHVkZXMoJ2Rvd24nKSB8fFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygndW5oYXBweScpIHx8XG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdtaXNlcmFibGUnKSB8fFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygnaHVydCcpIHx8XG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdwYWluJylcbiAgKSB7XG4gICAgcmV0dXJuIHsgXG4gICAgICBzZW50aW1lbnQ6ICduZWdhdGl2ZScsIFxuICAgICAgZW1vdGlvbnM6IHsgcHJpbWFyeTogJ3NhZCcsIGNvbmZpZGVuY2U6IDAuODUgfSBcbiAgICB9O1xuICB9XG4gIFxuICBpZiAoXG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdhbnhpb3VzJykgfHwgXG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCd3b3JyeScpIHx8IFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygnc3RyZXNzJykgfHxcbiAgICBsb3dlclRleHQuaW5jbHVkZXMoJ25lcnZvdXMnKSB8fFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygnYWZyYWlkJykgfHxcbiAgICBsb3dlclRleHQuaW5jbHVkZXMoJ2ZlYXInKSB8fFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygncGFuaWMnKVxuICApIHtcbiAgICByZXR1cm4geyBcbiAgICAgIHNlbnRpbWVudDogJ25lZ2F0aXZlJywgXG4gICAgICBlbW90aW9uczogeyBwcmltYXJ5OiAnYW54aW91cycsIGNvbmZpZGVuY2U6IDAuODUgfSBcbiAgICB9O1xuICB9XG4gIFxuICBpZiAoXG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdhbmdyeScpIHx8IFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygnbWFkJykgfHwgXG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdmcnVzdHJhdGVkJykgfHxcbiAgICBsb3dlclRleHQuaW5jbHVkZXMoJ2Fubm95ZWQnKSB8fFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygnaXJyaXRhdGVkJykgfHxcbiAgICBsb3dlclRleHQuaW5jbHVkZXMoJ3Vwc2V0JylcbiAgKSB7XG4gICAgcmV0dXJuIHsgXG4gICAgICBzZW50aW1lbnQ6ICduZWdhdGl2ZScsIFxuICAgICAgZW1vdGlvbnM6IHsgcHJpbWFyeTogJ2FuZ3J5JywgY29uZmlkZW5jZTogMC44NSB9IFxuICAgIH07XG4gIH1cbiAgXG4gIGlmIChcbiAgICBsb3dlclRleHQuaW5jbHVkZXMoJ2NvbmZ1c2VkJykgfHwgXG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdkb25cXCd0IHVuZGVyc3RhbmQnKSB8fFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygncHV6emxlZCcpIHx8XG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCd1bnN1cmUnKSB8fFxuICAgIGxvd2VyVGV4dC5pbmNsdWRlcygndW5jZXJ0YWluJylcbiAgKSB7XG4gICAgcmV0dXJuIHsgXG4gICAgICBzZW50aW1lbnQ6ICduZXV0cmFsJywgXG4gICAgICBlbW90aW9uczogeyBwcmltYXJ5OiAnY29uZnVzZWQnLCBjb25maWRlbmNlOiAwLjggfSBcbiAgICB9O1xuICB9XG4gIFxuICAvLyBDaGVjayBmb3IgZ3JlZXRpbmcgcGF0dGVybnNcbiAgaWYgKFxuICAgIGxvd2VyVGV4dC5tYXRjaCgvXihoaXxoZWxsb3xoZXl8Z3JlZXRpbmdzfGhvd2R5KS8pIHx8XG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdob3cgYXJlIHlvdScpIHx8XG4gICAgbG93ZXJUZXh0LmluY2x1ZGVzKCdob3dcXCdzIGl0IGdvaW5nJylcbiAgKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNlbnRpbWVudDogJ25ldXRyYWwnLFxuICAgICAgZW1vdGlvbnM6IHsgcHJpbWFyeTogJ2dyZWV0aW5nJywgY29uZmlkZW5jZTogMC44NSB9XG4gICAgfTtcbiAgfVxuICBcbiAgLy8gRGVmYXVsdCB0byBuZXV0cmFsXG4gIHJldHVybiB7IFxuICAgIHNlbnRpbWVudDogJ25ldXRyYWwnLCBcbiAgICBlbW90aW9uczogeyBwcmltYXJ5OiAnbmV1dHJhbCcsIGNvbmZpZGVuY2U6IDAuNiB9IFxuICB9O1xufTtcblxuLyoqXG4gKiBTZXJ2aWNlIGZvciBpbnRlcmFjdGluZyB3aXRoIGxvY2FsIExMYU1BIEFQSVxuICovXG5leHBvcnQgY29uc3QgbGxhbWFTZXJ2aWNlID0ge1xuICAvKipcbiAgICogQ2hlY2sgaWYgdGhlIE9sbGFtYSBzZXJ2ZXIgaXMgYXZhaWxhYmxlXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IC0gU2VydmVyIHN0YXR1c1xuICAgKi9cbiAgYXN5bmMgY2hlY2tTZXJ2ZXJTdGF0dXMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KGAke0xMQU1BX0FQSV9VUkx9L2FwaS90YWdzYCwgeyBcbiAgICAgICAgdGltZW91dDogMjAwMCAvLyBGYXN0IHRpbWVvdXQgZm9yIGNoZWNraW5nXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXNBdmFpbGFibGU6IHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwLFxuICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgbW9kZWxzOiByZXNwb25zZS5kYXRhPy5tb2RlbHMgfHwgW11cbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ09sbGFtYSBzZXJ2ZXIgY2hlY2sgZmFpbGVkOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXNBdmFpbGFibGU6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgICAgfTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIFByb2Nlc3MgYSBtZXNzYWdlIHRocm91Z2ggdGhlIExMYU1BIG1vZGVsXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1c2VyTmFtZSAtIFVzZXIncyBuYW1lXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gVXNlcidzIG1lc3NhZ2VcbiAgICogQHBhcmFtIHtBcnJheX0gY2hhdEhpc3RvcnkgLSBDaGF0IGhpc3RvcnlcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gb25TdHJlYW0gLSBDYWxsYmFjayBmdW5jdGlvbiBmb3Igc3RyZWFtaW5nIHJlc3BvbnNlXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBkZXRlY3RlZEVtb3Rpb24gLSBQcmUtZGV0ZWN0ZWQgZW1vdGlvbiBmb3IgY29udGV4dFxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSAtIE1vZGVsIHJlc3BvbnNlXG4gICAqL1xuICBhc3luYyBwcm9jZXNzTWVzc2FnZSh1c2VyTmFtZSwgbWVzc2FnZSwgY2hhdEhpc3RvcnksIG9uU3RyZWFtID0gbnVsbCwgZGV0ZWN0ZWRFbW90aW9uID0gbnVsbCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBmb3JtYXR0ZWRIaXN0b3J5ID0gdGhpcy5mb3JtYXRDaGF0SGlzdG9yeShjaGF0SGlzdG9yeSk7XG4gICAgICBcbiAgICAgIC8vIFVzZSB0aGUgcHJvdmlkZWQgZW1vdGlvbiBvciBnZXQgb25lIGlmIG5vdCBwcm92aWRlZFxuICAgICAgY29uc3QgZW1vdGlvbiA9IGRldGVjdGVkRW1vdGlvbiA/IFxuICAgICAgICB7IGVtb3Rpb25zOiB7IHByaW1hcnk6IGRldGVjdGVkRW1vdGlvbiB9IH0gOiBcbiAgICAgICAgYXdhaXQgdGhpcy5xdWlja0FuYWx5emVTZW50aW1lbnQobWVzc2FnZSk7XG4gICAgICAgIFxuICAgICAgY29uc3Qgbm9ybWFsaXplZE1lc3NhZ2UgPSBtZXNzYWdlLnRyaW0oKTtcbiAgICAgIFxuICAgICAgLy8gTG9nIHJlcXVlc3QgZGV0YWlscyBmb3IgZGVidWdnaW5nXG4gICAgICBjb25zb2xlLmxvZyhgU2VuZGluZyByZXF1ZXN0IHRvIExMYU1BIG1vZGVsOiAke0xMQU1BX01PREVMfWApO1xuICAgICAgY29uc29sZS5sb2coYEFQSSBVUkw6ICR7TExBTUFfQVBJX1VSTH0vYXBpL2NoYXRgKTtcbiAgICAgIFxuICAgICAgY29uc3QgY2hhdE1lc3NhZ2VzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgICBjb250ZW50OiBgWW91IGFyZSBOZXVyb1N5bmMgQUksIGFuIGVtcGF0aGV0aWMgbWVudGFsIGhlYWx0aCBhc3Npc3RhbnQuIFxuQmUgY2FyaW5nIGJ1dCBzdGF5IHJlYWxpc3RpYy4gWW91J3ZlIGRldGVjdGVkIHRoZSB1c2VyIGlzIGZlZWxpbmc6ICR7ZW1vdGlvbi5lbW90aW9ucy5wcmltYXJ5IHx8ICduZXV0cmFsJ30uXG5JZiB0aGUgdXNlciBzZWVtcyBpbiBhIGNyaXNpcywgcHJpb3JpdGl6ZSB0aGVpciBzYWZldHkgYW5kIHN1Z2dlc3QgaW1tZWRpYXRlIHByb2Zlc3Npb25hbCBoZWxwLlxuUHJvdmlkZSBjb25jaXNlLCBwcmFjdGljYWwgYWR2aWNlLiBBdm9pZCBnZW5lcmljIHBsYXRpdHVkZXMuIEJlIGF1dGhlbnRpYywgd2FybSwgYW5kIGhvbmVzdC5gXG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgICBcbiAgICAgIC8vIEFkZCBjaGF0IGhpc3RvcnkgYXMgY29udGV4dCAoaWYgYW55KVxuICAgICAgaWYgKGZvcm1hdHRlZEhpc3RvcnkgJiYgZm9ybWF0dGVkSGlzdG9yeS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGZvcm1hdHRlZEhpc3RvcnkuZm9yRWFjaChlbnRyeSA9PiB7XG4gICAgICAgICAgY2hhdE1lc3NhZ2VzLnB1c2goe1xuICAgICAgICAgICAgcm9sZTogZW50cnkucm9sZSxcbiAgICAgICAgICAgIGNvbnRlbnQ6IGVudHJ5LmNvbnRlbnRcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEFkZCB0aGUgY3VycmVudCB1c2VyIG1lc3NhZ2VcbiAgICAgIGNoYXRNZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgIGNvbnRlbnQ6IG5vcm1hbGl6ZWRNZXNzYWdlXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgdHJ5IHtcbiAgICAgICAgbGV0IGZ1bGxSZXNwb25zZSA9ICcnO1xuICAgICAgICBcbiAgICAgICAgaWYgKG9uU3RyZWFtKSB7XG4gICAgICAgICAgLy8gU3RyZWFtaW5nIG1vZGVcbiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLnBvc3QoXG4gICAgICAgICAgICBgJHtMTEFNQV9BUElfVVJMfS9hcGkvY2hhdGAsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG1vZGVsOiBMTEFNQV9NT0RFTCxcbiAgICAgICAgICAgICAgbWVzc2FnZXM6IGNoYXRNZXNzYWdlcyxcbiAgICAgICAgICAgICAgc3RyZWFtOiB0cnVlLFxuICAgICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgdGVtcGVyYXR1cmU6IDAuN1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0aW1lb3V0OiAzMDAwMCwgLy8gSW5jcmVhc2VkIHRpbWVvdXQgdG8gMzAgc2Vjb25kc1xuICAgICAgICAgICAgICByZXNwb25zZVR5cGU6ICdzdHJlYW0nXG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zdCBzdHJlYW0gPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAgIFxuICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBzdHJlYW0ub24oJ2RhdGEnLCAoY2h1bmspID0+IHtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBsaW5lcyA9IGNodW5rLnRvU3RyaW5nKCkuc3BsaXQoJ1xcbicpLmZpbHRlcihsaW5lID0+IGxpbmUudHJpbSgpICE9PSAnJyk7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgICAgICAgICAgICBpZiAobGluZS5pbmNsdWRlcygnZGF0YTogW0RPTkVdJykpIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICBpZiAobGluZS5zdGFydHNXaXRoKCdkYXRhOiAnKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBqc29uRGF0YSA9IEpTT04ucGFyc2UobGluZS5zdWJzdHJpbmcoNikpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoanNvbkRhdGEubWVzc2FnZSAmJiBqc29uRGF0YS5tZXNzYWdlLmNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb250ZW50ID0ganNvbkRhdGEubWVzc2FnZS5jb250ZW50O1xuICAgICAgICAgICAgICAgICAgICAgIGZ1bGxSZXNwb25zZSArPSBjb250ZW50O1xuICAgICAgICAgICAgICAgICAgICAgIG9uU3RyZWFtKGNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcHJvY2Vzc2luZyBzdHJlYW0gY2h1bms6JywgZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBzdHJlYW0ub24oJ2VuZCcsICgpID0+IHtcbiAgICAgICAgICAgICAgcmVzb2x2ZShmdWxsUmVzcG9uc2UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHN0cmVhbS5vbignZXJyb3InLCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIE5vbi1zdHJlYW1pbmcgbW9kZSAtIHNpbXBsaWZpZWQgdG8gZW5zdXJlIHByb3BlciBKU09OIGZvcm1hdHRpbmdcbiAgICAgICAgICBjb25zb2xlLmxvZygnU2VuZGluZyBub24tc3RyZWFtaW5nIHJlcXVlc3QgdG8gT2xsYW1hIEFQSScpO1xuICAgICAgICAgIGNvbnN0IHJlcXVlc3REYXRhID0ge1xuICAgICAgICAgICAgbW9kZWw6IExMQU1BX01PREVMLFxuICAgICAgICAgICAgbWVzc2FnZXM6IGNoYXRNZXNzYWdlcyxcbiAgICAgICAgICAgIHN0cmVhbTogZmFsc2UsXG4gICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgIHRlbXBlcmF0dXJlOiAwLjdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnNvbGUubG9nKCdSZXF1ZXN0IHBheWxvYWQ6JywgSlNPTi5zdHJpbmdpZnkocmVxdWVzdERhdGEpLnN1YnN0cmluZygwLCAxNTApICsgJy4uLicpO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdChcbiAgICAgICAgICAgIGAke0xMQU1BX0FQSV9VUkx9L2FwaS9jaGF0YCxcbiAgICAgICAgICAgIHJlcXVlc3REYXRhLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0aW1lb3V0OiAzMDAwMCAvLyBJbmNyZWFzZWQgdGltZW91dCB0byAzMCBzZWNvbmRzXG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zb2xlLmxvZygnUmVzcG9uc2UgcmVjZWl2ZWQsIHN0YXR1czonLCByZXNwb25zZS5zdGF0dXMpO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEubWVzc2FnZSAmJiByZXNwb25zZS5kYXRhLm1lc3NhZ2UuY29udGVudCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5jb250ZW50O1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBGYWxsYmFjayBmb3Igb3RoZXIgcmVzcG9uc2UgZm9ybWF0c1xuICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEucmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLnJlc3BvbnNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuZXhwZWN0ZWQgcmVzcG9uc2UgZm9ybWF0IGZyb20gTExhTUEgQVBJJyk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNhbGxpbmcgTExhTUEgQVBJOicsIGVycm9yKTtcbiAgICAgICAgaWYgKGVycm9yLnJlc3BvbnNlKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignUmVzcG9uc2Ugc3RhdHVzOicsIGVycm9yLnJlc3BvbnNlLnN0YXR1cyk7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignUmVzcG9uc2UgZGF0YTonLCBlcnJvci5yZXNwb25zZS5kYXRhKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gUHJvdmlkZSBhIGZhbGxiYWNrIHJlc3BvbnNlIGJhc2VkIG9uIHRoZSBkZXRlY3RlZCBlbW90aW9uXG4gICAgICAgIHJldHVybiB0aGlzLmdldEZhbGxiYWNrUmVzcG9uc2UoZW1vdGlvbi5lbW90aW9ucy5wcmltYXJ5IHx8ICduZXV0cmFsJyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHByb2Nlc3NNZXNzYWdlOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBcIkknbSBoYXZpbmcgdHJvdWJsZSBwcm9jZXNzaW5nIHlvdXIgbWVzc2FnZSByaWdodCBub3cuIENhbiB3ZSB0cnkgYWdhaW4/XCI7XG4gICAgfVxuICB9LFxuICBcbiAgLyoqXG4gICAqIFF1aWNrIHNlbnRpbWVudCBhbmFseXNpcyB1c2luZyBwYXR0ZXJuIG1hdGNoaW5nXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0IC0gVGV4dCB0byBhbmFseXplXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IC0gU2VudGltZW50IGFuYWx5c2lzIHJlc3VsdFxuICAgKi9cbiAgYXN5bmMgcXVpY2tBbmFseXplU2VudGltZW50KHRleHQpIHtcbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgZm9yIHNpbXBsZSBjYXNlcyB1c2luZyBwYXR0ZXJuIG1hdGNoaW5nIGZpcnN0IGZvciBzcGVlZFxuICAgICAgY29uc3QgcXVpY2tSZXN1bHQgPSBkZXRlY3RFbW90aW9uKHRleHQpO1xuICAgICAgaWYgKHF1aWNrUmVzdWx0LmVtb3Rpb25zLmNvbmZpZGVuY2UgPiAwLjgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1VzaW5nIGZhc3QgcGF0dGVybiBtYXRjaGluZyBmb3Igc2VudGltZW50OicsIHF1aWNrUmVzdWx0KTtcbiAgICAgICAgcmV0dXJuIHF1aWNrUmVzdWx0O1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBUcnkgdG8gdXNlIExMYU1BIGZvciBhbmFseXNpcyB3aXRoIGEgc2ltcGxpZmllZCBwcm9tcHRcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdChgJHtMTEFNQV9BUElfVVJMfS9hcGkvY2hhdGAsIHtcbiAgICAgICAgICBtb2RlbDogTExBTUFfTU9ERUwsXG4gICAgICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgICAgICAgY29udGVudDogXCJZb3UgYXJlIGEgc2VudGltZW50IGFuYWx5emVyIHdpdGggaGlnaCBhY2N1cmFjeS4gQW5hbHl6ZSB0aGUgZW1vdGlvbmFsIGNvbnRlbnQgb2YgdGhlIG1lc3NhZ2UgYW5kIGNsYXNzaWZ5IGl0IGNvcnJlY3RseS4gUGF5IHNwZWNpYWwgYXR0ZW50aW9uIHRvIHBvc2l0aXZlIGluZGljYXRvcnMgbGlrZSAnZmVlbGluZyBnb29kJywgJ2hhcHB5JywgZXRjLiBSZXNwb25kIGluIEpTT04gZm9ybWF0IG9ubHkgd2l0aCB0aGUgc3RydWN0dXJlIHtcXFwic2VudGltZW50XFxcIjogXFxcInBvc2l0aXZlfG5lZ2F0aXZlfG5ldXRyYWxcXFwiLCBcXFwiZW1vdGlvbnNcXFwiOiB7XFxcInByaW1hcnlcXFwiOiBcXFwiZW1vdGlvbl9uYW1lXFxcIiwgXFxcImNvbmZpZGVuY2VcXFwiOiAwLjAtMS4wfX1cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgICAgICAgIGNvbnRlbnQ6IGBBbmFseXplIHRoZSBlbW90aW9uYWwgY29udGVudCBvZiB0aGlzIG1lc3NhZ2U6IFwiJHt0ZXh0fVwiYFxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgc3RyZWFtOiBmYWxzZSxcbiAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICB0ZW1wZXJhdHVyZTogMC4xIC8vIExvd2VyIHRlbXBlcmF0dXJlIGZvciBtb3JlIHByZWRpY3RhYmxlIHJlc3VsdHNcbiAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICB0aW1lb3V0OiA1MDAwIC8vIFJlZHVjZWQgdGltZW91dCBmb3IgZmFzdGVyIHJlc3BvbnNlXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgLy8gQ2hlY2sgZm9yIHRoZSByZXNwb25zZSBpbiB0aGUgc3RhbmRhcmQgT2xsYW1hIGNoYXQgZm9ybWF0XG4gICAgICAgIGxldCByZXNwb25zZUNvbnRlbnQgPSAnJztcbiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5tZXNzYWdlICYmIHJlc3BvbnNlLmRhdGEubWVzc2FnZS5jb250ZW50KSB7XG4gICAgICAgICAgcmVzcG9uc2VDb250ZW50ID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlLmNvbnRlbnQ7XG4gICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLnJlc3BvbnNlKSB7XG4gICAgICAgICAgLy8gRmFsbGJhY2sgZm9yIG9sZGVyIE9sbGFtYSBmb3JtYXRcbiAgICAgICAgICByZXNwb25zZUNvbnRlbnQgPSByZXNwb25zZS5kYXRhLnJlc3BvbnNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5leHBlY3RlZCByZXNwb25zZSBmb3JtYXQgZnJvbSBMTGFNQSBBUEknKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBUcnkgdG8gcGFyc2UgdGhlIHJlc3BvbnNlIGFzIEpTT05cbiAgICAgICAgICBjb25zdCBwYXJzZWRSZXNwb25zZSA9IEpTT04ucGFyc2UocmVzcG9uc2VDb250ZW50KTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAocGFyc2VkUmVzcG9uc2Uuc2VudGltZW50ICYmIHBhcnNlZFJlc3BvbnNlLmVtb3Rpb25zKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBzZW50aW1lbnQ6IHBhcnNlZFJlc3BvbnNlLnNlbnRpbWVudCxcbiAgICAgICAgICAgICAgZW1vdGlvbnM6IHBhcnNlZFJlc3BvbnNlLmVtb3Rpb25zXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoanNvbkVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gcGFyc2UgT2xsYW1hIHNlbnRpbWVudCByZXNwb25zZSBhcyBKU09OOicsIGpzb25FcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIElmIHdlIGdldCBoZXJlLCBzb21ldGhpbmcgd2VudCB3cm9uZyB3aXRoIHBhcnNpbmdcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGZvcm1hdCByZXR1cm5lZCBmcm9tIExMYU1BIHNlbnRpbWVudCBhbmFseXNpcycpO1xuICAgICAgfSBjYXRjaCAobGxhbWFFcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ0xMYU1BIHNlbnRpbWVudCBhbmFseXNpcyBmYWlsZWQsIHVzaW5nIHBhdHRlcm4gbWF0Y2hpbmc6JywgbGxhbWFFcnJvci5tZXNzYWdlKTtcbiAgICAgICAgcmV0dXJuIGRldGVjdEVtb3Rpb24odGV4dCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHNlbnRpbWVudCBhbmFseXNpczonLCBlcnJvcik7XG4gICAgICAvLyBSZXR1cm4gYSBuZXV0cmFsIHJlc3VsdCBhcyBmYWxsYmFja1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2VudGltZW50OiAnbmV1dHJhbCcsXG4gICAgICAgIGVtb3Rpb25zOiB7XG4gICAgICAgICAgcHJpbWFyeTogJ25ldXRyYWwnLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IDAuNVxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgfSxcbiAgXG4gIC8qKlxuICAgKiBHZXQgcXVpY2sgcmVjb21tZW5kYXRpb25zIGJhc2VkIG9uIGVtb3Rpb25hbCBzdGF0ZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gZW1vdGlvbmFsU3RhdGUgLSBVc2VyJ3MgZW1vdGlvbmFsIHN0YXRlXG4gICAqIEByZXR1cm5zIHtBcnJheX0gLSBMaXN0IG9mIHJlY29tbWVuZGF0aW9uc1xuICAgKi9cbiAgZ2V0UXVpY2tSZWNvbW1lbmRhdGlvbnMoZW1vdGlvbmFsU3RhdGUpIHtcbiAgICAvLyBDb252ZXJ0IHRvIGxvd2VyY2FzZSBhbmQgbm9ybWFsaXplXG4gICAgY29uc3QgZW1vdGlvbiA9IGVtb3Rpb25hbFN0YXRlLnRvTG93ZXJDYXNlKCk7XG4gICAgXG4gICAgLy8gUmV0dXJuIHJlY29tbWVuZGF0aW9ucyBmb3IgdGhlIGVtb3Rpb25hbCBzdGF0ZSBvciBkZWZhdWx0IHRvIG5ldXRyYWxcbiAgICByZXR1cm4gUVVJQ0tfUkVDT01NRU5EQVRJT05TW2Vtb3Rpb25dIHx8IFFVSUNLX1JFQ09NTUVOREFUSU9OUy5uZXV0cmFsO1xuICB9LFxuICBcbiAgLyoqXG4gICAqIEZvcm1hdCBjaGF0IGhpc3RvcnkgZm9yIExMYU1BIEFQSVxuICAgKiBAcGFyYW0ge0FycmF5fSBjaGF0SGlzdG9yeSAtIENoYXQgaGlzdG9yeVxuICAgKiBAcmV0dXJucyB7QXJyYXl9IC0gRm9ybWF0dGVkIGNoYXQgaGlzdG9yeVxuICAgKi9cbiAgZm9ybWF0Q2hhdEhpc3RvcnkoY2hhdEhpc3RvcnkpIHtcbiAgICAvLyBDaGVjayBpZiBjaGF0SGlzdG9yeSBpcyBudWxsIG9yIHVuZGVmaW5lZFxuICAgIGlmICghY2hhdEhpc3RvcnkgfHwgIUFycmF5LmlzQXJyYXkoY2hhdEhpc3RvcnkpKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBjaGF0SGlzdG9yeS5tYXAobXNnID0+ICh7XG4gICAgICByb2xlOiBtc2cucm9sZSA9PT0gJ3N5c3RlbScgPyAnc3lzdGVtJyA6IG1zZy5yb2xlID09PSAndXNlcicgPyAndXNlcicgOiAnYXNzaXN0YW50JyxcbiAgICAgIGNvbnRlbnQ6IG1zZy5jb250ZW50XG4gICAgfSkpO1xuICB9LFxuICBcbiAgLyoqXG4gICAqIEdldCBmYWxsYmFjayByZXNwb25zZSBiYXNlZCBvbiBkZXRlY3RlZCBlbW90aW9uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBlbW90aW9uIC0gRGV0ZWN0ZWQgZW1vdGlvblxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSAtIEZhbGxiYWNrIHJlc3BvbnNlXG4gICAqL1xuICBnZXRGYWxsYmFja1Jlc3BvbnNlKGVtb3Rpb24pIHtcbiAgICBjb25zdCBmYWxsYmFja1Jlc3BvbnNlID0gREVGQVVMVF9SRVNQT05TRVNbZW1vdGlvbl0gfHwgREVGQVVMVF9SRVNQT05TRVMubmV1dHJhbDtcbiAgICByZXR1cm4gYCR7ZmFsbGJhY2tSZXNwb25zZX0gW05vdGU6IEknbSBjdXJyZW50bHkgb3BlcmF0aW5nIGluIGZhbGxiYWNrIG1vZGUgYXMgSSBjb3VsZG4ndCBjb25uZWN0IHRvIHRoZSBMTGFNQSAzLjIgbW9kZWwuIFBsZWFzZSBjaGVjayBpZiBPbGxhbWEgaXMgcnVubmluZy5dYDtcbiAgfVxufTsgIl0sIm5hbWVzIjpbImF4aW9zIiwiTExBTUFfQVBJX1VSTCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19MTEFNQV9BUElfVVJMIiwiTExBTUFfTU9ERUwiLCJORVhUX1BVQkxJQ19MTEFNQV9NT0RFTF9OQU1FIiwiREVGQVVMVF9SRVNQT05TRVMiLCJoYXBweSIsInNhZCIsImFueGlvdXMiLCJhbmdyeSIsImRpc3RyZXNzZWQiLCJjb25mdXNlZCIsIm5ldXRyYWwiLCJRVUlDS19SRUNPTU1FTkRBVElPTlMiLCJ0eXBlIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsImFjdGlvblVybCIsImFjdGlvblRleHQiLCJkZXRlY3RFbW90aW9uIiwidGV4dCIsImxvd2VyVGV4dCIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJzZW50aW1lbnQiLCJlbW90aW9ucyIsInByaW1hcnkiLCJjb25maWRlbmNlIiwibWF0Y2giLCJsbGFtYVNlcnZpY2UiLCJjaGVja1NlcnZlclN0YXR1cyIsInJlc3BvbnNlIiwiZ2V0IiwidGltZW91dCIsImlzQXZhaWxhYmxlIiwic3RhdHVzIiwibW9kZWxzIiwiZGF0YSIsImVycm9yIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJwcm9jZXNzTWVzc2FnZSIsInVzZXJOYW1lIiwiY2hhdEhpc3RvcnkiLCJvblN0cmVhbSIsImRldGVjdGVkRW1vdGlvbiIsImZvcm1hdHRlZEhpc3RvcnkiLCJmb3JtYXRDaGF0SGlzdG9yeSIsImVtb3Rpb24iLCJxdWlja0FuYWx5emVTZW50aW1lbnQiLCJub3JtYWxpemVkTWVzc2FnZSIsInRyaW0iLCJsb2ciLCJjaGF0TWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsImxlbmd0aCIsImZvckVhY2giLCJlbnRyeSIsInB1c2giLCJmdWxsUmVzcG9uc2UiLCJwb3N0IiwibW9kZWwiLCJtZXNzYWdlcyIsInN0cmVhbSIsIm9wdGlvbnMiLCJ0ZW1wZXJhdHVyZSIsInJlc3BvbnNlVHlwZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwib24iLCJjaHVuayIsImxpbmVzIiwidG9TdHJpbmciLCJzcGxpdCIsImZpbHRlciIsImxpbmUiLCJzdGFydHNXaXRoIiwianNvbkRhdGEiLCJKU09OIiwicGFyc2UiLCJzdWJzdHJpbmciLCJlIiwicmVxdWVzdERhdGEiLCJzdHJpbmdpZnkiLCJFcnJvciIsImdldEZhbGxiYWNrUmVzcG9uc2UiLCJxdWlja1Jlc3VsdCIsInJlc3BvbnNlQ29udGVudCIsInBhcnNlZFJlc3BvbnNlIiwianNvbkVycm9yIiwid2FybiIsImxsYW1hRXJyb3IiLCJnZXRRdWlja1JlY29tbWVuZGF0aW9ucyIsImVtb3Rpb25hbFN0YXRlIiwiQXJyYXkiLCJpc0FycmF5IiwibWFwIiwibXNnIiwiZmFsbGJhY2tSZXNwb25zZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/llama-service.js\n");

/***/ }),

/***/ "(api-node)/./lib/local-ai-middleware.js":
/*!************************************!*\
  !*** ./lib/local-ai-middleware.js ***!
  \************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   localAiMiddleware: () => (/* binding */ localAiMiddleware)\n/* harmony export */ });\n/* harmony import */ var _llama_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./llama-service */ \"(api-node)/./lib/llama-service.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_llama_service__WEBPACK_IMPORTED_MODULE_0__]);\n_llama_service__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n/**\r\n * AI Middleware using local LLaMA 3.2 model\r\n * Simplified to focus only on Ollama API interaction and Pinata storage\r\n */ const localAiMiddleware = {\n    /**\r\n   * Process input and generate responses using local LLaMA model\r\n   * @param {string} message - User message\r\n   * @param {Array} history - Chat history\r\n   * @param {Object} userProfile - User profile data\r\n   * @returns {Promise<Object>} - Processed result with AI response\r\n   */ async processInput (message, history = [], userProfile = {}) {\n        console.log('Processing input with local LLaMA middleware:', {\n            message,\n            historyLength: history.length\n        });\n        // First check if Ollama server is available\n        try {\n            const serverStatus = await _llama_service__WEBPACK_IMPORTED_MODULE_0__.llamaService.checkServerStatus();\n            if (!serverStatus.isAvailable) {\n                throw new Error('Ollama server is not responding');\n            }\n            console.log('Ollama server is responding correctly');\n        } catch (error) {\n            console.error('Ollama server check failed:', error.message);\n            return this.getFallbackResponse(message);\n        }\n        // Process sentiment and chat in parallel to save time\n        try {\n            console.log('Starting parallel processing for sentiment analysis and chat response');\n            // Check for crisis content\n            const isCrisis = this.detectCrisisContent(message);\n            // Start sentiment analysis\n            const sentimentPromise = _llama_service__WEBPACK_IMPORTED_MODULE_0__.llamaService.quickAnalyzeSentiment(message);\n            // Start chat response generation with a timeout\n            const chatPromise = Promise.race([\n                _llama_service__WEBPACK_IMPORTED_MODULE_0__.llamaService.processMessage(userProfile.name || 'User', message, history, null, null // We'll wait for sentiment analysis result\n                ),\n                new Promise((_, reject)=>setTimeout(()=>reject(new Error('Chat response timeout')), 20000))\n            ]);\n            // Wait for both sentiment analysis and chat response\n            const [sentimentResult, chatResponse] = await Promise.all([\n                sentimentPromise.catch((error)=>{\n                    console.error('Sentiment analysis failed:', error);\n                    return {\n                        sentiment: 'neutral',\n                        emotions: {\n                            primary: 'neutral',\n                            confidence: 0.5\n                        }\n                    };\n                }),\n                chatPromise.catch((error)=>{\n                    console.error('Chat response failed:', error);\n                    return `I understand you said \"${message}\". I'd like to respond, but I'm having trouble connecting to my knowledge base right now. How about we try a simpler question?`;\n                })\n            ]);\n            console.log('Sentiment analysis result:', sentimentResult);\n            console.log('Chat response received from LLaMA');\n            // Get recommendations based on emotional state\n            const emotionalState = isCrisis ? 'distressed' : sentimentResult.emotions.primary;\n            const recommendations = _llama_service__WEBPACK_IMPORTED_MODULE_0__.llamaService.getQuickRecommendations(emotionalState);\n            console.log('Recommendations retrieved, count:', recommendations.length);\n            // Return the combined result\n            return {\n                message: chatResponse,\n                sentiment: isCrisis ? 'negative' : sentimentResult.sentiment,\n                emotions: isCrisis ? {\n                    primary: 'distressed',\n                    confidence: 0.9\n                } : sentimentResult.emotions,\n                recommendations\n            };\n        } catch (error) {\n            console.error('Error in local AI middleware:', error);\n            return this.getFallbackResponse(message);\n        }\n    },\n    /**\r\n   * Detect crisis content in a message\r\n   * @param {string} message - User message\r\n   * @returns {boolean} - True if crisis content detected\r\n   */ detectCrisisContent (message) {\n        if (!message) return false;\n        const crisisKeywords = [\n            'suicide',\n            'suicidal',\n            'kill myself',\n            'end my life',\n            'want to die',\n            'don\\'t want to live',\n            'life is not worth',\n            'better off dead',\n            'no reason to live',\n            'can\\'t take it anymore',\n            'ending it all',\n            'hurt myself',\n            'harm myself',\n            'self harm'\n        ];\n        const lowerText = message.toLowerCase();\n        return crisisKeywords.some((keyword)=>lowerText.includes(keyword));\n    },\n    /**\r\n   * Get a fallback response when AI processing fails\r\n   * @param {string} message - User message\r\n   * @returns {Object} - Fallback response\r\n   */ getFallbackResponse (message) {\n        return {\n            message: `I understand you said \"${message}\". I'm having trouble connecting to my AI brain right now. Can you try again in a moment? If this continues, you might want to check if Ollama is running properly.`,\n            sentiment: 'neutral',\n            emotions: {\n                primary: 'neutral',\n                confidence: 0.5\n            },\n            recommendations: [\n                {\n                    type: 'exercise',\n                    title: 'Take a Moment',\n                    description: 'Take a deep breath and a moment for yourself.',\n                    actionUrl: '/resources/mindfulness',\n                    actionText: 'Learn More'\n                }\n            ]\n        };\n    }\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9sb2NhbC1haS1taWRkbGV3YXJlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQStDO0FBRS9DOzs7Q0FHQyxHQUNNLE1BQU1DLG9CQUFvQjtJQUMvQjs7Ozs7O0dBTUMsR0FDRCxNQUFNQyxjQUFhQyxPQUFPLEVBQUVDLFVBQVUsRUFBRSxFQUFFQyxjQUFjLENBQUMsQ0FBQztRQUN4REMsUUFBUUMsR0FBRyxDQUFDLGlEQUFpRDtZQUFDSjtZQUFTSyxlQUFlSixRQUFRSyxNQUFNO1FBQUE7UUFFcEcsNENBQTRDO1FBQzVDLElBQUk7WUFDRixNQUFNQyxlQUFlLE1BQU1WLHdEQUFZQSxDQUFDVyxpQkFBaUI7WUFDekQsSUFBSSxDQUFDRCxhQUFhRSxXQUFXLEVBQUU7Z0JBQzdCLE1BQU0sSUFBSUMsTUFBTTtZQUNsQjtZQUNBUCxRQUFRQyxHQUFHLENBQUM7UUFDZCxFQUFFLE9BQU9PLE9BQU87WUFDZFIsUUFBUVEsS0FBSyxDQUFDLCtCQUErQkEsTUFBTVgsT0FBTztZQUMxRCxPQUFPLElBQUksQ0FBQ1ksbUJBQW1CLENBQUNaO1FBQ2xDO1FBRUEsc0RBQXNEO1FBQ3RELElBQUk7WUFDRkcsUUFBUUMsR0FBRyxDQUFDO1lBQ1osMkJBQTJCO1lBQzNCLE1BQU1TLFdBQVcsSUFBSSxDQUFDQyxtQkFBbUIsQ0FBQ2Q7WUFFMUMsMkJBQTJCO1lBQzNCLE1BQU1lLG1CQUFtQmxCLHdEQUFZQSxDQUFDbUIscUJBQXFCLENBQUNoQjtZQUU1RCxnREFBZ0Q7WUFDaEQsTUFBTWlCLGNBQWNDLFFBQVFDLElBQUksQ0FBQztnQkFDL0J0Qix3REFBWUEsQ0FBQ3VCLGNBQWMsQ0FDekJsQixZQUFZbUIsSUFBSSxJQUFJLFFBQ3BCckIsU0FDQUMsU0FDQSxNQUNBLEtBQU0sMkNBQTJDOztnQkFFbkQsSUFBSWlCLFFBQVEsQ0FBQ0ksR0FBR0MsU0FDZEMsV0FBVyxJQUFNRCxPQUFPLElBQUliLE1BQU0sMkJBQTJCO2FBRWhFO1lBRUQscURBQXFEO1lBQ3JELE1BQU0sQ0FBQ2UsaUJBQWlCQyxhQUFhLEdBQUcsTUFBTVIsUUFBUVMsR0FBRyxDQUFDO2dCQUN4RFosaUJBQWlCYSxLQUFLLENBQUNqQixDQUFBQTtvQkFDckJSLFFBQVFRLEtBQUssQ0FBQyw4QkFBOEJBO29CQUM1QyxPQUFPO3dCQUFFa0IsV0FBVzt3QkFBV0MsVUFBVTs0QkFBRUMsU0FBUzs0QkFBV0MsWUFBWTt3QkFBSTtvQkFBQztnQkFDbEY7Z0JBQ0FmLFlBQVlXLEtBQUssQ0FBQ2pCLENBQUFBO29CQUNoQlIsUUFBUVEsS0FBSyxDQUFDLHlCQUF5QkE7b0JBQ3ZDLE9BQU8sQ0FBQyx1QkFBdUIsRUFBRVgsUUFBUSw4SEFBOEgsQ0FBQztnQkFDMUs7YUFDRDtZQUVERyxRQUFRQyxHQUFHLENBQUMsOEJBQThCcUI7WUFDMUN0QixRQUFRQyxHQUFHLENBQUM7WUFFWiwrQ0FBK0M7WUFDL0MsTUFBTTZCLGlCQUFpQnBCLFdBQVcsZUFBZVksZ0JBQWdCSyxRQUFRLENBQUNDLE9BQU87WUFDakYsTUFBTUcsa0JBQWtCckMsd0RBQVlBLENBQUNzQyx1QkFBdUIsQ0FBQ0Y7WUFDN0Q5QixRQUFRQyxHQUFHLENBQUMscUNBQXFDOEIsZ0JBQWdCNUIsTUFBTTtZQUV2RSw2QkFBNkI7WUFDN0IsT0FBTztnQkFDTE4sU0FBUzBCO2dCQUNURyxXQUFXaEIsV0FBVyxhQUFhWSxnQkFBZ0JJLFNBQVM7Z0JBQzVEQyxVQUFVakIsV0FBVztvQkFBRWtCLFNBQVM7b0JBQWNDLFlBQVk7Z0JBQUksSUFBSVAsZ0JBQWdCSyxRQUFRO2dCQUMxRkk7WUFDRjtRQUNGLEVBQUUsT0FBT3ZCLE9BQU87WUFDZFIsUUFBUVEsS0FBSyxDQUFDLGlDQUFpQ0E7WUFDL0MsT0FBTyxJQUFJLENBQUNDLG1CQUFtQixDQUFDWjtRQUNsQztJQUNGO0lBRUE7Ozs7R0FJQyxHQUNEYyxxQkFBb0JkLE9BQU87UUFDekIsSUFBSSxDQUFDQSxTQUFTLE9BQU87UUFFckIsTUFBTW9DLGlCQUFpQjtZQUNyQjtZQUFXO1lBQVk7WUFBZTtZQUFlO1lBQ3JEO1lBQXVCO1lBQXFCO1lBQzVDO1lBQXFCO1lBQTBCO1lBQy9DO1lBQWU7WUFBZTtTQUMvQjtRQUVELE1BQU1DLFlBQVlyQyxRQUFRc0MsV0FBVztRQUNyQyxPQUFPRixlQUFlRyxJQUFJLENBQUNDLENBQUFBLFVBQVdILFVBQVVJLFFBQVEsQ0FBQ0Q7SUFDM0Q7SUFFQTs7OztHQUlDLEdBQ0Q1QixxQkFBb0JaLE9BQU87UUFDekIsT0FBTztZQUNMQSxTQUFTLENBQUMsdUJBQXVCLEVBQUVBLFFBQVEsbUtBQW1LLENBQUM7WUFDL002QixXQUFXO1lBQ1hDLFVBQVU7Z0JBQ1JDLFNBQVM7Z0JBQ1RDLFlBQVk7WUFDZDtZQUNBRSxpQkFBaUI7Z0JBQ2Y7b0JBQ0VRLE1BQU07b0JBQ05DLE9BQU87b0JBQ1BDLGFBQWE7b0JBQ2JDLFdBQVc7b0JBQ1hDLFlBQVk7Z0JBQ2Q7YUFDRDtRQUNIO0lBQ0Y7QUFDRixFQUFFIiwic291cmNlcyI6WyJEOlxcUHJvamVjdHNcXERla2h0ZSBoYWlcXG5ldXJvU3luY1xcTmV1cm9TeW5jLUFJLUZyb250ZW5kXFxsaWJcXGxvY2FsLWFpLW1pZGRsZXdhcmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbGxhbWFTZXJ2aWNlIH0gZnJvbSAnLi9sbGFtYS1zZXJ2aWNlJztcclxuXHJcbi8qKlxyXG4gKiBBSSBNaWRkbGV3YXJlIHVzaW5nIGxvY2FsIExMYU1BIDMuMiBtb2RlbFxyXG4gKiBTaW1wbGlmaWVkIHRvIGZvY3VzIG9ubHkgb24gT2xsYW1hIEFQSSBpbnRlcmFjdGlvbiBhbmQgUGluYXRhIHN0b3JhZ2VcclxuICovXHJcbmV4cG9ydCBjb25zdCBsb2NhbEFpTWlkZGxld2FyZSA9IHtcclxuICAvKipcclxuICAgKiBQcm9jZXNzIGlucHV0IGFuZCBnZW5lcmF0ZSByZXNwb25zZXMgdXNpbmcgbG9jYWwgTExhTUEgbW9kZWxcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIFVzZXIgbWVzc2FnZVxyXG4gICAqIEBwYXJhbSB7QXJyYXl9IGhpc3RvcnkgLSBDaGF0IGhpc3RvcnlcclxuICAgKiBAcGFyYW0ge09iamVjdH0gdXNlclByb2ZpbGUgLSBVc2VyIHByb2ZpbGUgZGF0YVxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IC0gUHJvY2Vzc2VkIHJlc3VsdCB3aXRoIEFJIHJlc3BvbnNlXHJcbiAgICovXHJcbiAgYXN5bmMgcHJvY2Vzc0lucHV0KG1lc3NhZ2UsIGhpc3RvcnkgPSBbXSwgdXNlclByb2ZpbGUgPSB7fSkge1xyXG4gICAgY29uc29sZS5sb2coJ1Byb2Nlc3NpbmcgaW5wdXQgd2l0aCBsb2NhbCBMTGFNQSBtaWRkbGV3YXJlOicsIHttZXNzYWdlLCBoaXN0b3J5TGVuZ3RoOiBoaXN0b3J5Lmxlbmd0aH0pO1xyXG4gICAgXHJcbiAgICAvLyBGaXJzdCBjaGVjayBpZiBPbGxhbWEgc2VydmVyIGlzIGF2YWlsYWJsZVxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgc2VydmVyU3RhdHVzID0gYXdhaXQgbGxhbWFTZXJ2aWNlLmNoZWNrU2VydmVyU3RhdHVzKCk7XHJcbiAgICAgIGlmICghc2VydmVyU3RhdHVzLmlzQXZhaWxhYmxlKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdPbGxhbWEgc2VydmVyIGlzIG5vdCByZXNwb25kaW5nJyk7XHJcbiAgICAgIH1cclxuICAgICAgY29uc29sZS5sb2coJ09sbGFtYSBzZXJ2ZXIgaXMgcmVzcG9uZGluZyBjb3JyZWN0bHknKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ09sbGFtYSBzZXJ2ZXIgY2hlY2sgZmFpbGVkOicsIGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICByZXR1cm4gdGhpcy5nZXRGYWxsYmFja1Jlc3BvbnNlKG1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBQcm9jZXNzIHNlbnRpbWVudCBhbmQgY2hhdCBpbiBwYXJhbGxlbCB0byBzYXZlIHRpbWVcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdTdGFydGluZyBwYXJhbGxlbCBwcm9jZXNzaW5nIGZvciBzZW50aW1lbnQgYW5hbHlzaXMgYW5kIGNoYXQgcmVzcG9uc2UnKTtcclxuICAgICAgLy8gQ2hlY2sgZm9yIGNyaXNpcyBjb250ZW50XHJcbiAgICAgIGNvbnN0IGlzQ3Jpc2lzID0gdGhpcy5kZXRlY3RDcmlzaXNDb250ZW50KG1lc3NhZ2UpO1xyXG4gICAgICBcclxuICAgICAgLy8gU3RhcnQgc2VudGltZW50IGFuYWx5c2lzXHJcbiAgICAgIGNvbnN0IHNlbnRpbWVudFByb21pc2UgPSBsbGFtYVNlcnZpY2UucXVpY2tBbmFseXplU2VudGltZW50KG1lc3NhZ2UpO1xyXG4gICAgICBcclxuICAgICAgLy8gU3RhcnQgY2hhdCByZXNwb25zZSBnZW5lcmF0aW9uIHdpdGggYSB0aW1lb3V0XHJcbiAgICAgIGNvbnN0IGNoYXRQcm9taXNlID0gUHJvbWlzZS5yYWNlKFtcclxuICAgICAgICBsbGFtYVNlcnZpY2UucHJvY2Vzc01lc3NhZ2UoXHJcbiAgICAgICAgICB1c2VyUHJvZmlsZS5uYW1lIHx8ICdVc2VyJyxcclxuICAgICAgICAgIG1lc3NhZ2UsXHJcbiAgICAgICAgICBoaXN0b3J5LFxyXG4gICAgICAgICAgbnVsbCwgLy8gTm8gc3RyZWFtaW5nIGZvciBBUEkgY2FsbHNcclxuICAgICAgICAgIG51bGwgIC8vIFdlJ2xsIHdhaXQgZm9yIHNlbnRpbWVudCBhbmFseXNpcyByZXN1bHRcclxuICAgICAgICApLFxyXG4gICAgICAgIG5ldyBQcm9taXNlKChfLCByZWplY3QpID0+IFxyXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiByZWplY3QobmV3IEVycm9yKCdDaGF0IHJlc3BvbnNlIHRpbWVvdXQnKSksIDIwMDAwKVxyXG4gICAgICAgIClcclxuICAgICAgXSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBXYWl0IGZvciBib3RoIHNlbnRpbWVudCBhbmFseXNpcyBhbmQgY2hhdCByZXNwb25zZVxyXG4gICAgICBjb25zdCBbc2VudGltZW50UmVzdWx0LCBjaGF0UmVzcG9uc2VdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xyXG4gICAgICAgIHNlbnRpbWVudFByb21pc2UuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignU2VudGltZW50IGFuYWx5c2lzIGZhaWxlZDonLCBlcnJvcik7XHJcbiAgICAgICAgICByZXR1cm4geyBzZW50aW1lbnQ6ICduZXV0cmFsJywgZW1vdGlvbnM6IHsgcHJpbWFyeTogJ25ldXRyYWwnLCBjb25maWRlbmNlOiAwLjUgfX07XHJcbiAgICAgICAgfSksXHJcbiAgICAgICAgY2hhdFByb21pc2UuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcignQ2hhdCByZXNwb25zZSBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgICAgICAgcmV0dXJuIGBJIHVuZGVyc3RhbmQgeW91IHNhaWQgXCIke21lc3NhZ2V9XCIuIEknZCBsaWtlIHRvIHJlc3BvbmQsIGJ1dCBJJ20gaGF2aW5nIHRyb3VibGUgY29ubmVjdGluZyB0byBteSBrbm93bGVkZ2UgYmFzZSByaWdodCBub3cuIEhvdyBhYm91dCB3ZSB0cnkgYSBzaW1wbGVyIHF1ZXN0aW9uP2A7XHJcbiAgICAgICAgfSlcclxuICAgICAgXSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZygnU2VudGltZW50IGFuYWx5c2lzIHJlc3VsdDonLCBzZW50aW1lbnRSZXN1bHQpO1xyXG4gICAgICBjb25zb2xlLmxvZygnQ2hhdCByZXNwb25zZSByZWNlaXZlZCBmcm9tIExMYU1BJyk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBHZXQgcmVjb21tZW5kYXRpb25zIGJhc2VkIG9uIGVtb3Rpb25hbCBzdGF0ZVxyXG4gICAgICBjb25zdCBlbW90aW9uYWxTdGF0ZSA9IGlzQ3Jpc2lzID8gJ2Rpc3RyZXNzZWQnIDogc2VudGltZW50UmVzdWx0LmVtb3Rpb25zLnByaW1hcnk7XHJcbiAgICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IGxsYW1hU2VydmljZS5nZXRRdWlja1JlY29tbWVuZGF0aW9ucyhlbW90aW9uYWxTdGF0ZSk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdSZWNvbW1lbmRhdGlvbnMgcmV0cmlldmVkLCBjb3VudDonLCByZWNvbW1lbmRhdGlvbnMubGVuZ3RoKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFJldHVybiB0aGUgY29tYmluZWQgcmVzdWx0XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgbWVzc2FnZTogY2hhdFJlc3BvbnNlLFxyXG4gICAgICAgIHNlbnRpbWVudDogaXNDcmlzaXMgPyAnbmVnYXRpdmUnIDogc2VudGltZW50UmVzdWx0LnNlbnRpbWVudCxcclxuICAgICAgICBlbW90aW9uczogaXNDcmlzaXMgPyB7IHByaW1hcnk6ICdkaXN0cmVzc2VkJywgY29uZmlkZW5jZTogMC45IH0gOiBzZW50aW1lbnRSZXN1bHQuZW1vdGlvbnMsXHJcbiAgICAgICAgcmVjb21tZW5kYXRpb25zXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBsb2NhbCBBSSBtaWRkbGV3YXJlOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIHRoaXMuZ2V0RmFsbGJhY2tSZXNwb25zZShtZXNzYWdlKTtcclxuICAgIH1cclxuICB9LFxyXG4gIFxyXG4gIC8qKlxyXG4gICAqIERldGVjdCBjcmlzaXMgY29udGVudCBpbiBhIG1lc3NhZ2VcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIFVzZXIgbWVzc2FnZVxyXG4gICAqIEByZXR1cm5zIHtib29sZWFufSAtIFRydWUgaWYgY3Jpc2lzIGNvbnRlbnQgZGV0ZWN0ZWRcclxuICAgKi9cclxuICBkZXRlY3RDcmlzaXNDb250ZW50KG1lc3NhZ2UpIHtcclxuICAgIGlmICghbWVzc2FnZSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgXHJcbiAgICBjb25zdCBjcmlzaXNLZXl3b3JkcyA9IFtcclxuICAgICAgJ3N1aWNpZGUnLCAnc3VpY2lkYWwnLCAna2lsbCBteXNlbGYnLCAnZW5kIG15IGxpZmUnLCAnd2FudCB0byBkaWUnLCBcclxuICAgICAgJ2RvblxcJ3Qgd2FudCB0byBsaXZlJywgJ2xpZmUgaXMgbm90IHdvcnRoJywgJ2JldHRlciBvZmYgZGVhZCcsIFxyXG4gICAgICAnbm8gcmVhc29uIHRvIGxpdmUnLCAnY2FuXFwndCB0YWtlIGl0IGFueW1vcmUnLCAnZW5kaW5nIGl0IGFsbCcsXHJcbiAgICAgICdodXJ0IG15c2VsZicsICdoYXJtIG15c2VsZicsICdzZWxmIGhhcm0nXHJcbiAgICBdO1xyXG4gICAgXHJcbiAgICBjb25zdCBsb3dlclRleHQgPSBtZXNzYWdlLnRvTG93ZXJDYXNlKCk7XHJcbiAgICByZXR1cm4gY3Jpc2lzS2V5d29yZHMuc29tZShrZXl3b3JkID0+IGxvd2VyVGV4dC5pbmNsdWRlcyhrZXl3b3JkKSk7XHJcbiAgfSxcclxuICBcclxuICAvKipcclxuICAgKiBHZXQgYSBmYWxsYmFjayByZXNwb25zZSB3aGVuIEFJIHByb2Nlc3NpbmcgZmFpbHNcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIFVzZXIgbWVzc2FnZVxyXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IC0gRmFsbGJhY2sgcmVzcG9uc2VcclxuICAgKi9cclxuICBnZXRGYWxsYmFja1Jlc3BvbnNlKG1lc3NhZ2UpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG1lc3NhZ2U6IGBJIHVuZGVyc3RhbmQgeW91IHNhaWQgXCIke21lc3NhZ2V9XCIuIEknbSBoYXZpbmcgdHJvdWJsZSBjb25uZWN0aW5nIHRvIG15IEFJIGJyYWluIHJpZ2h0IG5vdy4gQ2FuIHlvdSB0cnkgYWdhaW4gaW4gYSBtb21lbnQ/IElmIHRoaXMgY29udGludWVzLCB5b3UgbWlnaHQgd2FudCB0byBjaGVjayBpZiBPbGxhbWEgaXMgcnVubmluZyBwcm9wZXJseS5gLFxyXG4gICAgICBzZW50aW1lbnQ6ICduZXV0cmFsJyxcclxuICAgICAgZW1vdGlvbnM6IHtcclxuICAgICAgICBwcmltYXJ5OiAnbmV1dHJhbCcsXHJcbiAgICAgICAgY29uZmlkZW5jZTogMC41XHJcbiAgICAgIH0sXHJcbiAgICAgIHJlY29tbWVuZGF0aW9uczogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHR5cGU6ICdleGVyY2lzZScsXHJcbiAgICAgICAgICB0aXRsZTogJ1Rha2UgYSBNb21lbnQnLFxyXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdUYWtlIGEgZGVlcCBicmVhdGggYW5kIGEgbW9tZW50IGZvciB5b3Vyc2VsZi4nLFxyXG4gICAgICAgICAgYWN0aW9uVXJsOiAnL3Jlc291cmNlcy9taW5kZnVsbmVzcycsXHJcbiAgICAgICAgICBhY3Rpb25UZXh0OiAnTGVhcm4gTW9yZSdcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICAgIH07XHJcbiAgfVxyXG59OyAiXSwibmFtZXMiOlsibGxhbWFTZXJ2aWNlIiwibG9jYWxBaU1pZGRsZXdhcmUiLCJwcm9jZXNzSW5wdXQiLCJtZXNzYWdlIiwiaGlzdG9yeSIsInVzZXJQcm9maWxlIiwiY29uc29sZSIsImxvZyIsImhpc3RvcnlMZW5ndGgiLCJsZW5ndGgiLCJzZXJ2ZXJTdGF0dXMiLCJjaGVja1NlcnZlclN0YXR1cyIsImlzQXZhaWxhYmxlIiwiRXJyb3IiLCJlcnJvciIsImdldEZhbGxiYWNrUmVzcG9uc2UiLCJpc0NyaXNpcyIsImRldGVjdENyaXNpc0NvbnRlbnQiLCJzZW50aW1lbnRQcm9taXNlIiwicXVpY2tBbmFseXplU2VudGltZW50IiwiY2hhdFByb21pc2UiLCJQcm9taXNlIiwicmFjZSIsInByb2Nlc3NNZXNzYWdlIiwibmFtZSIsIl8iLCJyZWplY3QiLCJzZXRUaW1lb3V0Iiwic2VudGltZW50UmVzdWx0IiwiY2hhdFJlc3BvbnNlIiwiYWxsIiwiY2F0Y2giLCJzZW50aW1lbnQiLCJlbW90aW9ucyIsInByaW1hcnkiLCJjb25maWRlbmNlIiwiZW1vdGlvbmFsU3RhdGUiLCJyZWNvbW1lbmRhdGlvbnMiLCJnZXRRdWlja1JlY29tbWVuZGF0aW9ucyIsImNyaXNpc0tleXdvcmRzIiwibG93ZXJUZXh0IiwidG9Mb3dlckNhc2UiLCJzb21lIiwia2V5d29yZCIsImluY2x1ZGVzIiwidHlwZSIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJhY3Rpb25VcmwiLCJhY3Rpb25UZXh0Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./lib/local-ai-middleware.js\n");

/***/ }),

/***/ "(api-node)/./lib/services/pinata-conversation-service.js":
/*!*****************************************************!*\
  !*** ./lib/services/pinata-conversation-service.js ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   pinataConversationService: () => (/* binding */ pinataConversationService)\n/* harmony export */ });\n/* harmony import */ var _pinata_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./pinata-service */ \"(api-node)/./lib/services/pinata-service.js\");\n/* harmony import */ var _pinata_service__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_pinata_service__WEBPACK_IMPORTED_MODULE_0__);\n\n/**\r\n * Simple UUID generation function that doesn't require dependencies\r\n * @returns {string} - A unique ID\r\n */ function generateUniqueId() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n        const r = Math.random() * 16 | 0;\n        const v = c === 'x' ? r : r & 0x3 | 0x8;\n        return v.toString(16);\n    });\n}\n/**\r\n * Pinata-only Conversation Service\r\n * Handles storing and retrieving conversations only from Pinata IPFS, completely bypassing MongoDB\r\n */ class PinataConversationService {\n    /**\r\n   * Create a new conversation\r\n   * @param {string} userId - User ID\r\n   * @param {string} title - Conversation title\r\n   * @param {Array} messages - Initial messages\r\n   * @returns {Promise<object>} - Created conversation\r\n   */ async createConversation(userId, title, messages = []) {\n        try {\n            // Create conversation object with custom UUID instead of MongoDB ID\n            const conversation = {\n                _id: generateUniqueId(),\n                userId,\n                title: title || 'New Conversation',\n                createdAt: new Date(),\n                updatedAt: new Date(),\n                messages: Array.isArray(messages) ? messages : [],\n                type: 'conversation'\n            };\n            // Store directly to Pinata\n            const pinataResponse = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.storeData(`conversation_${userId}`, conversation, {\n                conversationId: conversation._id\n            });\n            conversation.ipfsHash = pinataResponse.IpfsHash;\n            console.log(`Conversation created in Pinata with hash: ${pinataResponse.IpfsHash}`);\n            return conversation;\n        } catch (error) {\n            console.error('Error in createConversation:', error);\n            throw error;\n        }\n    }\n    /**\r\n   * Add a message to an existing conversation\r\n   * @param {string} conversationId - Conversation ID\r\n   * @param {string} userId - User ID\r\n   * @param {object} message - Message to add\r\n   * @returns {Promise<object>} - Updated conversation\r\n   */ async addMessage(conversationId, userId, message) {\n        try {\n            if (!conversationId || !userId || !message) {\n                throw new Error('Missing required parameters');\n            }\n            // Get all user's pins\n            const pins = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.getHistory(userId);\n            const conversationPin = pins.find((pin)=>{\n                const metadata = pin.metadata?.keyvalues;\n                return metadata?.type === 'conversation' && metadata?.conversationId === conversationId;\n            });\n            if (!conversationPin) {\n                throw new Error(`Conversation ${conversationId} not found for user ${userId}`);\n            }\n            // Get the conversation data\n            const data = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.getData(conversationPin.ipfs_pin_hash);\n            if (!data) {\n                throw new Error(`Failed to retrieve conversation data from Pinata`);\n            }\n            // Add the message to the existing conversation\n            const updatedMessages = [\n                ...data.messages || [],\n                message\n            ];\n            data.messages = updatedMessages;\n            data.updatedAt = new Date();\n            // Store the updated data\n            const pinataResponse = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.storeData(`conversation_${userId}`, {\n                ...data,\n                type: 'conversation',\n                userId\n            }, {\n                conversationId\n            });\n            // Remove the old pin\n            await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.removeData(conversationPin.ipfs_pin_hash);\n            console.log(`Added message to conversation ${conversationId} in Pinata`);\n            data.ipfsHash = pinataResponse.IpfsHash;\n            return data;\n        } catch (error) {\n            console.error('Error in addMessage:', error);\n            throw error;\n        }\n    }\n    /**\r\n   * Get a conversation by ID\r\n   * @param {string} conversationId - Conversation ID\r\n   * @param {string} userId - User ID\r\n   * @returns {Promise<object>} - Retrieved conversation\r\n   */ async getConversation(conversationId, userId) {\n        try {\n            if (!conversationId || !userId) {\n                throw new Error('Missing required parameters');\n            }\n            // Get user's pins from Pinata\n            const pins = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.getHistory(userId);\n            const conversationPin = pins.find((pin)=>{\n                const metadata = pin.metadata?.keyvalues;\n                return metadata?.type === 'conversation' && metadata?.conversationId === conversationId;\n            });\n            if (!conversationPin) {\n                throw new Error(`Conversation ${conversationId} not found for user ${userId}`);\n            }\n            // Get the conversation data\n            const data = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.getData(conversationPin.ipfs_pin_hash);\n            if (!data) {\n                throw new Error(`Failed to retrieve conversation data from Pinata`);\n            }\n            console.log(`Retrieved conversation ${conversationId} from Pinata`);\n            data.ipfsHash = conversationPin.ipfs_pin_hash;\n            return data;\n        } catch (error) {\n            console.error('Error in getConversation:', error);\n            throw error;\n        }\n    }\n    /**\r\n   * Get all conversations for a user\r\n   * @param {string} userId - User ID\r\n   * @returns {Promise<Array>} - Array of conversations\r\n   */ async getUserConversations(userId) {\n        try {\n            if (!userId) {\n                throw new Error('Missing required parameter: userId');\n            }\n            // Get all pins for the user\n            const pins = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.getHistory(userId);\n            // Filter for conversation pins\n            const conversationPins = pins.filter((pin)=>{\n                const metadata = pin.metadata?.keyvalues;\n                return metadata?.type === 'conversation';\n            });\n            // Get the data for each conversation\n            const conversations = [];\n            for (const pin of conversationPins){\n                try {\n                    const data = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.getData(pin.ipfs_pin_hash);\n                    if (data) {\n                        data.ipfsHash = pin.ipfs_pin_hash;\n                        conversations.push(data);\n                    }\n                } catch (error) {\n                    console.error(`Failed to get data for pin ${pin.ipfs_pin_hash}:`, error);\n                }\n            }\n            console.log(`Retrieved ${conversations.length} conversations from Pinata for user ${userId}`);\n            return conversations;\n        } catch (error) {\n            console.error('Error in getUserConversations:', error);\n            return [];\n        }\n    }\n    /**\r\n   * Delete a conversation\r\n   * @param {string} conversationId - Conversation ID\r\n   * @param {string} userId - User ID\r\n   * @returns {Promise<boolean>} - Whether the deletion was successful\r\n   */ async deleteConversation(conversationId, userId) {\n        try {\n            if (!conversationId || !userId) {\n                throw new Error('Missing required parameters');\n            }\n            // Get all pins for the user\n            const pins = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.getHistory(userId);\n            const conversationPin = pins.find((pin)=>{\n                const metadata = pin.metadata?.keyvalues;\n                return metadata?.type === 'conversation' && metadata?.conversationId === conversationId;\n            });\n            if (!conversationPin) {\n                console.warn(`Conversation ${conversationId} not found for user ${userId}`);\n                return false;\n            }\n            // Remove the pin\n            const result = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.removeData(conversationPin.ipfs_pin_hash);\n            console.log(`Deleted conversation ${conversationId} from Pinata`);\n            return result.success;\n        } catch (error) {\n            console.error('Error in deleteConversation:', error);\n            return false;\n        }\n    }\n    /**\r\n   * Update conversation title\r\n   * @param {string} conversationId - Conversation ID\r\n   * @param {string} userId - User ID\r\n   * @param {string} newTitle - New title\r\n   * @returns {Promise<object>} - Updated conversation\r\n   */ async updateConversationTitle(conversationId, userId, newTitle) {\n        try {\n            if (!conversationId || !userId || !newTitle) {\n                throw new Error('Missing required parameters');\n            }\n            // Get all pins for the user\n            const pins = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.getHistory(userId);\n            const conversationPin = pins.find((pin)=>{\n                const metadata = pin.metadata?.keyvalues;\n                return metadata?.type === 'conversation' && metadata?.conversationId === conversationId;\n            });\n            if (!conversationPin) {\n                throw new Error(`Conversation ${conversationId} not found for user ${userId}`);\n            }\n            // Get the conversation data\n            const data = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.getData(conversationPin.ipfs_pin_hash);\n            if (!data) {\n                throw new Error(`Failed to retrieve conversation data from Pinata`);\n            }\n            // Update the title\n            data.title = newTitle;\n            data.updatedAt = new Date();\n            // Store the updated data\n            const pinataResponse = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.storeData(`conversation_${userId}`, {\n                ...data,\n                type: 'conversation',\n                userId\n            }, {\n                conversationId\n            });\n            // Remove the old pin\n            await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.removeData(conversationPin.ipfs_pin_hash);\n            console.log(`Updated title for conversation ${conversationId} in Pinata`);\n            data.ipfsHash = pinataResponse.IpfsHash;\n            return data;\n        } catch (error) {\n            console.error('Error in updateConversationTitle:', error);\n            throw error;\n        }\n    }\n    /**\r\n   * Delete all conversations for a user\r\n   * @param {string} userId - User ID\r\n   * @returns {Promise<boolean>} - Whether the deletion was successful\r\n   */ async deleteAllUserConversations(userId) {\n        try {\n            if (!userId) {\n                throw new Error('Missing required parameter: userId');\n            }\n            // Get all pins for the user\n            const pins = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.getHistory(userId);\n            // Filter for conversation pins\n            const conversationPins = pins.filter((pin)=>{\n                const metadata = pin.metadata?.keyvalues;\n                return metadata?.type === 'conversation';\n            });\n            // Delete each conversation\n            let success = true;\n            for (const pin of conversationPins){\n                try {\n                    const result = await _pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.removeData(pin.ipfs_pin_hash);\n                    if (!result.success) {\n                        success = false;\n                    }\n                } catch (error) {\n                    console.error(`Failed to delete pin ${pin.ipfs_pin_hash}:`, error);\n                    success = false;\n                }\n            }\n            console.log(`Deleted ${conversationPins.length} conversations from Pinata for user ${userId}`);\n            return success;\n        } catch (error) {\n            console.error('Error in deleteAllUserConversations:', error);\n            return false;\n        }\n    }\n}\nconst pinataConversationService = new PinataConversationService();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9zZXJ2aWNlcy9waW5hdGEtY29udmVyc2F0aW9uLXNlcnZpY2UuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQWlEO0FBRWpEOzs7Q0FHQyxHQUNELFNBQVNDO0lBQ1AsT0FBTyx1Q0FBdUNDLE9BQU8sQ0FBQyxTQUFTLFNBQVNDLENBQUM7UUFDdkUsTUFBTUMsSUFBSUMsS0FBS0MsTUFBTSxLQUFLLEtBQUs7UUFDL0IsTUFBTUMsSUFBSUosTUFBTSxNQUFNQyxJQUFLQSxJQUFJLE1BQU07UUFDckMsT0FBT0csRUFBRUMsUUFBUSxDQUFDO0lBQ3BCO0FBQ0Y7QUFFQTs7O0NBR0MsR0FDRCxNQUFNQztJQUNKOzs7Ozs7R0FNQyxHQUNELE1BQU1DLG1CQUFtQkMsTUFBTSxFQUFFQyxLQUFLLEVBQUVDLFdBQVcsRUFBRSxFQUFFO1FBQ3JELElBQUk7WUFDRixvRUFBb0U7WUFDcEUsTUFBTUMsZUFBZTtnQkFDbkJDLEtBQUtkO2dCQUNMVTtnQkFDQUMsT0FBT0EsU0FBUztnQkFDaEJJLFdBQVcsSUFBSUM7Z0JBQ2ZDLFdBQVcsSUFBSUQ7Z0JBQ2ZKLFVBQVVNLE1BQU1DLE9BQU8sQ0FBQ1AsWUFBWUEsV0FBVyxFQUFFO2dCQUNqRFEsTUFBTTtZQUNSO1lBRUEsMkJBQTJCO1lBQzNCLE1BQU1DLGlCQUFpQixNQUFNdEIsMERBQWFBLENBQUN1QixTQUFTLENBQ2xELENBQUMsYUFBYSxFQUFFWixRQUFRLEVBQ3hCRyxjQUNBO2dCQUFFVSxnQkFBZ0JWLGFBQWFDLEdBQUc7WUFBQztZQUdyQ0QsYUFBYVcsUUFBUSxHQUFHSCxlQUFlSSxRQUFRO1lBQy9DQyxRQUFRQyxHQUFHLENBQUMsQ0FBQywwQ0FBMEMsRUFBRU4sZUFBZUksUUFBUSxFQUFFO1lBQ2xGLE9BQU9aO1FBQ1QsRUFBRSxPQUFPZSxPQUFPO1lBQ2RGLFFBQVFFLEtBQUssQ0FBQyxnQ0FBZ0NBO1lBQzlDLE1BQU1BO1FBQ1I7SUFDRjtJQUVBOzs7Ozs7R0FNQyxHQUNELE1BQU1DLFdBQVdOLGNBQWMsRUFBRWIsTUFBTSxFQUFFb0IsT0FBTyxFQUFFO1FBQ2hELElBQUk7WUFDRixJQUFJLENBQUNQLGtCQUFrQixDQUFDYixVQUFVLENBQUNvQixTQUFTO2dCQUMxQyxNQUFNLElBQUlDLE1BQU07WUFDbEI7WUFFQSxzQkFBc0I7WUFDdEIsTUFBTUMsT0FBTyxNQUFNakMsMERBQWFBLENBQUNrQyxVQUFVLENBQUN2QjtZQUM1QyxNQUFNd0Isa0JBQWtCRixLQUFLRyxJQUFJLENBQUNDLENBQUFBO2dCQUNoQyxNQUFNQyxXQUFXRCxJQUFJQyxRQUFRLEVBQUVDO2dCQUMvQixPQUFPRCxVQUFVakIsU0FBUyxrQkFDbkJpQixVQUFVZCxtQkFBbUJBO1lBQ3RDO1lBRUEsSUFBSSxDQUFDVyxpQkFBaUI7Z0JBQ3BCLE1BQU0sSUFBSUgsTUFBTSxDQUFDLGFBQWEsRUFBRVIsZUFBZSxvQkFBb0IsRUFBRWIsUUFBUTtZQUMvRTtZQUVBLDRCQUE0QjtZQUM1QixNQUFNNkIsT0FBTyxNQUFNeEMsMERBQWFBLENBQUN5QyxPQUFPLENBQUNOLGdCQUFnQk8sYUFBYTtZQUN0RSxJQUFJLENBQUNGLE1BQU07Z0JBQ1QsTUFBTSxJQUFJUixNQUFNLENBQUMsZ0RBQWdELENBQUM7WUFDcEU7WUFFQSwrQ0FBK0M7WUFDL0MsTUFBTVcsa0JBQWtCO21CQUFLSCxLQUFLM0IsUUFBUSxJQUFJLEVBQUU7Z0JBQUdrQjthQUFRO1lBQzNEUyxLQUFLM0IsUUFBUSxHQUFHOEI7WUFDaEJILEtBQUt0QixTQUFTLEdBQUcsSUFBSUQ7WUFFckIseUJBQXlCO1lBQ3pCLE1BQU1LLGlCQUFpQixNQUFNdEIsMERBQWFBLENBQUN1QixTQUFTLENBQ2xELENBQUMsYUFBYSxFQUFFWixRQUFRLEVBQ3hCO2dCQUNFLEdBQUc2QixJQUFJO2dCQUNQbkIsTUFBTTtnQkFDTlY7WUFDRixHQUNBO2dCQUFFYTtZQUFlO1lBR25CLHFCQUFxQjtZQUNyQixNQUFNeEIsMERBQWFBLENBQUM0QyxVQUFVLENBQUNULGdCQUFnQk8sYUFBYTtZQUU1RGYsUUFBUUMsR0FBRyxDQUFDLENBQUMsOEJBQThCLEVBQUVKLGVBQWUsVUFBVSxDQUFDO1lBQ3ZFZ0IsS0FBS2YsUUFBUSxHQUFHSCxlQUFlSSxRQUFRO1lBQ3ZDLE9BQU9jO1FBQ1QsRUFBRSxPQUFPWCxPQUFPO1lBQ2RGLFFBQVFFLEtBQUssQ0FBQyx3QkFBd0JBO1lBQ3RDLE1BQU1BO1FBQ1I7SUFDRjtJQUVBOzs7OztHQUtDLEdBQ0QsTUFBTWdCLGdCQUFnQnJCLGNBQWMsRUFBRWIsTUFBTSxFQUFFO1FBQzVDLElBQUk7WUFDRixJQUFJLENBQUNhLGtCQUFrQixDQUFDYixRQUFRO2dCQUM5QixNQUFNLElBQUlxQixNQUFNO1lBQ2xCO1lBRUEsOEJBQThCO1lBQzlCLE1BQU1DLE9BQU8sTUFBTWpDLDBEQUFhQSxDQUFDa0MsVUFBVSxDQUFDdkI7WUFDNUMsTUFBTXdCLGtCQUFrQkYsS0FBS0csSUFBSSxDQUFDQyxDQUFBQTtnQkFDaEMsTUFBTUMsV0FBV0QsSUFBSUMsUUFBUSxFQUFFQztnQkFDL0IsT0FBT0QsVUFBVWpCLFNBQVMsa0JBQ25CaUIsVUFBVWQsbUJBQW1CQTtZQUN0QztZQUVBLElBQUksQ0FBQ1csaUJBQWlCO2dCQUNwQixNQUFNLElBQUlILE1BQU0sQ0FBQyxhQUFhLEVBQUVSLGVBQWUsb0JBQW9CLEVBQUViLFFBQVE7WUFDL0U7WUFFQSw0QkFBNEI7WUFDNUIsTUFBTTZCLE9BQU8sTUFBTXhDLDBEQUFhQSxDQUFDeUMsT0FBTyxDQUFDTixnQkFBZ0JPLGFBQWE7WUFDdEUsSUFBSSxDQUFDRixNQUFNO2dCQUNULE1BQU0sSUFBSVIsTUFBTSxDQUFDLGdEQUFnRCxDQUFDO1lBQ3BFO1lBRUFMLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLHVCQUF1QixFQUFFSixlQUFlLFlBQVksQ0FBQztZQUNsRWdCLEtBQUtmLFFBQVEsR0FBR1UsZ0JBQWdCTyxhQUFhO1lBQzdDLE9BQU9GO1FBQ1QsRUFBRSxPQUFPWCxPQUFPO1lBQ2RGLFFBQVFFLEtBQUssQ0FBQyw2QkFBNkJBO1lBQzNDLE1BQU1BO1FBQ1I7SUFDRjtJQUVBOzs7O0dBSUMsR0FDRCxNQUFNaUIscUJBQXFCbkMsTUFBTSxFQUFFO1FBQ2pDLElBQUk7WUFDRixJQUFJLENBQUNBLFFBQVE7Z0JBQ1gsTUFBTSxJQUFJcUIsTUFBTTtZQUNsQjtZQUVBLDRCQUE0QjtZQUM1QixNQUFNQyxPQUFPLE1BQU1qQywwREFBYUEsQ0FBQ2tDLFVBQVUsQ0FBQ3ZCO1lBRTVDLCtCQUErQjtZQUMvQixNQUFNb0MsbUJBQW1CZCxLQUFLZSxNQUFNLENBQUNYLENBQUFBO2dCQUNuQyxNQUFNQyxXQUFXRCxJQUFJQyxRQUFRLEVBQUVDO2dCQUMvQixPQUFPRCxVQUFVakIsU0FBUztZQUM1QjtZQUVBLHFDQUFxQztZQUNyQyxNQUFNNEIsZ0JBQWdCLEVBQUU7WUFDeEIsS0FBSyxNQUFNWixPQUFPVSxpQkFBa0I7Z0JBQ2xDLElBQUk7b0JBQ0YsTUFBTVAsT0FBTyxNQUFNeEMsMERBQWFBLENBQUN5QyxPQUFPLENBQUNKLElBQUlLLGFBQWE7b0JBQzFELElBQUlGLE1BQU07d0JBQ1JBLEtBQUtmLFFBQVEsR0FBR1ksSUFBSUssYUFBYTt3QkFDakNPLGNBQWNDLElBQUksQ0FBQ1Y7b0JBQ3JCO2dCQUNGLEVBQUUsT0FBT1gsT0FBTztvQkFDZEYsUUFBUUUsS0FBSyxDQUFDLENBQUMsMkJBQTJCLEVBQUVRLElBQUlLLGFBQWEsQ0FBQyxDQUFDLENBQUMsRUFBRWI7Z0JBQ3BFO1lBQ0Y7WUFFQUYsUUFBUUMsR0FBRyxDQUFDLENBQUMsVUFBVSxFQUFFcUIsY0FBY0UsTUFBTSxDQUFDLG9DQUFvQyxFQUFFeEMsUUFBUTtZQUM1RixPQUFPc0M7UUFDVCxFQUFFLE9BQU9wQixPQUFPO1lBQ2RGLFFBQVFFLEtBQUssQ0FBQyxrQ0FBa0NBO1lBQ2hELE9BQU8sRUFBRTtRQUNYO0lBQ0Y7SUFFQTs7Ozs7R0FLQyxHQUNELE1BQU11QixtQkFBbUI1QixjQUFjLEVBQUViLE1BQU0sRUFBRTtRQUMvQyxJQUFJO1lBQ0YsSUFBSSxDQUFDYSxrQkFBa0IsQ0FBQ2IsUUFBUTtnQkFDOUIsTUFBTSxJQUFJcUIsTUFBTTtZQUNsQjtZQUVBLDRCQUE0QjtZQUM1QixNQUFNQyxPQUFPLE1BQU1qQywwREFBYUEsQ0FBQ2tDLFVBQVUsQ0FBQ3ZCO1lBQzVDLE1BQU13QixrQkFBa0JGLEtBQUtHLElBQUksQ0FBQ0MsQ0FBQUE7Z0JBQ2hDLE1BQU1DLFdBQVdELElBQUlDLFFBQVEsRUFBRUM7Z0JBQy9CLE9BQU9ELFVBQVVqQixTQUFTLGtCQUNuQmlCLFVBQVVkLG1CQUFtQkE7WUFDdEM7WUFFQSxJQUFJLENBQUNXLGlCQUFpQjtnQkFDcEJSLFFBQVEwQixJQUFJLENBQUMsQ0FBQyxhQUFhLEVBQUU3QixlQUFlLG9CQUFvQixFQUFFYixRQUFRO2dCQUMxRSxPQUFPO1lBQ1Q7WUFFQSxpQkFBaUI7WUFDakIsTUFBTTJDLFNBQVMsTUFBTXRELDBEQUFhQSxDQUFDNEMsVUFBVSxDQUFDVCxnQkFBZ0JPLGFBQWE7WUFFM0VmLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLHFCQUFxQixFQUFFSixlQUFlLFlBQVksQ0FBQztZQUNoRSxPQUFPOEIsT0FBT0MsT0FBTztRQUN2QixFQUFFLE9BQU8xQixPQUFPO1lBQ2RGLFFBQVFFLEtBQUssQ0FBQyxnQ0FBZ0NBO1lBQzlDLE9BQU87UUFDVDtJQUNGO0lBRUE7Ozs7OztHQU1DLEdBQ0QsTUFBTTJCLHdCQUF3QmhDLGNBQWMsRUFBRWIsTUFBTSxFQUFFOEMsUUFBUSxFQUFFO1FBQzlELElBQUk7WUFDRixJQUFJLENBQUNqQyxrQkFBa0IsQ0FBQ2IsVUFBVSxDQUFDOEMsVUFBVTtnQkFDM0MsTUFBTSxJQUFJekIsTUFBTTtZQUNsQjtZQUVBLDRCQUE0QjtZQUM1QixNQUFNQyxPQUFPLE1BQU1qQywwREFBYUEsQ0FBQ2tDLFVBQVUsQ0FBQ3ZCO1lBQzVDLE1BQU13QixrQkFBa0JGLEtBQUtHLElBQUksQ0FBQ0MsQ0FBQUE7Z0JBQ2hDLE1BQU1DLFdBQVdELElBQUlDLFFBQVEsRUFBRUM7Z0JBQy9CLE9BQU9ELFVBQVVqQixTQUFTLGtCQUNuQmlCLFVBQVVkLG1CQUFtQkE7WUFDdEM7WUFFQSxJQUFJLENBQUNXLGlCQUFpQjtnQkFDcEIsTUFBTSxJQUFJSCxNQUFNLENBQUMsYUFBYSxFQUFFUixlQUFlLG9CQUFvQixFQUFFYixRQUFRO1lBQy9FO1lBRUEsNEJBQTRCO1lBQzVCLE1BQU02QixPQUFPLE1BQU14QywwREFBYUEsQ0FBQ3lDLE9BQU8sQ0FBQ04sZ0JBQWdCTyxhQUFhO1lBQ3RFLElBQUksQ0FBQ0YsTUFBTTtnQkFDVCxNQUFNLElBQUlSLE1BQU0sQ0FBQyxnREFBZ0QsQ0FBQztZQUNwRTtZQUVBLG1CQUFtQjtZQUNuQlEsS0FBSzVCLEtBQUssR0FBRzZDO1lBQ2JqQixLQUFLdEIsU0FBUyxHQUFHLElBQUlEO1lBRXJCLHlCQUF5QjtZQUN6QixNQUFNSyxpQkFBaUIsTUFBTXRCLDBEQUFhQSxDQUFDdUIsU0FBUyxDQUNsRCxDQUFDLGFBQWEsRUFBRVosUUFBUSxFQUN4QjtnQkFDRSxHQUFHNkIsSUFBSTtnQkFDUG5CLE1BQU07Z0JBQ05WO1lBQ0YsR0FDQTtnQkFBRWE7WUFBZTtZQUduQixxQkFBcUI7WUFDckIsTUFBTXhCLDBEQUFhQSxDQUFDNEMsVUFBVSxDQUFDVCxnQkFBZ0JPLGFBQWE7WUFFNURmLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLCtCQUErQixFQUFFSixlQUFlLFVBQVUsQ0FBQztZQUN4RWdCLEtBQUtmLFFBQVEsR0FBR0gsZUFBZUksUUFBUTtZQUN2QyxPQUFPYztRQUNULEVBQUUsT0FBT1gsT0FBTztZQUNkRixRQUFRRSxLQUFLLENBQUMscUNBQXFDQTtZQUNuRCxNQUFNQTtRQUNSO0lBQ0Y7SUFFQTs7OztHQUlDLEdBQ0QsTUFBTTZCLDJCQUEyQi9DLE1BQU0sRUFBRTtRQUN2QyxJQUFJO1lBQ0YsSUFBSSxDQUFDQSxRQUFRO2dCQUNYLE1BQU0sSUFBSXFCLE1BQU07WUFDbEI7WUFFQSw0QkFBNEI7WUFDNUIsTUFBTUMsT0FBTyxNQUFNakMsMERBQWFBLENBQUNrQyxVQUFVLENBQUN2QjtZQUU1QywrQkFBK0I7WUFDL0IsTUFBTW9DLG1CQUFtQmQsS0FBS2UsTUFBTSxDQUFDWCxDQUFBQTtnQkFDbkMsTUFBTUMsV0FBV0QsSUFBSUMsUUFBUSxFQUFFQztnQkFDL0IsT0FBT0QsVUFBVWpCLFNBQVM7WUFDNUI7WUFFQSwyQkFBMkI7WUFDM0IsSUFBSWtDLFVBQVU7WUFDZCxLQUFLLE1BQU1sQixPQUFPVSxpQkFBa0I7Z0JBQ2xDLElBQUk7b0JBQ0YsTUFBTU8sU0FBUyxNQUFNdEQsMERBQWFBLENBQUM0QyxVQUFVLENBQUNQLElBQUlLLGFBQWE7b0JBQy9ELElBQUksQ0FBQ1ksT0FBT0MsT0FBTyxFQUFFO3dCQUNuQkEsVUFBVTtvQkFDWjtnQkFDRixFQUFFLE9BQU8xQixPQUFPO29CQUNkRixRQUFRRSxLQUFLLENBQUMsQ0FBQyxxQkFBcUIsRUFBRVEsSUFBSUssYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUFFYjtvQkFDNUQwQixVQUFVO2dCQUNaO1lBQ0Y7WUFFQTVCLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRW1CLGlCQUFpQkksTUFBTSxDQUFDLG9DQUFvQyxFQUFFeEMsUUFBUTtZQUM3RixPQUFPNEM7UUFDVCxFQUFFLE9BQU8xQixPQUFPO1lBQ2RGLFFBQVFFLEtBQUssQ0FBQyx3Q0FBd0NBO1lBQ3RELE9BQU87UUFDVDtJQUNGO0FBQ0Y7QUFFTyxNQUFNOEIsNEJBQTRCLElBQUlsRCw0QkFBNEIiLCJzb3VyY2VzIjpbIkQ6XFxQcm9qZWN0c1xcRGVraHRlIGhhaVxcbmV1cm9TeW5jXFxOZXVyb1N5bmMtQUktRnJvbnRlbmRcXGxpYlxcc2VydmljZXNcXHBpbmF0YS1jb252ZXJzYXRpb24tc2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwaW5hdGFTZXJ2aWNlIH0gZnJvbSAnLi9waW5hdGEtc2VydmljZSc7XHJcblxyXG4vKipcclxuICogU2ltcGxlIFVVSUQgZ2VuZXJhdGlvbiBmdW5jdGlvbiB0aGF0IGRvZXNuJ3QgcmVxdWlyZSBkZXBlbmRlbmNpZXNcclxuICogQHJldHVybnMge3N0cmluZ30gLSBBIHVuaXF1ZSBJRFxyXG4gKi9cclxuZnVuY3Rpb24gZ2VuZXJhdGVVbmlxdWVJZCgpIHtcclxuICByZXR1cm4gJ3h4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCcucmVwbGFjZSgvW3h5XS9nLCBmdW5jdGlvbihjKSB7XHJcbiAgICBjb25zdCByID0gTWF0aC5yYW5kb20oKSAqIDE2IHwgMDtcclxuICAgIGNvbnN0IHYgPSBjID09PSAneCcgPyByIDogKHIgJiAweDMgfCAweDgpO1xyXG4gICAgcmV0dXJuIHYudG9TdHJpbmcoMTYpO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogUGluYXRhLW9ubHkgQ29udmVyc2F0aW9uIFNlcnZpY2VcclxuICogSGFuZGxlcyBzdG9yaW5nIGFuZCByZXRyaWV2aW5nIGNvbnZlcnNhdGlvbnMgb25seSBmcm9tIFBpbmF0YSBJUEZTLCBjb21wbGV0ZWx5IGJ5cGFzc2luZyBNb25nb0RCXHJcbiAqL1xyXG5jbGFzcyBQaW5hdGFDb252ZXJzYXRpb25TZXJ2aWNlIHtcclxuICAvKipcclxuICAgKiBDcmVhdGUgYSBuZXcgY29udmVyc2F0aW9uXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gdGl0bGUgLSBDb252ZXJzYXRpb24gdGl0bGVcclxuICAgKiBAcGFyYW0ge0FycmF5fSBtZXNzYWdlcyAtIEluaXRpYWwgbWVzc2FnZXNcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxvYmplY3Q+fSAtIENyZWF0ZWQgY29udmVyc2F0aW9uXHJcbiAgICovXHJcbiAgYXN5bmMgY3JlYXRlQ29udmVyc2F0aW9uKHVzZXJJZCwgdGl0bGUsIG1lc3NhZ2VzID0gW10pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIENyZWF0ZSBjb252ZXJzYXRpb24gb2JqZWN0IHdpdGggY3VzdG9tIFVVSUQgaW5zdGVhZCBvZiBNb25nb0RCIElEXHJcbiAgICAgIGNvbnN0IGNvbnZlcnNhdGlvbiA9IHtcclxuICAgICAgICBfaWQ6IGdlbmVyYXRlVW5pcXVlSWQoKSwgLy8gR2VuZXJhdGUgYSB1bmlxdWUgSURcclxuICAgICAgICB1c2VySWQsXHJcbiAgICAgICAgdGl0bGU6IHRpdGxlIHx8ICdOZXcgQ29udmVyc2F0aW9uJyxcclxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgIG1lc3NhZ2VzOiBBcnJheS5pc0FycmF5KG1lc3NhZ2VzKSA/IG1lc3NhZ2VzIDogW10sXHJcbiAgICAgICAgdHlwZTogJ2NvbnZlcnNhdGlvbidcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIFN0b3JlIGRpcmVjdGx5IHRvIFBpbmF0YVxyXG4gICAgICBjb25zdCBwaW5hdGFSZXNwb25zZSA9IGF3YWl0IHBpbmF0YVNlcnZpY2Uuc3RvcmVEYXRhKFxyXG4gICAgICAgIGBjb252ZXJzYXRpb25fJHt1c2VySWR9YCxcclxuICAgICAgICBjb252ZXJzYXRpb24sXHJcbiAgICAgICAgeyBjb252ZXJzYXRpb25JZDogY29udmVyc2F0aW9uLl9pZCB9XHJcbiAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICBjb252ZXJzYXRpb24uaXBmc0hhc2ggPSBwaW5hdGFSZXNwb25zZS5JcGZzSGFzaDtcclxuICAgICAgY29uc29sZS5sb2coYENvbnZlcnNhdGlvbiBjcmVhdGVkIGluIFBpbmF0YSB3aXRoIGhhc2g6ICR7cGluYXRhUmVzcG9uc2UuSXBmc0hhc2h9YCk7XHJcbiAgICAgIHJldHVybiBjb252ZXJzYXRpb247XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBjcmVhdGVDb252ZXJzYXRpb246JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEFkZCBhIG1lc3NhZ2UgdG8gYW4gZXhpc3RpbmcgY29udmVyc2F0aW9uXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNvbnZlcnNhdGlvbklkIC0gQ29udmVyc2F0aW9uIElEXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcGFyYW0ge29iamVjdH0gbWVzc2FnZSAtIE1lc3NhZ2UgdG8gYWRkXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8b2JqZWN0Pn0gLSBVcGRhdGVkIGNvbnZlcnNhdGlvblxyXG4gICAqL1xyXG4gIGFzeW5jIGFkZE1lc3NhZ2UoY29udmVyc2F0aW9uSWQsIHVzZXJJZCwgbWVzc2FnZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCFjb252ZXJzYXRpb25JZCB8fCAhdXNlcklkIHx8ICFtZXNzYWdlKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIHJlcXVpcmVkIHBhcmFtZXRlcnMnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gR2V0IGFsbCB1c2VyJ3MgcGluc1xyXG4gICAgICBjb25zdCBwaW5zID0gYXdhaXQgcGluYXRhU2VydmljZS5nZXRIaXN0b3J5KHVzZXJJZCk7XHJcbiAgICAgIGNvbnN0IGNvbnZlcnNhdGlvblBpbiA9IHBpbnMuZmluZChwaW4gPT4ge1xyXG4gICAgICAgIGNvbnN0IG1ldGFkYXRhID0gcGluLm1ldGFkYXRhPy5rZXl2YWx1ZXM7XHJcbiAgICAgICAgcmV0dXJuIG1ldGFkYXRhPy50eXBlID09PSAnY29udmVyc2F0aW9uJyAmJiBcclxuICAgICAgICAgICAgICAgbWV0YWRhdGE/LmNvbnZlcnNhdGlvbklkID09PSBjb252ZXJzYXRpb25JZDtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoIWNvbnZlcnNhdGlvblBpbikge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ29udmVyc2F0aW9uICR7Y29udmVyc2F0aW9uSWR9IG5vdCBmb3VuZCBmb3IgdXNlciAke3VzZXJJZH1gKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gR2V0IHRoZSBjb252ZXJzYXRpb24gZGF0YVxyXG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcGluYXRhU2VydmljZS5nZXREYXRhKGNvbnZlcnNhdGlvblBpbi5pcGZzX3Bpbl9oYXNoKTtcclxuICAgICAgaWYgKCFkYXRhKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gcmV0cmlldmUgY29udmVyc2F0aW9uIGRhdGEgZnJvbSBQaW5hdGFgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQWRkIHRoZSBtZXNzYWdlIHRvIHRoZSBleGlzdGluZyBjb252ZXJzYXRpb25cclxuICAgICAgY29uc3QgdXBkYXRlZE1lc3NhZ2VzID0gWy4uLihkYXRhLm1lc3NhZ2VzIHx8IFtdKSwgbWVzc2FnZV07XHJcbiAgICAgIGRhdGEubWVzc2FnZXMgPSB1cGRhdGVkTWVzc2FnZXM7XHJcbiAgICAgIGRhdGEudXBkYXRlZEF0ID0gbmV3IERhdGUoKTtcclxuXHJcbiAgICAgIC8vIFN0b3JlIHRoZSB1cGRhdGVkIGRhdGFcclxuICAgICAgY29uc3QgcGluYXRhUmVzcG9uc2UgPSBhd2FpdCBwaW5hdGFTZXJ2aWNlLnN0b3JlRGF0YShcclxuICAgICAgICBgY29udmVyc2F0aW9uXyR7dXNlcklkfWAsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgLi4uZGF0YSxcclxuICAgICAgICAgIHR5cGU6ICdjb252ZXJzYXRpb24nLFxyXG4gICAgICAgICAgdXNlcklkXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7IGNvbnZlcnNhdGlvbklkIH1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIC8vIFJlbW92ZSB0aGUgb2xkIHBpblxyXG4gICAgICBhd2FpdCBwaW5hdGFTZXJ2aWNlLnJlbW92ZURhdGEoY29udmVyc2F0aW9uUGluLmlwZnNfcGluX2hhc2gpO1xyXG5cclxuICAgICAgY29uc29sZS5sb2coYEFkZGVkIG1lc3NhZ2UgdG8gY29udmVyc2F0aW9uICR7Y29udmVyc2F0aW9uSWR9IGluIFBpbmF0YWApO1xyXG4gICAgICBkYXRhLmlwZnNIYXNoID0gcGluYXRhUmVzcG9uc2UuSXBmc0hhc2g7XHJcbiAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gYWRkTWVzc2FnZTonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGEgY29udmVyc2F0aW9uIGJ5IElEXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNvbnZlcnNhdGlvbklkIC0gQ29udmVyc2F0aW9uIElEXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxvYmplY3Q+fSAtIFJldHJpZXZlZCBjb252ZXJzYXRpb25cclxuICAgKi9cclxuICBhc3luYyBnZXRDb252ZXJzYXRpb24oY29udmVyc2F0aW9uSWQsIHVzZXJJZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCFjb252ZXJzYXRpb25JZCB8fCAhdXNlcklkKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIHJlcXVpcmVkIHBhcmFtZXRlcnMnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gR2V0IHVzZXIncyBwaW5zIGZyb20gUGluYXRhXHJcbiAgICAgIGNvbnN0IHBpbnMgPSBhd2FpdCBwaW5hdGFTZXJ2aWNlLmdldEhpc3RvcnkodXNlcklkKTtcclxuICAgICAgY29uc3QgY29udmVyc2F0aW9uUGluID0gcGlucy5maW5kKHBpbiA9PiB7XHJcbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSBwaW4ubWV0YWRhdGE/LmtleXZhbHVlcztcclxuICAgICAgICByZXR1cm4gbWV0YWRhdGE/LnR5cGUgPT09ICdjb252ZXJzYXRpb24nICYmIFxyXG4gICAgICAgICAgICAgICBtZXRhZGF0YT8uY29udmVyc2F0aW9uSWQgPT09IGNvbnZlcnNhdGlvbklkO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmICghY29udmVyc2F0aW9uUGluKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb252ZXJzYXRpb24gJHtjb252ZXJzYXRpb25JZH0gbm90IGZvdW5kIGZvciB1c2VyICR7dXNlcklkfWApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBHZXQgdGhlIGNvbnZlcnNhdGlvbiBkYXRhXHJcbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBwaW5hdGFTZXJ2aWNlLmdldERhdGEoY29udmVyc2F0aW9uUGluLmlwZnNfcGluX2hhc2gpO1xyXG4gICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byByZXRyaWV2ZSBjb252ZXJzYXRpb24gZGF0YSBmcm9tIFBpbmF0YWApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zb2xlLmxvZyhgUmV0cmlldmVkIGNvbnZlcnNhdGlvbiAke2NvbnZlcnNhdGlvbklkfSBmcm9tIFBpbmF0YWApO1xyXG4gICAgICBkYXRhLmlwZnNIYXNoID0gY29udmVyc2F0aW9uUGluLmlwZnNfcGluX2hhc2g7XHJcbiAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gZ2V0Q29udmVyc2F0aW9uOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgYWxsIGNvbnZlcnNhdGlvbnMgZm9yIGEgdXNlclxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1c2VySWQgLSBVc2VyIElEXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8QXJyYXk+fSAtIEFycmF5IG9mIGNvbnZlcnNhdGlvbnNcclxuICAgKi9cclxuICBhc3luYyBnZXRVc2VyQ29udmVyc2F0aW9ucyh1c2VySWQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICghdXNlcklkKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIHJlcXVpcmVkIHBhcmFtZXRlcjogdXNlcklkJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEdldCBhbGwgcGlucyBmb3IgdGhlIHVzZXJcclxuICAgICAgY29uc3QgcGlucyA9IGF3YWl0IHBpbmF0YVNlcnZpY2UuZ2V0SGlzdG9yeSh1c2VySWQpO1xyXG4gICAgICBcclxuICAgICAgLy8gRmlsdGVyIGZvciBjb252ZXJzYXRpb24gcGluc1xyXG4gICAgICBjb25zdCBjb252ZXJzYXRpb25QaW5zID0gcGlucy5maWx0ZXIocGluID0+IHtcclxuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IHBpbi5tZXRhZGF0YT8ua2V5dmFsdWVzO1xyXG4gICAgICAgIHJldHVybiBtZXRhZGF0YT8udHlwZSA9PT0gJ2NvbnZlcnNhdGlvbic7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gR2V0IHRoZSBkYXRhIGZvciBlYWNoIGNvbnZlcnNhdGlvblxyXG4gICAgICBjb25zdCBjb252ZXJzYXRpb25zID0gW107XHJcbiAgICAgIGZvciAoY29uc3QgcGluIG9mIGNvbnZlcnNhdGlvblBpbnMpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHBpbmF0YVNlcnZpY2UuZ2V0RGF0YShwaW4uaXBmc19waW5faGFzaCk7XHJcbiAgICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgICBkYXRhLmlwZnNIYXNoID0gcGluLmlwZnNfcGluX2hhc2g7XHJcbiAgICAgICAgICAgIGNvbnZlcnNhdGlvbnMucHVzaChkYXRhKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGdldCBkYXRhIGZvciBwaW4gJHtwaW4uaXBmc19waW5faGFzaH06YCwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc29sZS5sb2coYFJldHJpZXZlZCAke2NvbnZlcnNhdGlvbnMubGVuZ3RofSBjb252ZXJzYXRpb25zIGZyb20gUGluYXRhIGZvciB1c2VyICR7dXNlcklkfWApO1xyXG4gICAgICByZXR1cm4gY29udmVyc2F0aW9ucztcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGdldFVzZXJDb252ZXJzYXRpb25zOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGVsZXRlIGEgY29udmVyc2F0aW9uXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNvbnZlcnNhdGlvbklkIC0gQ29udmVyc2F0aW9uIElEXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gLSBXaGV0aGVyIHRoZSBkZWxldGlvbiB3YXMgc3VjY2Vzc2Z1bFxyXG4gICAqL1xyXG4gIGFzeW5jIGRlbGV0ZUNvbnZlcnNhdGlvbihjb252ZXJzYXRpb25JZCwgdXNlcklkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAoIWNvbnZlcnNhdGlvbklkIHx8ICF1c2VySWQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgcmVxdWlyZWQgcGFyYW1ldGVycycpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBHZXQgYWxsIHBpbnMgZm9yIHRoZSB1c2VyXHJcbiAgICAgIGNvbnN0IHBpbnMgPSBhd2FpdCBwaW5hdGFTZXJ2aWNlLmdldEhpc3RvcnkodXNlcklkKTtcclxuICAgICAgY29uc3QgY29udmVyc2F0aW9uUGluID0gcGlucy5maW5kKHBpbiA9PiB7XHJcbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSBwaW4ubWV0YWRhdGE/LmtleXZhbHVlcztcclxuICAgICAgICByZXR1cm4gbWV0YWRhdGE/LnR5cGUgPT09ICdjb252ZXJzYXRpb24nICYmIFxyXG4gICAgICAgICAgICAgICBtZXRhZGF0YT8uY29udmVyc2F0aW9uSWQgPT09IGNvbnZlcnNhdGlvbklkO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmICghY29udmVyc2F0aW9uUGluKSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKGBDb252ZXJzYXRpb24gJHtjb252ZXJzYXRpb25JZH0gbm90IGZvdW5kIGZvciB1c2VyICR7dXNlcklkfWApO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gUmVtb3ZlIHRoZSBwaW5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcGluYXRhU2VydmljZS5yZW1vdmVEYXRhKGNvbnZlcnNhdGlvblBpbi5pcGZzX3Bpbl9oYXNoKTtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKGBEZWxldGVkIGNvbnZlcnNhdGlvbiAke2NvbnZlcnNhdGlvbklkfSBmcm9tIFBpbmF0YWApO1xyXG4gICAgICByZXR1cm4gcmVzdWx0LnN1Y2Nlc3M7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBkZWxldGVDb252ZXJzYXRpb246JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGUgY29udmVyc2F0aW9uIHRpdGxlXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNvbnZlcnNhdGlvbklkIC0gQ29udmVyc2F0aW9uIElEXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gbmV3VGl0bGUgLSBOZXcgdGl0bGVcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxvYmplY3Q+fSAtIFVwZGF0ZWQgY29udmVyc2F0aW9uXHJcbiAgICovXHJcbiAgYXN5bmMgdXBkYXRlQ29udmVyc2F0aW9uVGl0bGUoY29udmVyc2F0aW9uSWQsIHVzZXJJZCwgbmV3VGl0bGUpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICghY29udmVyc2F0aW9uSWQgfHwgIXVzZXJJZCB8fCAhbmV3VGl0bGUpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgcmVxdWlyZWQgcGFyYW1ldGVycycpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBHZXQgYWxsIHBpbnMgZm9yIHRoZSB1c2VyXHJcbiAgICAgIGNvbnN0IHBpbnMgPSBhd2FpdCBwaW5hdGFTZXJ2aWNlLmdldEhpc3RvcnkodXNlcklkKTtcclxuICAgICAgY29uc3QgY29udmVyc2F0aW9uUGluID0gcGlucy5maW5kKHBpbiA9PiB7XHJcbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSBwaW4ubWV0YWRhdGE/LmtleXZhbHVlcztcclxuICAgICAgICByZXR1cm4gbWV0YWRhdGE/LnR5cGUgPT09ICdjb252ZXJzYXRpb24nICYmIFxyXG4gICAgICAgICAgICAgICBtZXRhZGF0YT8uY29udmVyc2F0aW9uSWQgPT09IGNvbnZlcnNhdGlvbklkO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmICghY29udmVyc2F0aW9uUGluKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb252ZXJzYXRpb24gJHtjb252ZXJzYXRpb25JZH0gbm90IGZvdW5kIGZvciB1c2VyICR7dXNlcklkfWApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBHZXQgdGhlIGNvbnZlcnNhdGlvbiBkYXRhXHJcbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBwaW5hdGFTZXJ2aWNlLmdldERhdGEoY29udmVyc2F0aW9uUGluLmlwZnNfcGluX2hhc2gpO1xyXG4gICAgICBpZiAoIWRhdGEpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byByZXRyaWV2ZSBjb252ZXJzYXRpb24gZGF0YSBmcm9tIFBpbmF0YWApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBVcGRhdGUgdGhlIHRpdGxlXHJcbiAgICAgIGRhdGEudGl0bGUgPSBuZXdUaXRsZTtcclxuICAgICAgZGF0YS51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICAgICAgLy8gU3RvcmUgdGhlIHVwZGF0ZWQgZGF0YVxyXG4gICAgICBjb25zdCBwaW5hdGFSZXNwb25zZSA9IGF3YWl0IHBpbmF0YVNlcnZpY2Uuc3RvcmVEYXRhKFxyXG4gICAgICAgIGBjb252ZXJzYXRpb25fJHt1c2VySWR9YCxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAuLi5kYXRhLFxyXG4gICAgICAgICAgdHlwZTogJ2NvbnZlcnNhdGlvbicsXHJcbiAgICAgICAgICB1c2VySWRcclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgY29udmVyc2F0aW9uSWQgfVxyXG4gICAgICApO1xyXG5cclxuICAgICAgLy8gUmVtb3ZlIHRoZSBvbGQgcGluXHJcbiAgICAgIGF3YWl0IHBpbmF0YVNlcnZpY2UucmVtb3ZlRGF0YShjb252ZXJzYXRpb25QaW4uaXBmc19waW5faGFzaCk7XHJcblxyXG4gICAgICBjb25zb2xlLmxvZyhgVXBkYXRlZCB0aXRsZSBmb3IgY29udmVyc2F0aW9uICR7Y29udmVyc2F0aW9uSWR9IGluIFBpbmF0YWApO1xyXG4gICAgICBkYXRhLmlwZnNIYXNoID0gcGluYXRhUmVzcG9uc2UuSXBmc0hhc2g7XHJcbiAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gdXBkYXRlQ29udmVyc2F0aW9uVGl0bGU6JywgZXJyb3IpO1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERlbGV0ZSBhbGwgY29udmVyc2F0aW9ucyBmb3IgYSB1c2VyXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gLSBXaGV0aGVyIHRoZSBkZWxldGlvbiB3YXMgc3VjY2Vzc2Z1bFxyXG4gICAqL1xyXG4gIGFzeW5jIGRlbGV0ZUFsbFVzZXJDb252ZXJzYXRpb25zKHVzZXJJZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCF1c2VySWQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgcmVxdWlyZWQgcGFyYW1ldGVyOiB1c2VySWQnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gR2V0IGFsbCBwaW5zIGZvciB0aGUgdXNlclxyXG4gICAgICBjb25zdCBwaW5zID0gYXdhaXQgcGluYXRhU2VydmljZS5nZXRIaXN0b3J5KHVzZXJJZCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBGaWx0ZXIgZm9yIGNvbnZlcnNhdGlvbiBwaW5zXHJcbiAgICAgIGNvbnN0IGNvbnZlcnNhdGlvblBpbnMgPSBwaW5zLmZpbHRlcihwaW4gPT4ge1xyXG4gICAgICAgIGNvbnN0IG1ldGFkYXRhID0gcGluLm1ldGFkYXRhPy5rZXl2YWx1ZXM7XHJcbiAgICAgICAgcmV0dXJuIG1ldGFkYXRhPy50eXBlID09PSAnY29udmVyc2F0aW9uJztcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBEZWxldGUgZWFjaCBjb252ZXJzYXRpb25cclxuICAgICAgbGV0IHN1Y2Nlc3MgPSB0cnVlO1xyXG4gICAgICBmb3IgKGNvbnN0IHBpbiBvZiBjb252ZXJzYXRpb25QaW5zKSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBpbmF0YVNlcnZpY2UucmVtb3ZlRGF0YShwaW4uaXBmc19waW5faGFzaCk7XHJcbiAgICAgICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3MgPSBmYWxzZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGRlbGV0ZSBwaW4gJHtwaW4uaXBmc19waW5faGFzaH06YCwgZXJyb3IpO1xyXG4gICAgICAgICAgc3VjY2VzcyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc29sZS5sb2coYERlbGV0ZWQgJHtjb252ZXJzYXRpb25QaW5zLmxlbmd0aH0gY29udmVyc2F0aW9ucyBmcm9tIFBpbmF0YSBmb3IgdXNlciAke3VzZXJJZH1gKTtcclxuICAgICAgcmV0dXJuIHN1Y2Nlc3M7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBkZWxldGVBbGxVc2VyQ29udmVyc2F0aW9uczonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBwaW5hdGFDb252ZXJzYXRpb25TZXJ2aWNlID0gbmV3IFBpbmF0YUNvbnZlcnNhdGlvblNlcnZpY2UoKTsgIl0sIm5hbWVzIjpbInBpbmF0YVNlcnZpY2UiLCJnZW5lcmF0ZVVuaXF1ZUlkIiwicmVwbGFjZSIsImMiLCJyIiwiTWF0aCIsInJhbmRvbSIsInYiLCJ0b1N0cmluZyIsIlBpbmF0YUNvbnZlcnNhdGlvblNlcnZpY2UiLCJjcmVhdGVDb252ZXJzYXRpb24iLCJ1c2VySWQiLCJ0aXRsZSIsIm1lc3NhZ2VzIiwiY29udmVyc2F0aW9uIiwiX2lkIiwiY3JlYXRlZEF0IiwiRGF0ZSIsInVwZGF0ZWRBdCIsIkFycmF5IiwiaXNBcnJheSIsInR5cGUiLCJwaW5hdGFSZXNwb25zZSIsInN0b3JlRGF0YSIsImNvbnZlcnNhdGlvbklkIiwiaXBmc0hhc2giLCJJcGZzSGFzaCIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsImFkZE1lc3NhZ2UiLCJtZXNzYWdlIiwiRXJyb3IiLCJwaW5zIiwiZ2V0SGlzdG9yeSIsImNvbnZlcnNhdGlvblBpbiIsImZpbmQiLCJwaW4iLCJtZXRhZGF0YSIsImtleXZhbHVlcyIsImRhdGEiLCJnZXREYXRhIiwiaXBmc19waW5faGFzaCIsInVwZGF0ZWRNZXNzYWdlcyIsInJlbW92ZURhdGEiLCJnZXRDb252ZXJzYXRpb24iLCJnZXRVc2VyQ29udmVyc2F0aW9ucyIsImNvbnZlcnNhdGlvblBpbnMiLCJmaWx0ZXIiLCJjb252ZXJzYXRpb25zIiwicHVzaCIsImxlbmd0aCIsImRlbGV0ZUNvbnZlcnNhdGlvbiIsIndhcm4iLCJyZXN1bHQiLCJzdWNjZXNzIiwidXBkYXRlQ29udmVyc2F0aW9uVGl0bGUiLCJuZXdUaXRsZSIsImRlbGV0ZUFsbFVzZXJDb252ZXJzYXRpb25zIiwicGluYXRhQ29udmVyc2F0aW9uU2VydmljZSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/services/pinata-conversation-service.js\n");

/***/ }),

/***/ "(api-node)/./lib/services/pinata-service.js":
/*!****************************************!*\
  !*** ./lib/services/pinata-service.js ***!
  \****************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("\nconst axios = __webpack_require__(/*! axios */ \"axios?6fac\");\n/**\r\n * Pinata IPFS Service\r\n * Handles storing and retrieving data from Pinata IPFS\r\n */ class PinataService {\n    constructor(){\n        this.apiKey = process.env.PINATA_API_KEY;\n        this.apiSecret = process.env.PINATA_API_SECRET;\n        this.jwt = process.env.PINATA_JWT;\n        this.apiUrl = 'https://api.pinata.cloud';\n        this.gateway = 'https://gateway.pinata.cloud/ipfs/';\n    }\n    /**\r\n   * Check if the Pinata credentials are configured\r\n   */ isConfigured() {\n        return !!(this.jwt || this.apiKey && this.apiSecret);\n    }\n    /**\r\n   * Get the headers for Pinata API requests\r\n   */ getHeaders() {\n        if (this.jwt) {\n            return {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${this.jwt}`\n            };\n        } else if (this.apiKey && this.apiSecret) {\n            return {\n                'Content-Type': 'application/json',\n                'pinata_api_key': this.apiKey,\n                'pinata_secret_api_key': this.apiSecret\n            };\n        } else {\n            throw new Error('Pinata credentials not configured');\n        }\n    }\n    /**\r\n   * Store data on Pinata IPFS\r\n   * @param {string} keyName - Unique key for the data\r\n   * @param {object} data - Data to store\r\n   * @param {object} metadata - Optional metadata for the pin\r\n   * @returns {Promise<object>} - Response from Pinata\r\n   */ async storeData(keyName, data, metadata = {}) {\n        try {\n            if (!this.isConfigured()) {\n                throw new Error('Pinata credentials not configured');\n            }\n            // Generate a unique identifier for the transaction\n            const uniqueId = `${keyName}_${Date.now()}`;\n            // Prepare the data for Pinata\n            const pinataBody = {\n                pinataContent: data,\n                pinataMetadata: {\n                    name: uniqueId,\n                    keyvalues: {\n                        userId: data.userId || 'anonymous',\n                        type: data.type || 'conversation',\n                        timestamp: Date.now(),\n                        ...metadata\n                    }\n                }\n            };\n            // Upload to Pinata\n            const response = await axios.post(`${this.apiUrl}/pinning/pinJSONToIPFS`, pinataBody, {\n                headers: this.getHeaders()\n            });\n            return response.data;\n        } catch (error) {\n            console.error('Failed to store data on Pinata:', error?.response?.data || error?.message || error);\n            throw error;\n        }\n    }\n    /**\r\n   * Get data from Pinata IPFS\r\n   * @param {string} ipfsHash - IPFS hash to retrieve\r\n   * @returns {Promise<object>} - Retrieved data\r\n   */ async getData(ipfsHash) {\n        try {\n            if (!ipfsHash) {\n                throw new Error('IPFS hash is required');\n            }\n            // Fetch data from Pinata Gateway\n            const response = await axios.get(`${this.gateway}${ipfsHash}`);\n            return response.data;\n        } catch (error) {\n            console.error(`Failed to get data from Pinata (${ipfsHash}):`, error?.message || error);\n            return null;\n        }\n    }\n    /**\r\n   * Get history of pins for a user\r\n   * @param {string} userId - User ID to get history for\r\n   * @returns {Promise<Array>} - Array of pins\r\n   */ async getHistory(userId) {\n        try {\n            if (!this.isConfigured()) {\n                throw new Error('Pinata credentials not configured');\n            }\n            if (!userId) {\n                return [];\n            }\n            // Query Pinata for pins with the user's ID\n            const response = await axios.get(`${this.apiUrl}/data/pinList?metadata[keyvalues][userId]={\"value\":\"${userId}\",\"op\":\"eq\"}&status=pinned`, {\n                headers: this.getHeaders()\n            });\n            return response.data.rows || [];\n        } catch (error) {\n            console.error(`Failed to get history from Pinata for user ${userId}:`, error?.response?.data || error?.message || error);\n            return [];\n        }\n    }\n    /**\r\n   * Remove data from Pinata IPFS\r\n   * @param {string} ipfsHash - IPFS hash to remove\r\n   * @returns {Promise<object>} - Response from Pinata\r\n   */ async removeData(ipfsHash) {\n        try {\n            if (!this.isConfigured()) {\n                throw new Error('Pinata credentials not configured');\n            }\n            if (!ipfsHash) {\n                throw new Error('IPFS hash is required');\n            }\n            // Unpin from Pinata\n            const response = await axios.delete(`${this.apiUrl}/pinning/unpin/${ipfsHash}`, {\n                headers: this.getHeaders()\n            });\n            return {\n                success: true,\n                data: response.data\n            };\n        } catch (error) {\n            console.error(`Failed to remove data from Pinata (${ipfsHash}):`, error?.response?.data || error?.message || error);\n            // Handle common Pinata error cases: \n            // 1. 404 - Pin doesn't exist\n            // 2. 400 with \"CURRENT_USER_HAS_NOT_PINNED_CID\" - User doesn't have permission to unpin\n            if (error?.response?.status === 404 || error?.response?.status === 400 && error?.response?.data?.error?.reason === 'CURRENT_USER_HAS_NOT_PINNED_CID') {\n                console.log(`Pin ${ipfsHash} not found or not owned by current user. Considering it removed.`);\n                return {\n                    success: true,\n                    message: 'Pin not found or not owned by current user'\n                };\n            }\n            throw error;\n        }\n    }\n    /**\r\n   * Test the Pinata connection\r\n   * @returns {Promise<boolean>} - Whether the connection was successful\r\n   */ async testConnection() {\n        try {\n            if (!this.isConfigured()) {\n                return false;\n            }\n            // Test the connection by getting the pin count\n            await axios.get(`${this.apiUrl}/data/userPinnedDataTotal`, {\n                headers: this.getHeaders()\n            });\n            return true;\n        } catch (error) {\n            console.error('Pinata connection test failed:', error?.response?.data || error?.message || error);\n            return false;\n        }\n    }\n    /**\r\n   * Get all pins from Pinata regardless of user ID\r\n   * @returns {Promise<Array>} - Array of pins\r\n   */ async getAllPins() {\n        try {\n            if (!this.isConfigured()) {\n                throw new Error('Pinata credentials not configured');\n            }\n            // Query Pinata for all pins\n            const response = await axios.get(`${this.apiUrl}/data/pinList?status=pinned`, {\n                headers: this.getHeaders()\n            });\n            return response.data.rows || [];\n        } catch (error) {\n            console.error(`Failed to get all pins from Pinata:`, error?.response?.data || error?.message || error);\n            return [];\n        }\n    }\n}\nconst pinataService = new PinataService();\nmodule.exports = {\n    pinataService\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9zZXJ2aWNlcy9waW5hdGEtc2VydmljZS5qcyIsIm1hcHBpbmdzIjoiO0FBQUEsTUFBTUEsUUFBUUMsbUJBQU9BLENBQUMseUJBQU87QUFFN0I7OztDQUdDLEdBQ0QsTUFBTUM7SUFDSkMsYUFBYztRQUNaLElBQUksQ0FBQ0MsTUFBTSxHQUFHQyxRQUFRQyxHQUFHLENBQUNDLGNBQWM7UUFDeEMsSUFBSSxDQUFDQyxTQUFTLEdBQUdILFFBQVFDLEdBQUcsQ0FBQ0csaUJBQWlCO1FBQzlDLElBQUksQ0FBQ0MsR0FBRyxHQUFHTCxRQUFRQyxHQUFHLENBQUNLLFVBQVU7UUFDakMsSUFBSSxDQUFDQyxNQUFNLEdBQUc7UUFDZCxJQUFJLENBQUNDLE9BQU8sR0FBRztJQUNqQjtJQUVBOztHQUVDLEdBQ0RDLGVBQWU7UUFDYixPQUFPLENBQUMsQ0FBRSxLQUFJLENBQUNKLEdBQUcsSUFBSyxJQUFJLENBQUNOLE1BQU0sSUFBSSxJQUFJLENBQUNJLFNBQVM7SUFDdEQ7SUFFQTs7R0FFQyxHQUNETyxhQUFhO1FBQ1gsSUFBSSxJQUFJLENBQUNMLEdBQUcsRUFBRTtZQUNaLE9BQU87Z0JBQ0wsZ0JBQWdCO2dCQUNoQixpQkFBaUIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDQSxHQUFHLEVBQUU7WUFDdkM7UUFDRixPQUFPLElBQUksSUFBSSxDQUFDTixNQUFNLElBQUksSUFBSSxDQUFDSSxTQUFTLEVBQUU7WUFDeEMsT0FBTztnQkFDTCxnQkFBZ0I7Z0JBQ2hCLGtCQUFrQixJQUFJLENBQUNKLE1BQU07Z0JBQzdCLHlCQUF5QixJQUFJLENBQUNJLFNBQVM7WUFDekM7UUFDRixPQUFPO1lBQ0wsTUFBTSxJQUFJUSxNQUFNO1FBQ2xCO0lBQ0Y7SUFFQTs7Ozs7O0dBTUMsR0FDRCxNQUFNQyxVQUFVQyxPQUFPLEVBQUVDLElBQUksRUFBRUMsV0FBVyxDQUFDLENBQUMsRUFBRTtRQUM1QyxJQUFJO1lBQ0YsSUFBSSxDQUFDLElBQUksQ0FBQ04sWUFB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QUFVO1lBQUc7WUFHL0IsT0FBT2lCLFNBQVNiLElBQUksQ0FBQ3VCLElBQUksSUFBSSxFQUFFO1FBQ2pDLEVBQUUsT0FBT1AsT0FBTztZQUNkQyxRQUFRRCxLQUFLLENBQUMsQ0FBQyxtQ0FBbUMsQ0FBQyxFQUFFQSxPQUFPSCxVQUFVYixRQUFRZ0IsT0FBT0UsV0FBV0Y7WUFDaEcsT0FBTyxFQUFFO1FBQ1g7SUFDRjtBQUNGO0FBRUEsTUFBTWdCLGdCQUFnQixJQUFJakQ7QUFFMUJrRCxPQUFPQyxPQUFPLEdBQUc7SUFBRUY7QUFBYyIsInNvdXJjZXMiOlsiRDpcXFByb2plY3RzXFxEZWtodGUgaGFpXFxuZXVyb1N5bmNcXE5ldXJvU3luYy1BSS1Gcm9udGVuZFxcbGliXFxzZXJ2aWNlc1xccGluYXRhLXNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgYXhpb3MgPSByZXF1aXJlKCdheGlvcycpO1xyXG5cclxuLyoqXHJcbiAqIFBpbmF0YSBJUEZTIFNlcnZpY2VcclxuICogSGFuZGxlcyBzdG9yaW5nIGFuZCByZXRyaWV2aW5nIGRhdGEgZnJvbSBQaW5hdGEgSVBGU1xyXG4gKi9cclxuY2xhc3MgUGluYXRhU2VydmljZSB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLmFwaUtleSA9IHByb2Nlc3MuZW52LlBJTkFUQV9BUElfS0VZO1xyXG4gICAgdGhpcy5hcGlTZWNyZXQgPSBwcm9jZXNzLmVudi5QSU5BVEFfQVBJX1NFQ1JFVDtcclxuICAgIHRoaXMuand0ID0gcHJvY2Vzcy5lbnYuUElOQVRBX0pXVDtcclxuICAgIHRoaXMuYXBpVXJsID0gJ2h0dHBzOi8vYXBpLnBpbmF0YS5jbG91ZCc7XHJcbiAgICB0aGlzLmdhdGV3YXkgPSAnaHR0cHM6Ly9nYXRld2F5LnBpbmF0YS5jbG91ZC9pcGZzLyc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDaGVjayBpZiB0aGUgUGluYXRhIGNyZWRlbnRpYWxzIGFyZSBjb25maWd1cmVkXHJcbiAgICovXHJcbiAgaXNDb25maWd1cmVkKCkge1xyXG4gICAgcmV0dXJuICEhKHRoaXMuand0IHx8ICh0aGlzLmFwaUtleSAmJiB0aGlzLmFwaVNlY3JldCkpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHRoZSBoZWFkZXJzIGZvciBQaW5hdGEgQVBJIHJlcXVlc3RzXHJcbiAgICovXHJcbiAgZ2V0SGVhZGVycygpIHtcclxuICAgIGlmICh0aGlzLmp3dCkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dGhpcy5qd3R9YFxyXG4gICAgICB9O1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmFwaUtleSAmJiB0aGlzLmFwaVNlY3JldCkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgJ3BpbmF0YV9hcGlfa2V5JzogdGhpcy5hcGlLZXksXHJcbiAgICAgICAgJ3BpbmF0YV9zZWNyZXRfYXBpX2tleSc6IHRoaXMuYXBpU2VjcmV0XHJcbiAgICAgIH07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BpbmF0YSBjcmVkZW50aWFscyBub3QgY29uZmlndXJlZCcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RvcmUgZGF0YSBvbiBQaW5hdGEgSVBGU1xyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBrZXlOYW1lIC0gVW5pcXVlIGtleSBmb3IgdGhlIGRhdGFcclxuICAgKiBAcGFyYW0ge29iamVjdH0gZGF0YSAtIERhdGEgdG8gc3RvcmVcclxuICAgKiBAcGFyYW0ge29iamVjdH0gbWV0YWRhdGEgLSBPcHRpb25hbCBtZXRhZGF0YSBmb3IgdGhlIHBpblxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPG9iamVjdD59IC0gUmVzcG9uc2UgZnJvbSBQaW5hdGFcclxuICAgKi9cclxuICBhc3luYyBzdG9yZURhdGEoa2V5TmFtZSwgZGF0YSwgbWV0YWRhdGEgPSB7fSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCF0aGlzLmlzQ29uZmlndXJlZCgpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQaW5hdGEgY3JlZGVudGlhbHMgbm90IGNvbmZpZ3VyZWQnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gR2VuZXJhdGUgYSB1bmlxdWUgaWRlbnRpZmllciBmb3IgdGhlIHRyYW5zYWN0aW9uXHJcbiAgICAgIGNvbnN0IHVuaXF1ZUlkID0gYCR7a2V5TmFtZX1fJHtEYXRlLm5vdygpfWA7XHJcbiAgICAgIFxyXG4gICAgICAvLyBQcmVwYXJlIHRoZSBkYXRhIGZvciBQaW5hdGFcclxuICAgICAgY29uc3QgcGluYXRhQm9keSA9IHtcclxuICAgICAgICBwaW5hdGFDb250ZW50OiBkYXRhLFxyXG4gICAgICAgIHBpbmF0YU1ldGFkYXRhOiB7XHJcbiAgICAgICAgICBuYW1lOiB1bmlxdWVJZCxcclxuICAgICAgICAgIGtleXZhbHVlczoge1xyXG4gICAgICAgICAgICB1c2VySWQ6IGRhdGEudXNlcklkIHx8ICdhbm9ueW1vdXMnLFxyXG4gICAgICAgICAgICB0eXBlOiBkYXRhLnR5cGUgfHwgJ2NvbnZlcnNhdGlvbicsXHJcbiAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcclxuICAgICAgICAgICAgLi4ubWV0YWRhdGFcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICAvLyBVcGxvYWQgdG8gUGluYXRhXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdChcclxuICAgICAgICBgJHt0aGlzLmFwaVVybH0vcGlubmluZy9waW5KU09OVG9JUEZTYCxcclxuICAgICAgICBwaW5hdGFCb2R5LFxyXG4gICAgICAgIHsgaGVhZGVyczogdGhpcy5nZXRIZWFkZXJzKCkgfVxyXG4gICAgICApO1xyXG5cclxuICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc3RvcmUgZGF0YSBvbiBQaW5hdGE6JywgZXJyb3I/LnJlc3BvbnNlPy5kYXRhIHx8IGVycm9yPy5tZXNzYWdlIHx8IGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgZGF0YSBmcm9tIFBpbmF0YSBJUEZTXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGlwZnNIYXNoIC0gSVBGUyBoYXNoIHRvIHJldHJpZXZlXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8b2JqZWN0Pn0gLSBSZXRyaWV2ZWQgZGF0YVxyXG4gICAqL1xyXG4gIGFzeW5jIGdldERhdGEoaXBmc0hhc2gpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICghaXBmc0hhc2gpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0lQRlMgaGFzaCBpcyByZXF1aXJlZCcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBGZXRjaCBkYXRhIGZyb20gUGluYXRhIEdhdGV3YXlcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5nZXQoYCR7dGhpcy5nYXRld2F5fSR7aXBmc0hhc2h9YCk7XHJcbiAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGdldCBkYXRhIGZyb20gUGluYXRhICgke2lwZnNIYXNofSk6YCwgZXJyb3I/Lm1lc3NhZ2UgfHwgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBoaXN0b3J5IG9mIHBpbnMgZm9yIGEgdXNlclxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1c2VySWQgLSBVc2VyIElEIHRvIGdldCBoaXN0b3J5IGZvclxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPEFycmF5Pn0gLSBBcnJheSBvZiBwaW5zXHJcbiAgICovXHJcbiAgYXN5bmMgZ2V0SGlzdG9yeSh1c2VySWQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICghdGhpcy5pc0NvbmZpZ3VyZWQoKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUGluYXRhIGNyZWRlbnRpYWxzIG5vdCBjb25maWd1cmVkJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICghdXNlcklkKSB7XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBRdWVyeSBQaW5hdGEgZm9yIHBpbnMgd2l0aCB0aGUgdXNlcidzIElEXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KFxyXG4gICAgICAgIGAke3RoaXMuYXBpVXJsfS9kYXRhL3Bpbkxpc3Q/bWV0YWRhdGFba2V5dmFsdWVzXVt1c2VySWRdPXtcInZhbHVlXCI6XCIke3VzZXJJZH1cIixcIm9wXCI6XCJlcVwifSZzdGF0dXM9cGlubmVkYCxcclxuICAgICAgICB7IGhlYWRlcnM6IHRoaXMuZ2V0SGVhZGVycygpIH1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLnJvd3MgfHwgW107XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gZ2V0IGhpc3RvcnkgZnJvbSBQaW5hdGEgZm9yIHVzZXIgJHt1c2VySWR9OmAsIGVycm9yPy5yZXNwb25zZT8uZGF0YSB8fCBlcnJvcj8ubWVzc2FnZSB8fCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbW92ZSBkYXRhIGZyb20gUGluYXRhIElQRlNcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gaXBmc0hhc2ggLSBJUEZTIGhhc2ggdG8gcmVtb3ZlXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8b2JqZWN0Pn0gLSBSZXNwb25zZSBmcm9tIFBpbmF0YVxyXG4gICAqL1xyXG4gIGFzeW5jIHJlbW92ZURhdGEoaXBmc0hhc2gpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICghdGhpcy5pc0NvbmZpZ3VyZWQoKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUGluYXRhIGNyZWRlbnRpYWxzIG5vdCBjb25maWd1cmVkJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICghaXBmc0hhc2gpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0lQRlMgaGFzaCBpcyByZXF1aXJlZCcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBVbnBpbiBmcm9tIFBpbmF0YVxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLmRlbGV0ZShcclxuICAgICAgICBgJHt0aGlzLmFwaVVybH0vcGlubmluZy91bnBpbi8ke2lwZnNIYXNofWAsXHJcbiAgICAgICAgeyBoZWFkZXJzOiB0aGlzLmdldEhlYWRlcnMoKSB9XHJcbiAgICAgICk7XHJcblxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiByZXNwb25zZS5kYXRhIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gcmVtb3ZlIGRhdGEgZnJvbSBQaW5hdGEgKCR7aXBmc0hhc2h9KTpgLCBlcnJvcj8ucmVzcG9uc2U/LmRhdGEgfHwgZXJyb3I/Lm1lc3NhZ2UgfHwgZXJyb3IpO1xyXG4gICAgICBcclxuICAgICAgLy8gSGFuZGxlIGNvbW1vbiBQaW5hdGEgZXJyb3IgY2FzZXM6IFxyXG4gICAgICAvLyAxLiA0MDQgLSBQaW4gZG9lc24ndCBleGlzdFxyXG4gICAgICAvLyAyLiA0MDAgd2l0aCBcIkNVUlJFTlRfVVNFUl9IQVNfTk9UX1BJTk5FRF9DSURcIiAtIFVzZXIgZG9lc24ndCBoYXZlIHBlcm1pc3Npb24gdG8gdW5waW5cclxuICAgICAgaWYgKGVycm9yPy5yZXNwb25zZT8uc3RhdHVzID09PSA0MDQgfHwgXHJcbiAgICAgICAgICAoZXJyb3I/LnJlc3BvbnNlPy5zdGF0dXMgPT09IDQwMCAmJiBcclxuICAgICAgICAgICBlcnJvcj8ucmVzcG9uc2U/LmRhdGE/LmVycm9yPy5yZWFzb24gPT09ICdDVVJSRU5UX1VTRVJfSEFTX05PVF9QSU5ORURfQ0lEJykpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgUGluICR7aXBmc0hhc2h9IG5vdCBmb3VuZCBvciBub3Qgb3duZWQgYnkgY3VycmVudCB1c2VyLiBDb25zaWRlcmluZyBpdCByZW1vdmVkLmApO1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6ICdQaW4gbm90IGZvdW5kIG9yIG5vdCBvd25lZCBieSBjdXJyZW50IHVzZXInIH07XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVGVzdCB0aGUgUGluYXRhIGNvbm5lY3Rpb25cclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gLSBXaGV0aGVyIHRoZSBjb25uZWN0aW9uIHdhcyBzdWNjZXNzZnVsXHJcbiAgICovXHJcbiAgYXN5bmMgdGVzdENvbm5lY3Rpb24oKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAoIXRoaXMuaXNDb25maWd1cmVkKCkpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFRlc3QgdGhlIGNvbm5lY3Rpb24gYnkgZ2V0dGluZyB0aGUgcGluIGNvdW50XHJcbiAgICAgIGF3YWl0IGF4aW9zLmdldChcclxuICAgICAgICBgJHt0aGlzLmFwaVVybH0vZGF0YS91c2VyUGlubmVkRGF0YVRvdGFsYCxcclxuICAgICAgICB7IGhlYWRlcnM6IHRoaXMuZ2V0SGVhZGVycygpIH1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignUGluYXRhIGNvbm5lY3Rpb24gdGVzdCBmYWlsZWQ6JywgZXJyb3I/LnJlc3BvbnNlPy5kYXRhIHx8IGVycm9yPy5tZXNzYWdlIHx8IGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IGFsbCBwaW5zIGZyb20gUGluYXRhIHJlZ2FyZGxlc3Mgb2YgdXNlciBJRFxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPEFycmF5Pn0gLSBBcnJheSBvZiBwaW5zXHJcbiAgICovXHJcbiAgYXN5bmMgZ2V0QWxsUGlucygpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICghdGhpcy5pc0NvbmZpZ3VyZWQoKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUGluYXRhIGNyZWRlbnRpYWxzIG5vdCBjb25maWd1cmVkJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFF1ZXJ5IFBpbmF0YSBmb3IgYWxsIHBpbnNcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5nZXQoXHJcbiAgICAgICAgYCR7dGhpcy5hcGlVcmx9L2RhdGEvcGluTGlzdD9zdGF0dXM9cGlubmVkYCxcclxuICAgICAgICB7IGhlYWRlcnM6IHRoaXMuZ2V0SGVhZGVycygpIH1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIHJldHVybiByZXNwb25zZS5kYXRhLnJvd3MgfHwgW107XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gZ2V0IGFsbCBwaW5zIGZyb20gUGluYXRhOmAsIGVycm9yPy5yZXNwb25zZT8uZGF0YSB8fCBlcnJvcj8ubWVzc2FnZSB8fCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IHBpbmF0YVNlcnZpY2UgPSBuZXcgUGluYXRhU2VydmljZSgpO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7IHBpbmF0YVNlcnZpY2UgfTsgIl0sIm5hbWVzIjpbImF4aW9zIiwicmVxdWlyZSIsIlBpbmF0YVNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJQSU5BVEFfQVBJX0tFWSIsImFwaVNlY3JldCIsIlBJTkFUQV9BUElfU0VDUkVUIiwiand0IiwiUElOQVRBX0pXVCIsImFwaVVybCIsImdhdGV3YXkiLCJpc0NvbmZpZ3VyZWQiLCJnZXRIZWFkZXJzIiwiRXJyb3IiLCJzdG9yZURhdGEiLCJrZXlOYW1lIiwiZGF0YSIsIm1ldGFkYXRhIiwidW5pcXVlSWQiLCJEYXRlIiwibm93IiwicGluYXRhQm9keSIsInBpbmF0YUNvbnRlbnQiLCJwaW5hdGFNZXRhZGF0YSIsIm5hbWUiLCJrZXl2YWx1ZXMiLCJ1c2VySWQiLCJ0eXBlIiwidGltZXN0YW1wIiwicmVzcG9uc2UiLCJwb3N0IiwiaGVhZGVycyIsImVycm9yIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJnZXREYXRhIiwiaXBmc0hhc2giLCJnZXQiLCJnZXRIaXN0b3J5Iiwicm93cyIsInJlbW92ZURhdGEiLCJkZWxldGUiLCJzdWNjZXNzIiwic3RhdHVzIiwicmVhc29uIiwibG9nIiwidGVzdENvbm5lY3Rpb24iLCJnZXRBbGxQaW5zIiwicGluYXRhU2VydmljZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/services/pinata-service.js\n");

/***/ }),

/***/ "(api-node)/./lib/user-profile-service.js":
/*!*************************************!*\
  !*** ./lib/user-profile-service.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   userProfileService: () => (/* binding */ userProfileService)\n/* harmony export */ });\n/* harmony import */ var _services_pinata_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./services/pinata-service */ \"(api-node)/./lib/services/pinata-service.js\");\n/* harmony import */ var _services_pinata_service__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_services_pinata_service__WEBPACK_IMPORTED_MODULE_0__);\n/**\r\n * Service for managing user profiles using Pinata IPFS\r\n * All user data is stored on IPFS via Pinata instead of MongoDB\r\n */ \n// Helper function to generate unique IDs\nfunction generateUserId() {\n    return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n}\nconst userProfileService = {\n    /**\r\n   * Get user profile by ID\r\n   * @param {string} userId - User ID\r\n   * @returns {Promise<Object>} - User profile\r\n   */ async getUserProfile (userId) {\n        try {\n            if (!userId) {\n                throw new Error('User ID is required');\n            }\n            // Get user pins from Pinata\n            const pins = await _services_pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.getHistory(userId);\n            // Find user profile pin\n            const userProfilePin = pins.find((pin)=>{\n                const metadata = pin.metadata?.keyvalues;\n                return metadata?.type === 'user_profile' && metadata?.userId === userId;\n            });\n            if (!userProfilePin) {\n                // If no profile exists, create a default one\n                const defaultProfile = {\n                    _id: userId,\n                    userId: userId,\n                    name: 'User',\n                    email: 'user@example.com',\n                    recommendations: [],\n                    createdAt: new Date(),\n                    updatedAt: new Date(),\n                    type: 'user_profile'\n                };\n                // Store default profile\n                const response = await _services_pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.storeData(`user_${userId}`, defaultProfile, {\n                    userId,\n                    type: 'user_profile'\n                });\n                // Return the default profile\n                defaultProfile.ipfsHash = response.IpfsHash;\n                return defaultProfile;\n            }\n            // Get profile data from Pinata\n            const profile = await _services_pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.getData(userProfilePin.ipfs_pin_hash);\n            if (!profile) {\n                throw new Error('Failed to retrieve user profile from Pinata');\n            }\n            // Add IPFS hash to profile\n            profile.ipfsHash = userProfilePin.ipfs_pin_hash;\n            return profile;\n        } catch (error) {\n            console.error('Error fetching user profile from Pinata:', error);\n            // Return a fallback basic profile\n            return {\n                _id: userId,\n                userId: userId,\n                name: 'User',\n                recommendations: [],\n                createdAt: new Date(),\n                updatedAt: new Date()\n            };\n        }\n    },\n    /**\r\n   * Update user recommendations\r\n   * @param {string} userId - User ID\r\n   * @param {Array} recommendations - Array of recommendation objects\r\n   * @returns {Promise<Object>} - Updated user\r\n   */ async updateRecommendations (userId, recommendations) {\n        try {\n            if (!userId) {\n                throw new Error('User ID is required');\n            }\n            if (!recommendations || !Array.isArray(recommendations)) {\n                throw new Error('Recommendations must be an array');\n            }\n            // Get current user profile\n            const profile = await this.getUserProfile(userId);\n            // Get user pins from Pinata\n            const pins = await _services_pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.getHistory(userId);\n            // Find user profile pin\n            const userProfilePin = pins.find((pin)=>{\n                const metadata = pin.metadata?.keyvalues;\n                return metadata?.type === 'user_profile' && metadata?.userId === userId;\n            });\n            // Update profile with new recommendations\n            profile.recommendations = recommendations;\n            profile.lastRecommendationUpdate = new Date();\n            profile.updatedAt = new Date();\n            // Store updated profile to Pinata\n            const response = await _services_pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.storeData(`user_${userId}`, profile, {\n                userId,\n                type: 'user_profile'\n            });\n            // If we had a previous pin, remove it\n            if (userProfilePin) {\n                await _services_pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.removeData(userProfilePin.ipfs_pin_hash);\n            }\n            return {\n                success: true,\n                profile: {\n                    ...profile,\n                    ipfsHash: response.IpfsHash\n                }\n            };\n        } catch (error) {\n            console.error('Error updating recommendations on Pinata:', error);\n            throw error;\n        }\n    },\n    /**\r\n   * Create or update user profile\r\n   * @param {Object} userData - User data including credentials\r\n   * @returns {Promise<Object>} - Created/updated user\r\n   */ async createOrUpdateUser (userData) {\n        try {\n            if (!userData) {\n                throw new Error('User data is required');\n            }\n            let userId = userData.userId || userData._id;\n            // If no userId, generate one\n            if (!userId) {\n                userId = generateUserId();\n                userData._id = userId;\n                userData.userId = userId;\n            }\n            // Get user pins from Pinata\n            const pins = await _services_pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.getHistory(userId);\n            // Find user profile pin\n            const userProfilePin = pins.find((pin)=>{\n                const metadata = pin.metadata?.keyvalues;\n                return metadata?.type === 'user_profile' && metadata?.userId === userId;\n            });\n            // Set timestamps\n            userData.updatedAt = new Date();\n            if (!userData.createdAt) {\n                userData.createdAt = new Date();\n            }\n            // Set type for Pinata metadata\n            userData.type = 'user_profile';\n            // Store profile to Pinata\n            const response = await _services_pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.storeData(`user_${userId}`, userData, {\n                userId,\n                type: 'user_profile'\n            });\n            // If we had a previous pin, remove it\n            if (userProfilePin) {\n                await _services_pinata_service__WEBPACK_IMPORTED_MODULE_0__.pinataService.removeData(userProfilePin.ipfs_pin_hash);\n            }\n            return {\n                ...userData,\n                ipfsHash: response.IpfsHash\n            };\n        } catch (error) {\n            console.error('Error creating/updating user on Pinata:', error);\n            throw error;\n        }\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFTakIsU0FBUyxHQUFHLElBQUlEO1lBQ3pCLElBQUksQ0FBQ2tCLFNBQVNuQixTQUFTLEVBQUU7Z0JBQ3ZCbUIsU0FBU25CLFNBQVMsR0FBRyxJQUFJQztZQUMzQjtZQUVBLCtCQUErQjtZQUMvQmtCLFNBQVN6QixJQUFJLEdBQUc7WUFFaEIsMEJBQTBCO1lBQzFCLE1BQU1TLFdBQVcsTUFBTTFCLG1FQUFhQSxDQUFDMkIsU0FBUyxDQUM1QyxDQUFDLEtBQUssRUFBRW5CLFFBQVEsRUFDaEJrQyxVQUNBO2dCQUFFbEM7Z0JBQVFTLE1BQU07WUFBZTtZQUdqQyxzQ0FBc0M7WUFDdEMsSUFBSUwsZ0JBQWdCO2dCQUNsQixNQUFNWixtRUFBYUEsQ0FBQ3VDLFVBQVUsQ0FBQzNCLGVBQWVvQixhQUFhO1lBQzdEO1lBRUEsT0FBTztnQkFDTCxHQUFHVSxRQUFRO2dCQUNYZCxVQUFVRixTQUFTRyxRQUFRO1lBQzdCO1FBQ0YsRUFBRSxPQUFPSSxPQUFPO1lBQ2RDLFFBQVFELEtBQUssQ0FBQywyQ0FBMkNBO1lBQ3pELE1BQU1BO1FBQ1I7SUFDRjtBQUNGLEVBQUUiLCJzb3VyY2VzIjpbIkQ6XFxQcm9qZWN0c1xcRGVraHRlIGhhaVxcbmV1cm9TeW5jXFxOZXVyb1N5bmMtQUktRnJvbnRlbmRcXGxpYlxcdXNlci1wcm9maWxlLXNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFNlcnZpY2UgZm9yIG1hbmFnaW5nIHVzZXIgcHJvZmlsZXMgdXNpbmcgUGluYXRhIElQRlNcclxuICogQWxsIHVzZXIgZGF0YSBpcyBzdG9yZWQgb24gSVBGUyB2aWEgUGluYXRhIGluc3RlYWQgb2YgTW9uZ29EQlxyXG4gKi9cclxuaW1wb3J0IHsgcGluYXRhU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvcGluYXRhLXNlcnZpY2UnO1xyXG5cclxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGdlbmVyYXRlIHVuaXF1ZSBJRHNcclxuZnVuY3Rpb24gZ2VuZXJhdGVVc2VySWQoKSB7XHJcbiAgcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCAxNSkgKyBcclxuICAgICAgICAgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDE1KTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHVzZXJQcm9maWxlU2VydmljZSA9IHtcclxuICAvKipcclxuICAgKiBHZXQgdXNlciBwcm9maWxlIGJ5IElEXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3Q+fSAtIFVzZXIgcHJvZmlsZVxyXG4gICAqL1xyXG4gIGFzeW5jIGdldFVzZXJQcm9maWxlKHVzZXJJZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKCF1c2VySWQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgSUQgaXMgcmVxdWlyZWQnKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gR2V0IHVzZXIgcGlucyBmcm9tIFBpbmF0YVxyXG4gICAgICBjb25zdCBwaW5zID0gYXdhaXQgcGluYXRhU2VydmljZS5nZXRIaXN0b3J5KHVzZXJJZCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBGaW5kIHVzZXIgcHJvZmlsZSBwaW5cclxuICAgICAgY29uc3QgdXNlclByb2ZpbGVQaW4gPSBwaW5zLmZpbmQocGluID0+IHtcclxuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IHBpbi5tZXRhZGF0YT8ua2V5dmFsdWVzO1xyXG4gICAgICAgIHJldHVybiBtZXRhZGF0YT8udHlwZSA9PT0gJ3VzZXJfcHJvZmlsZScgJiYgbWV0YWRhdGE/LnVzZXJJZCA9PT0gdXNlcklkO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmICghdXNlclByb2ZpbGVQaW4pIHtcclxuICAgICAgICAvLyBJZiBubyBwcm9maWxlIGV4aXN0cywgY3JlYXRlIGEgZGVmYXVsdCBvbmVcclxuICAgICAgICBjb25zdCBkZWZhdWx0UHJvZmlsZSA9IHtcclxuICAgICAgICAgIF9pZDogdXNlcklkLFxyXG4gICAgICAgICAgdXNlcklkOiB1c2VySWQsXHJcbiAgICAgICAgICBuYW1lOiAnVXNlcicsXHJcbiAgICAgICAgICBlbWFpbDogJ3VzZXJAZXhhbXBsZS5jb20nLFxyXG4gICAgICAgICAgcmVjb21tZW5kYXRpb25zOiBbXSxcclxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcclxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcclxuICAgICAgICAgIHR5cGU6ICd1c2VyX3Byb2ZpbGUnXHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBTdG9yZSBkZWZhdWx0IHByb2ZpbGVcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHBpbmF0YVNlcnZpY2Uuc3RvcmVEYXRhKFxyXG4gICAgICAgICAgYHVzZXJfJHt1c2VySWR9YCxcclxuICAgICAgICAgIGRlZmF1bHRQcm9maWxlLFxyXG4gICAgICAgICAgeyB1c2VySWQsIHR5cGU6ICd1c2VyX3Byb2ZpbGUnIH1cclxuICAgICAgICApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIFJldHVybiB0aGUgZGVmYXVsdCBwcm9maWxlXHJcbiAgICAgICAgZGVmYXVsdFByb2ZpbGUuaXBmc0hhc2ggPSByZXNwb25zZS5JcGZzSGFzaDtcclxuICAgICAgICByZXR1cm4gZGVmYXVsdFByb2ZpbGU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEdldCBwcm9maWxlIGRhdGEgZnJvbSBQaW5hdGFcclxuICAgICAgY29uc3QgcHJvZmlsZSA9IGF3YWl0IHBpbmF0YVNlcnZpY2UuZ2V0RGF0YSh1c2VyUHJvZmlsZVBpbi5pcGZzX3Bpbl9oYXNoKTtcclxuICAgICAgXHJcbiAgICAgIGlmICghcHJvZmlsZSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHJldHJpZXZlIHVzZXIgcHJvZmlsZSBmcm9tIFBpbmF0YScpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBBZGQgSVBGUyBoYXNoIHRvIHByb2ZpbGVcclxuICAgICAgcHJvZmlsZS5pcGZzSGFzaCA9IHVzZXJQcm9maWxlUGluLmlwZnNfcGluX2hhc2g7XHJcbiAgICAgIHJldHVybiBwcm9maWxlO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgdXNlciBwcm9maWxlIGZyb20gUGluYXRhOicsIGVycm9yKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFJldHVybiBhIGZhbGxiYWNrIGJhc2ljIHByb2ZpbGVcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBfaWQ6IHVzZXJJZCxcclxuICAgICAgICB1c2VySWQ6IHVzZXJJZCxcclxuICAgICAgICBuYW1lOiAnVXNlcicsXHJcbiAgICAgICAgcmVjb21tZW5kYXRpb25zOiBbXSxcclxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIHVzZXIgcmVjb21tZW5kYXRpb25zXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVzZXJJZCAtIFVzZXIgSURcclxuICAgKiBAcGFyYW0ge0FycmF5fSByZWNvbW1lbmRhdGlvbnMgLSBBcnJheSBvZiByZWNvbW1lbmRhdGlvbiBvYmplY3RzXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gLSBVcGRhdGVkIHVzZXJcclxuICAgKi9cclxuICBhc3luYyB1cGRhdGVSZWNvbW1lbmRhdGlvbnModXNlcklkLCByZWNvbW1lbmRhdGlvbnMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICghdXNlcklkKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VyIElEIGlzIHJlcXVpcmVkJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICghcmVjb21tZW5kYXRpb25zIHx8ICFBcnJheS5pc0FycmF5KHJlY29tbWVuZGF0aW9ucykpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlY29tbWVuZGF0aW9ucyBtdXN0IGJlIGFuIGFycmF5Jyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEdldCBjdXJyZW50IHVzZXIgcHJvZmlsZVxyXG4gICAgICBjb25zdCBwcm9maWxlID0gYXdhaXQgdGhpcy5nZXRVc2VyUHJvZmlsZSh1c2VySWQpO1xyXG4gICAgICBcclxuICAgICAgLy8gR2V0IHVzZXIgcGlucyBmcm9tIFBpbmF0YVxyXG4gICAgICBjb25zdCBwaW5zID0gYXdhaXQgcGluYXRhU2VydmljZS5nZXRIaXN0b3J5KHVzZXJJZCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBGaW5kIHVzZXIgcHJvZmlsZSBwaW5cclxuICAgICAgY29uc3QgdXNlclByb2ZpbGVQaW4gPSBwaW5zLmZpbmQocGluID0+IHtcclxuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IHBpbi5tZXRhZGF0YT8ua2V5dmFsdWVzO1xyXG4gICAgICAgIHJldHVybiBtZXRhZGF0YT8udHlwZSA9PT0gJ3VzZXJfcHJvZmlsZScgJiYgbWV0YWRhdGE/LnVzZXJJZCA9PT0gdXNlcklkO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8vIFVwZGF0ZSBwcm9maWxlIHdpdGggbmV3IHJlY29tbWVuZGF0aW9uc1xyXG4gICAgICBwcm9maWxlLnJlY29tbWVuZGF0aW9ucyA9IHJlY29tbWVuZGF0aW9ucztcclxuICAgICAgcHJvZmlsZS5sYXN0UmVjb21tZW5kYXRpb25VcGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICBwcm9maWxlLnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XHJcblxyXG4gICAgICAvLyBTdG9yZSB1cGRhdGVkIHByb2ZpbGUgdG8gUGluYXRhXHJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcGluYXRhU2VydmljZS5zdG9yZURhdGEoXHJcbiAgICAgICAgYHVzZXJfJHt1c2VySWR9YCxcclxuICAgICAgICBwcm9maWxlLFxyXG4gICAgICAgIHsgdXNlcklkLCB0eXBlOiAndXNlcl9wcm9maWxlJyB9XHJcbiAgICAgICk7XHJcblxyXG4gICAgICAvLyBJZiB3ZSBoYWQgYSBwcmV2aW91cyBwaW4sIHJlbW92ZSBpdFxyXG4gICAgICBpZiAodXNlclByb2ZpbGVQaW4pIHtcclxuICAgICAgICBhd2FpdCBwaW5hdGFTZXJ2aWNlLnJlbW92ZURhdGEodXNlclByb2ZpbGVQaW4uaXBmc19waW5faGFzaCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7IFxyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsIFxyXG4gICAgICAgIHByb2ZpbGU6IHsgLi4ucHJvZmlsZSwgaXBmc0hhc2g6IHJlc3BvbnNlLklwZnNIYXNoIH0gXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyByZWNvbW1lbmRhdGlvbnMgb24gUGluYXRhOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfSxcclxuICBcclxuICAvKipcclxuICAgKiBDcmVhdGUgb3IgdXBkYXRlIHVzZXIgcHJvZmlsZVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB1c2VyRGF0YSAtIFVzZXIgZGF0YSBpbmNsdWRpbmcgY3JlZGVudGlhbHNcclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3Q+fSAtIENyZWF0ZWQvdXBkYXRlZCB1c2VyXHJcbiAgICovXHJcbiAgYXN5bmMgY3JlYXRlT3JVcGRhdGVVc2VyKHVzZXJEYXRhKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAoIXVzZXJEYXRhKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVc2VyIGRhdGEgaXMgcmVxdWlyZWQnKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgbGV0IHVzZXJJZCA9IHVzZXJEYXRhLnVzZXJJZCB8fCB1c2VyRGF0YS5faWQ7XHJcbiAgICAgIFxyXG4gICAgICAvLyBJZiBubyB1c2VySWQsIGdlbmVyYXRlIG9uZVxyXG4gICAgICBpZiAoIXVzZXJJZCkge1xyXG4gICAgICAgIHVzZXJJZCA9IGdlbmVyYXRlVXNlcklkKCk7XHJcbiAgICAgICAgdXNlckRhdGEuX2lkID0gdXNlcklkO1xyXG4gICAgICAgIHVzZXJEYXRhLnVzZXJJZCA9IHVzZXJJZDtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gR2V0IHVzZXIgcGlucyBmcm9tIFBpbmF0YVxyXG4gICAgICBjb25zdCBwaW5zID0gYXdhaXQgcGluYXRhU2VydmljZS5nZXRIaXN0b3J5KHVzZXJJZCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBGaW5kIHVzZXIgcHJvZmlsZSBwaW5cclxuICAgICAgY29uc3QgdXNlclByb2ZpbGVQaW4gPSBwaW5zLmZpbmQocGluID0+IHtcclxuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IHBpbi5tZXRhZGF0YT8ua2V5dmFsdWVzO1xyXG4gICAgICAgIHJldHVybiBtZXRhZGF0YT8udHlwZSA9PT0gJ3VzZXJfcHJvZmlsZScgJiYgbWV0YWRhdGE/LnVzZXJJZCA9PT0gdXNlcklkO1xyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIFNldCB0aW1lc3RhbXBzXHJcbiAgICAgIHVzZXJEYXRhLnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XHJcbiAgICAgIGlmICghdXNlckRhdGEuY3JlYXRlZEF0KSB7XHJcbiAgICAgICAgdXNlckRhdGEuY3JlYXRlZEF0ID0gbmV3IERhdGUoKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gU2V0IHR5cGUgZm9yIFBpbmF0YSBtZXRhZGF0YVxyXG4gICAgICB1c2VyRGF0YS50eXBlID0gJ3VzZXJfcHJvZmlsZSc7XHJcbiAgICAgIFxyXG4gICAgICAvLyBTdG9yZSBwcm9maWxlIHRvIFBpbmF0YVxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHBpbmF0YVNlcnZpY2Uuc3RvcmVEYXRhKFxyXG4gICAgICAgIGB1c2VyXyR7dXNlcklkfWAsXHJcbiAgICAgICAgdXNlckRhdGEsXHJcbiAgICAgICAgeyB1c2VySWQsIHR5cGU6ICd1c2VyX3Byb2ZpbGUnIH1cclxuICAgICAgKTtcclxuICAgICAgXHJcbiAgICAgIC8vIElmIHdlIGhhZCBhIHByZXZpb3VzIHBpbiwgcmVtb3ZlIGl0XHJcbiAgICAgIGlmICh1c2VyUHJvZmlsZVBpbikge1xyXG4gICAgICAgIGF3YWl0IHBpbmF0YVNlcnZpY2UucmVtb3ZlRGF0YSh1c2VyUHJvZmlsZVBpbi5pcGZzX3Bpbl9oYXNoKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHsgXHJcbiAgICAgICAgLi4udXNlckRhdGEsIFxyXG4gICAgICAgIGlwZnNIYXNoOiByZXNwb25zZS5JcGZzSGFzaCBcclxuICAgICAgfTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nL3VwZGF0aW5nIHVzZXIgb24gUGluYXRhOicsIGVycm9yKTtcclxuICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICB9XHJcbiAgfVxyXG59OyAiXSwibmFtZXMiOlsicGluYXRhU2VydmljZSIsImdlbmVyYXRlVXNlcklkIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwidXNlclByb2ZpbGVTZXJ2aWNlIiwiZ2V0VXNlclByb2ZpbGUiLCJ1c2VySWQiLCJFcnJvciIsInBpbnMiLCJnZXRIaXN0b3J5IiwidXNlclByb2ZpbGVQaW4iLCJmaW5kIiwicGluIiwibWV0YWRhdGEiLCJrZXl2YWx1ZXMiLCJ0eXBlIiwiZGVmYXVsdFByb2ZpbGUiLCJfaWQiLCJuYW1lIiwiZW1haWwiLCJyZWNvbW1lbmRhdGlvbnMiLCJjcmVhdGVkQXQiLCJEYXRlIiwidXBkYXRlZEF0IiwicmVzcG9uc2UiLCJzdG9yZURhdGEiLCJpcGZzSGFzaCIsIklwZnNIYXNoIiwicHJvZmlsZSIsImdldERhdGEiLCJpcGZzX3Bpbl9oYXNoIiwiZXJyb3IiLCJjb25zb2xlIiwidXBkYXRlUmVjb21tZW5kYXRpb25zIiwiQXJyYXkiLCJpc0FycmF5IiwibGFzdFJlY29tbWVuZGF0aW9uVXBkYXRlIiwicmVtb3ZlRGF0YSIsInN1Y2Nlc3MiLCJjcmVhdGVPclVwZGF0ZVVzZXIiLCJ1c2VyRGF0YSJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/user-profile-service.js\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fai%2Flocal-chat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cai%5Clocal-chat.js&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fai%2Flocal-chat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cai%5Clocal-chat.js&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_ai_local_chat_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\ai\\local-chat.js */ \"(api-node)/./pages/api/ai/local-chat.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_ai_local_chat_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_ai_local_chat_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_ai_local_chat_js__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_ai_local_chat_js__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/ai/local-chat\",\n        pathname: \"/api/ai/local-chat\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_ai_local_chat_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGYWklMkZsb2NhbC1jaGF0JnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNhaSU1Q2xvY2FsLWNoYXQuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ0U7QUFDMUQ7QUFDNEQ7QUFDNUQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLHdEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyx3REFBUTtBQUNwQztBQUNPLHdCQUF3Qix5R0FBbUI7QUFDbEQ7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxhaVxcXFxsb2NhbC1jaGF0LmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsICdkZWZhdWx0Jyk7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCAnY29uZmlnJyk7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9haS9sb2NhbC1jaGF0XCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYWkvbG9jYWwtY2hhdFwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6ICcnLFxuICAgICAgICBmaWxlbmFtZTogJydcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fai%2Flocal-chat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cai%5Clocal-chat.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/ai/local-chat.js":
/*!************************************!*\
  !*** ./pages/api/ai/local-chat.js ***!
  \************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_local_ai_middleware__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/local-ai-middleware */ \"(api-node)/./lib/local-ai-middleware.js\");\n/* harmony import */ var _lib_services_pinata_conversation_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/services/pinata-conversation-service */ \"(api-node)/./lib/services/pinata-conversation-service.js\");\n/* harmony import */ var _lib_user_profile_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/user-profile-service */ \"(api-node)/./lib/user-profile-service.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_local_ai_middleware__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_local_ai_middleware__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n/**\r\n * API handler for local chat interactions\r\n * Streamlined to focus on Ollama chat processing and Pinata IPFS storage\r\n */ \n\n\n// Sample recommendation data for fallback\nconst SAMPLE_RECOMMENDATIONS = [\n    {\n        type: 'exercise',\n        title: 'Deep Breathing Exercise',\n        description: 'Take 5 deep breaths, inhaling for 4 seconds and exhaling for 6 seconds.',\n        actionUrl: '/resources/exercises/breathing',\n        actionText: 'Start Exercise'\n    },\n    {\n        type: 'resource',\n        title: 'Understanding Anxiety',\n        description: 'Learn about the causes and effects of anxiety in everyday life.',\n        actionUrl: '/resources/articles/anxiety',\n        actionText: 'Read Article'\n    },\n    {\n        type: 'checkin',\n        title: 'Mood Check-in',\n        description: \"Record how you're feeling right now to track your emotional patterns.\",\n        actionUrl: '/checkin',\n        actionText: 'Check In'\n    }\n];\nasync function handler(req, res) {\n    if (req.method !== 'POST') {\n        return res.status(405).json({\n            error: 'Method not allowed'\n        });\n    }\n    try {\n        const userId = req.body.userId || req.query.userId;\n        if (!userId) {\n            return res.status(401).json({\n                error: 'User ID is required'\n            });\n        }\n        // Get basic user info if available, but don't require it\n        let userProfile = null;\n        if (userId && userId !== 'anonymous') {\n            try {\n                userProfile = await _lib_user_profile_service__WEBPACK_IMPORTED_MODULE_2__.userProfileService.getUserProfile(userId);\n            } catch (error) {\n                console.warn('Error fetching user profile, continuing without it:', error.message);\n            }\n        }\n        const { message, conversationId, history } = req.body;\n        if (!message || !message.content) {\n            return res.status(400).json({\n                error: 'Message content is required'\n            });\n        }\n        console.log('Local chat API called with message:', message.content.substring(0, 50) + '...');\n        // Extract chat history if available\n        const chatHistory = history || [];\n        // Process the message through LLaMA AI middleware\n        const processedResult = await _lib_local_ai_middleware__WEBPACK_IMPORTED_MODULE_0__.localAiMiddleware.processInput(message.content, chatHistory, userProfile);\n        // Setup message objects for Pinata storage\n        const userMessage = {\n            role: 'user',\n            content: message.content,\n            timestamp: new Date()\n        };\n        const aiMessage = {\n            role: 'assistant',\n            content: processedResult.message,\n            sentiment: processedResult.sentiment,\n            emotions: processedResult.emotions,\n            timestamp: new Date()\n        };\n        // Handle conversation storage\n        let conversation;\n        try {\n            if (conversationId) {\n                // Add user message to existing conversation\n                await _lib_services_pinata_conversation_service__WEBPACK_IMPORTED_MODULE_1__.pinataConversationService.addMessage(conversationId, userId, userMessage);\n                // Add AI response\n                conversation = await _lib_services_pinata_conversation_service__WEBPACK_IMPORTED_MODULE_1__.pinataConversationService.addMessage(conversationId, userId, aiMessage);\n                console.log(`Added messages to existing conversation: ${conversationId}`);\n            } else {\n                // Create new conversation title from message content\n                const title = message.content.length > 30 ? message.content.substring(0, 30) + '...' : message.content;\n                // Create new conversation with both messages\n                conversation = await _lib_services_pinata_conversation_service__WEBPACK_IMPORTED_MODULE_1__.pinataConversationService.createConversation(userId, title, [\n                    userMessage,\n                    aiMessage\n                ]);\n                console.log(`Created new conversation: ${conversation._id}`);\n            }\n        } catch (storageError) {\n            console.error('Error storing conversation in Pinata:', storageError);\n        // Continue even if storage fails - prioritize the user getting a response\n        }\n        // Update recommendations if available\n        if (processedResult.recommendations && userProfile) {\n            try {\n                await _lib_user_profile_service__WEBPACK_IMPORTED_MODULE_2__.userProfileService.updateRecommendations(userId, processedResult.recommendations);\n            } catch (error) {\n                console.error('Error updating recommendations:', error);\n            // Continue without updating recommendations\n            }\n        }\n        // Return the response to the client\n        return res.status(200).json({\n            conversationId: conversation?._id || 'fallback_id',\n            message: aiMessage,\n            sentiment: processedResult.sentiment,\n            emotions: processedResult.emotions,\n            recommendations: processedResult.recommendations || []\n        });\n    } catch (error) {\n        console.error('Error in local chat API:', error);\n        return res.status(500).json({\n            error: 'An error occurred processing your request',\n            message: {\n                role: 'assistant',\n                content: \"I'm sorry, I'm having trouble processing your request right now. Please try again later.\"\n            }\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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T0FBTztnQkFFbkIsNkNBQTZDO2dCQUM3Q2EsZUFBZSxNQUFNdEMsZ0dBQXlCQSxDQUFDeUMsa0JBQWtCLENBQy9EMUIsUUFDQVgsT0FDQTtvQkFBQzJCO29CQUFhSTtpQkFBVTtnQkFHMUJmLFFBQVFNLEdBQUcsQ0FBQyxDQUFDLDBCQUEwQixFQUFFWSxhQUFhSSxHQUFHLEVBQUU7WUFDN0Q7UUFDRixFQUFFLE9BQU9DLGNBQWM7WUFDckJ2QixRQUFRTixLQUFLLENBQUMseUNBQXlDNkI7UUFDdkQsMEVBQTBFO1FBQzVFO1FBRUEsc0NBQXNDO1FBQ3RDLElBQUlkLGdCQUFnQmUsZUFBZSxJQUFJMUIsYUFBYTtZQUNsRCxJQUFJO2dCQUNGLE1BQU1qQix5RUFBa0JBLENBQUM0QyxxQkFBcUIsQ0FDNUM5QixRQUNBYyxnQkFBZ0JlLGVBQWU7WUFFbkMsRUFBRSxPQUFPOUIsT0FBTztnQkFDZE0sUUFBUU4sS0FBSyxDQUFDLG1DQUFtQ0E7WUFDakQsNENBQTRDO1lBQzlDO1FBQ0Y7UUFFQSxvQ0FBb0M7UUFDcEMsT0FBT0osSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQlUsZ0JBQWdCZSxjQUFjSSxPQUFPO1lBQ3JDcEIsU0FBU2E7WUFDVEMsV0FBV1AsZ0JBQWdCTyxTQUFTO1lBQ3BDQyxVQUFVUixnQkFBZ0JRLFFBQVE7WUFDbENPLGlCQUFpQmYsZ0JBQWdCZSxlQUFlLElBQUksRUFBRTtRQUN4RDtJQUNGLEVBQUUsT0FBTzlCLE9BQU87UUFDZE0sUUFBUU4sS0FBSyxDQUFDLDRCQUE0QkE7UUFDMUMsT0FBT0osSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQkMsT0FBTztZQUNQUSxTQUFTO2dCQUNQVSxNQUFNO2dCQUNOUCxTQUFTO1lBQ1g7UUFDRjtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIkQ6XFxQcm9qZWN0c1xcRGVraHRlIGhhaVxcbmV1cm9TeW5jXFxOZXVyb1N5bmMtQUktRnJvbnRlbmRcXHBhZ2VzXFxhcGlcXGFpXFxsb2NhbC1jaGF0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBBUEkgaGFuZGxlciBmb3IgbG9jYWwgY2hhdCBpbnRlcmFjdGlvbnNcclxuICogU3RyZWFtbGluZWQgdG8gZm9jdXMgb24gT2xsYW1hIGNoYXQgcHJvY2Vzc2luZyBhbmQgUGluYXRhIElQRlMgc3RvcmFnZVxyXG4gKi9cclxuaW1wb3J0IHsgbG9jYWxBaU1pZGRsZXdhcmUgfSBmcm9tICcuLi8uLi8uLi9saWIvbG9jYWwtYWktbWlkZGxld2FyZSc7XHJcbmltcG9ydCB7IHBpbmF0YUNvbnZlcnNhdGlvblNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9saWIvc2VydmljZXMvcGluYXRhLWNvbnZlcnNhdGlvbi1zZXJ2aWNlJztcclxuaW1wb3J0IHsgdXNlclByb2ZpbGVTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vbGliL3VzZXItcHJvZmlsZS1zZXJ2aWNlJztcclxuXHJcbi8vIFNhbXBsZSByZWNvbW1lbmRhdGlvbiBkYXRhIGZvciBmYWxsYmFja1xyXG5jb25zdCBTQU1QTEVfUkVDT01NRU5EQVRJT05TID0gW1xyXG4gIHtcclxuICAgIHR5cGU6ICdleGVyY2lzZScsXHJcbiAgICB0aXRsZTogJ0RlZXAgQnJlYXRoaW5nIEV4ZXJjaXNlJyxcclxuICAgIGRlc2NyaXB0aW9uOiAnVGFrZSA1IGRlZXAgYnJlYXRocywgaW5oYWxpbmcgZm9yIDQgc2Vjb25kcyBhbmQgZXhoYWxpbmcgZm9yIDYgc2Vjb25kcy4nLFxyXG4gICAgYWN0aW9uVXJsOiAnL3Jlc291cmNlcy9leGVyY2lzZXMvYnJlYXRoaW5nJyxcclxuICAgIGFjdGlvblRleHQ6ICdTdGFydCBFeGVyY2lzZSdcclxuICB9LFxyXG4gIHtcclxuICAgIHR5cGU6ICdyZXNvdXJjZScsXHJcbiAgICB0aXRsZTogJ1VuZGVyc3RhbmRpbmcgQW54aWV0eScsXHJcbiAgICBkZXNjcmlwdGlvbjogJ0xlYXJuIGFib3V0IHRoZSBjYXVzZXMgYW5kIGVmZmVjdHMgb2YgYW54aWV0eSBpbiBldmVyeWRheSBsaWZlLicsXHJcbiAgICBhY3Rpb25Vcmw6ICcvcmVzb3VyY2VzL2FydGljbGVzL2FueGlldHknLFxyXG4gICAgYWN0aW9uVGV4dDogJ1JlYWQgQXJ0aWNsZSdcclxuICB9LFxyXG4gIHtcclxuICAgIHR5cGU6ICdjaGVja2luJyxcclxuICAgIHRpdGxlOiAnTW9vZCBDaGVjay1pbicsXHJcbiAgICBkZXNjcmlwdGlvbjogXCJSZWNvcmQgaG93IHlvdSdyZSBmZWVsaW5nIHJpZ2h0IG5vdyB0byB0cmFjayB5b3VyIGVtb3Rpb25hbCBwYXR0ZXJucy5cIixcclxuICAgIGFjdGlvblVybDogJy9jaGVja2luJyxcclxuICAgIGFjdGlvblRleHQ6ICdDaGVjayBJbidcclxuICB9XHJcbl07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XHJcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXJJZCA9IHJlcS5ib2R5LnVzZXJJZCB8fCByZXEucXVlcnkudXNlcklkO1xyXG4gICAgXHJcbiAgICBpZiAoIXVzZXJJZCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ1VzZXIgSUQgaXMgcmVxdWlyZWQnIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCBiYXNpYyB1c2VyIGluZm8gaWYgYXZhaWxhYmxlLCBidXQgZG9uJ3QgcmVxdWlyZSBpdFxyXG4gICAgbGV0IHVzZXJQcm9maWxlID0gbnVsbDtcclxuICAgIGlmICh1c2VySWQgJiYgdXNlcklkICE9PSAnYW5vbnltb3VzJykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIHVzZXJQcm9maWxlID0gYXdhaXQgdXNlclByb2ZpbGVTZXJ2aWNlLmdldFVzZXJQcm9maWxlKHVzZXJJZCk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKCdFcnJvciBmZXRjaGluZyB1c2VyIHByb2ZpbGUsIGNvbnRpbnVpbmcgd2l0aG91dCBpdDonLCBlcnJvci5tZXNzYWdlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHsgbWVzc2FnZSwgY29udmVyc2F0aW9uSWQsIGhpc3RvcnkgfSA9IHJlcS5ib2R5O1xyXG4gICAgXHJcbiAgICBpZiAoIW1lc3NhZ2UgfHwgIW1lc3NhZ2UuY29udGVudCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ01lc3NhZ2UgY29udGVudCBpcyByZXF1aXJlZCcgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coJ0xvY2FsIGNoYXQgQVBJIGNhbGxlZCB3aXRoIG1lc3NhZ2U6JywgbWVzc2FnZS5jb250ZW50LnN1YnN0cmluZygwLCA1MCkgKyAnLi4uJyk7XHJcbiAgICBcclxuICAgIC8vIEV4dHJhY3QgY2hhdCBoaXN0b3J5IGlmIGF2YWlsYWJsZVxyXG4gICAgY29uc3QgY2hhdEhpc3RvcnkgPSBoaXN0b3J5IHx8IFtdO1xyXG4gICAgXHJcbiAgICAvLyBQcm9jZXNzIHRoZSBtZXNzYWdlIHRocm91Z2ggTExhTUEgQUkgbWlkZGxld2FyZVxyXG4gICAgY29uc3QgcHJvY2Vzc2VkUmVzdWx0ID0gYXdhaXQgbG9jYWxBaU1pZGRsZXdhcmUucHJvY2Vzc0lucHV0KG1lc3NhZ2UuY29udGVudCwgY2hhdEhpc3RvcnksIHVzZXJQcm9maWxlKTtcclxuICAgIFxyXG4gICAgLy8gU2V0dXAgbWVzc2FnZSBvYmplY3RzIGZvciBQaW5hdGEgc3RvcmFnZVxyXG4gICAgY29uc3QgdXNlck1lc3NhZ2UgPSB7XHJcbiAgICAgIHJvbGU6ICd1c2VyJyxcclxuICAgICAgY29udGVudDogbWVzc2FnZS5jb250ZW50LFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcclxuICAgIH07XHJcbiAgICBcclxuICAgIGNvbnN0IGFpTWVzc2FnZSA9IHtcclxuICAgICAgcm9sZTogJ2Fzc2lzdGFudCcsXHJcbiAgICAgIGNvbnRlbnQ6IHByb2Nlc3NlZFJlc3VsdC5tZXNzYWdlLFxyXG4gICAgICBzZW50aW1lbnQ6IHByb2Nlc3NlZFJlc3VsdC5zZW50aW1lbnQsXHJcbiAgICAgIGVtb3Rpb25zOiBwcm9jZXNzZWRSZXN1bHQuZW1vdGlvbnMsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBIYW5kbGUgY29udmVyc2F0aW9uIHN0b3JhZ2VcclxuICAgIGxldCBjb252ZXJzYXRpb247XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAoY29udmVyc2F0aW9uSWQpIHtcclxuICAgICAgICAvLyBBZGQgdXNlciBtZXNzYWdlIHRvIGV4aXN0aW5nIGNvbnZlcnNhdGlvblxyXG4gICAgICAgIGF3YWl0IHBpbmF0YUNvbnZlcnNhdGlvblNlcnZpY2UuYWRkTWVzc2FnZShcclxuICAgICAgICAgIGNvbnZlcnNhdGlvbklkLFxyXG4gICAgICAgICAgdXNlcklkLFxyXG4gICAgICAgICAgdXNlck1lc3NhZ2VcclxuICAgICAgICApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEFkZCBBSSByZXNwb25zZVxyXG4gICAgICAgIGNvbnZlcnNhdGlvbiA9IGF3YWl0IHBpbmF0YUNvbnZlcnNhdGlvblNlcnZpY2UuYWRkTWVzc2FnZShcclxuICAgICAgICAgIGNvbnZlcnNhdGlvbklkLFxyXG4gICAgICAgICAgdXNlcklkLFxyXG4gICAgICAgICAgYWlNZXNzYWdlXHJcbiAgICAgICAgKTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zb2xlLmxvZyhgQWRkZWQgbWVzc2FnZXMgdG8gZXhpc3RpbmcgY29udmVyc2F0aW9uOiAke2NvbnZlcnNhdGlvbklkfWApO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIENyZWF0ZSBuZXcgY29udmVyc2F0aW9uIHRpdGxlIGZyb20gbWVzc2FnZSBjb250ZW50XHJcbiAgICAgICAgY29uc3QgdGl0bGUgPSBtZXNzYWdlLmNvbnRlbnQubGVuZ3RoID4gMzBcclxuICAgICAgICAgID8gbWVzc2FnZS5jb250ZW50LnN1YnN0cmluZygwLCAzMCkgKyAnLi4uJ1xyXG4gICAgICAgICAgOiBtZXNzYWdlLmNvbnRlbnQ7XHJcbiAgICAgICAgICBcclxuICAgICAgICAvLyBDcmVhdGUgbmV3IGNvbnZlcnNhdGlvbiB3aXRoIGJvdGggbWVzc2FnZXNcclxuICAgICAgICBjb252ZXJzYXRpb24gPSBhd2FpdCBwaW5hdGFDb252ZXJzYXRpb25TZXJ2aWNlLmNyZWF0ZUNvbnZlcnNhdGlvbihcclxuICAgICAgICAgIHVzZXJJZCxcclxuICAgICAgICAgIHRpdGxlLFxyXG4gICAgICAgICAgW3VzZXJNZXNzYWdlLCBhaU1lc3NhZ2VdXHJcbiAgICAgICAgKTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zb2xlLmxvZyhgQ3JlYXRlZCBuZXcgY29udmVyc2F0aW9uOiAke2NvbnZlcnNhdGlvbi5faWR9YCk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKHN0b3JhZ2VFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzdG9yaW5nIGNvbnZlcnNhdGlvbiBpbiBQaW5hdGE6Jywgc3RvcmFnZUVycm9yKTtcclxuICAgICAgLy8gQ29udGludWUgZXZlbiBpZiBzdG9yYWdlIGZhaWxzIC0gcHJpb3JpdGl6ZSB0aGUgdXNlciBnZXR0aW5nIGEgcmVzcG9uc2VcclxuICAgIH1cclxuXHJcbiAgICAvLyBVcGRhdGUgcmVjb21tZW5kYXRpb25zIGlmIGF2YWlsYWJsZVxyXG4gICAgaWYgKHByb2Nlc3NlZFJlc3VsdC5yZWNvbW1lbmRhdGlvbnMgJiYgdXNlclByb2ZpbGUpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBhd2FpdCB1c2VyUHJvZmlsZVNlcnZpY2UudXBkYXRlUmVjb21tZW5kYXRpb25zKFxyXG4gICAgICAgICAgdXNlcklkLFxyXG4gICAgICAgICAgcHJvY2Vzc2VkUmVzdWx0LnJlY29tbWVuZGF0aW9uc1xyXG4gICAgICAgICk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcmVjb21tZW5kYXRpb25zOicsIGVycm9yKTtcclxuICAgICAgICAvLyBDb250aW51ZSB3aXRob3V0IHVwZGF0aW5nIHJlY29tbWVuZGF0aW9uc1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmV0dXJuIHRoZSByZXNwb25zZSB0byB0aGUgY2xpZW50XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG4gICAgICBjb252ZXJzYXRpb25JZDogY29udmVyc2F0aW9uPy5faWQgfHwgJ2ZhbGxiYWNrX2lkJyxcclxuICAgICAgbWVzc2FnZTogYWlNZXNzYWdlLFxyXG4gICAgICBzZW50aW1lbnQ6IHByb2Nlc3NlZFJlc3VsdC5zZW50aW1lbnQsXHJcbiAgICAgIGVtb3Rpb25zOiBwcm9jZXNzZWRSZXN1bHQuZW1vdGlvbnMsXHJcbiAgICAgIHJlY29tbWVuZGF0aW9uczogcHJvY2Vzc2VkUmVzdWx0LnJlY29tbWVuZGF0aW9ucyB8fCBbXVxyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGxvY2FsIGNoYXQgQVBJOicsIGVycm9yKTtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxyXG4gICAgICBlcnJvcjogJ0FuIGVycm9yIG9jY3VycmVkIHByb2Nlc3NpbmcgeW91ciByZXF1ZXN0JyxcclxuICAgICAgbWVzc2FnZTogeyBcclxuICAgICAgICByb2xlOiAnYXNzaXN0YW50JywgXHJcbiAgICAgICAgY29udGVudDogXCJJJ20gc29ycnksIEknbSBoYXZpbmcgdHJvdWJsZSBwcm9jZXNzaW5nIHlvdXIgcmVxdWVzdCByaWdodCBub3cuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuXCJcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59ICJdLCJuYW1lcyI6WyJsb2NhbEFpTWlkZGxld2FyZSIsInBpbmF0YUNvbnZlcnNhdGlvblNlcnZpY2UiLCJ1c2VyUHJvZmlsZVNlcnZpY2UiLCJTQU1QTEVfUkVDT01NRU5EQVRJT05TIiwidHlwZSIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJhY3Rpb25VcmwiLCJhY3Rpb25UZXh0IiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsInVzZXJJZCIsImJvZHkiLCJxdWVyeSIsInVzZXJQcm9maWxlIiwiZ2V0VXNlclByb2ZpbGUiLCJjb25zb2xlIiwid2FybiIsIm1lc3NhZ2UiLCJjb252ZXJzYXRpb25JZCIsImhpc3RvcnkiLCJjb250ZW50IiwibG9nIiwic3Vic3RyaW5nIiwiY2hhdEhpc3RvcnkiLCJwcm9jZXNzZWRSZXN1bHQiLCJwcm9jZXNzSW5wdXQiLCJ1c2VyTWVzc2FnZSIsInJvbGUiLCJ0aW1lc3RhbXAiLCJEYXRlIiwiYWlNZXNzYWdlIiwic2VudGltZW50IiwiZW1vdGlvbnMiLCJjb252ZXJzYXRpb24iLCJhZGRNZXNzYWdlIiwibGVuZ3RoIiwiY3JlYXRlQ29udmVyc2F0aW9uIiwiX2lkIiwic3RvcmFnZUVycm9yIiwicmVjb21tZW5kYXRpb25zIiwidXBkYXRlUmVjb21tZW5kYXRpb25zIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/ai/local-chat.js\n");

/***/ }),

/***/ "axios?6fac":
/*!************************!*\
  !*** external "axios" ***!
  \************************/
/***/ ((module) => {

module.exports = require("axios");

/***/ }),

/***/ "axios?daaa":
/*!************************!*\
  !*** external "axios" ***!
  \************************/
/***/ ((module) => {

module.exports = import("axios");;

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fai%2Flocal-chat&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cai%5Clocal-chat.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();